[
    {
        "title": "关于作者",
        "uri": "about",
        "content": "Hi    Kaku         Shopee                 2016        PAAS           0 1               2018                  2019                                                                                            ebpf                              IT",
        "objectID": "about",
        "date": "2021-04-15T12:17:10.000Z",
        "lastmod": "2021-04-15T12:17:10.000Z",
        "draft": false,
        "keywords": [
            ""
        ],
        "description": "",
        "tags": [],
        "categories": [],
        "author": "Kaku Li"
    },
    {
        "title": "友链",
        "uri": "friends",
        "content": "SRE        https   clay wangzhi com",
        "objectID": "friends",
        "date": "2023-12-02T01:06:32.000Z",
        "lastmod": "2023-12-02T01:06:32.000Z",
        "draft": false,
        "keywords": [],
        "description": "",
        "tags": [],
        "categories": [],
        "author": "Kaku Li"
    },
    {
        "title": "kubernetes 月光宝盒 - 时间倒流",
        "uri": "posts/backclock",
        "content": "k8s 1 7                                                case                  lastProbeTime  null lastTransitionTime  t1 status   True  type  Ready     Pod spec status conditions    PodReady Condition     t1    Pod    Ready     t1    watch   Pod Ready lastTransitionTime   t1   t2    watch   Pod NotReady lastTransitionTime   t2   t3    watch   Pod Ready lastTransitionTime   t3        t3    t2    t1        t3     t1        t3           Pod   t1        Ready        t2    t3         Pod NotReady          kubelet               func  m manager  updateStatusInternal pod v1 Pod  status v1 PodStatus  forceUpdate  podIsFinished bool    var oldStatus v1 PodStatus cachedStatus  isCached    m podStatuses pod UID  isCached   oldStatus   cachedStatus status    TODO  116484   assign terminal phase static pods   kubetypes IsStaticPod pod    cachedStatus podIsFinished     podIsFinished   klog InfoS  Got unexpected podIsFinished false  podIsFinished true status cache  programmer error     pod   klog KObj pod   podIsFinished   true       else mirrorPod  ok    m podManager GetMirrorPodByPod pod   ok   oldStatus   mirrorPod Status   else   oldStatus   pod Status          Set ReadyCondition LastTransitionTime  updateLastTransitionTime  status   oldStatus  v1 PodReady           updateLastTransitionTime updates LastTransitionTime pod condition  func updateLastTransitionTime status  oldStatus  v1 PodStatus  conditionType v1 PodConditionType    _  condition    podutil GetPodCondition status  conditionType  condition    nil   return      Need set LastTransitionTime  lastTransitionTime    metav1 Now   _  oldCondition    podutil GetPodCondition oldStatus  conditionType  oldCondition    nil    condition Status    oldCondition Status   lastTransitionTime   oldCondition LastTransitionTime   condition LastTransitionTime   lastTransitionTime   kubelet        container runtime      status             podStatuses     updateStatusInternal                                oldStatus            podStatuses      k8s pod spec                  t2     Pod NotReady      podStatuses       t1  Pod Ready         t3    Pod Ready       updateLastTransitionTime      status   oldStatus   Status      true          condition LastTransitionTime       oldCondition LastTransitionTime   t1   Feature Bug      feature    bug                                               issue  119514   kubelet             needsReconcile compares given status status pod manager  which    fact comes apiserver   returns whether status needs reconciled    apiserver  when pod status inconsistent apiserver kubelet     kubelet forcibly send update reconcile inconsistence  kubelet    source truth pod status     NOTE random liu   It s simpler pass mirror pod uid mirror pod uid     pod manager supports getting mirror pod static pod  so pass    static pod uid here     TODO random liu   Simplify logic when mirror pod manager added  func  m  manager  needsReconcile uid types UID  status v1 PodStatus  bool              kubelet source truth pod status             kubelet               container         Pod             kubelet              trick      Pod Ready Condition     kubelet         kube controller manager         Node NotReady            Pod     controller manager     NotReady      LastTransitionTime                       start http proxy worker node proxy kube apiserver request set kubelet use proxy instead directly use kube apiserver schedule pod node wait pod running  record LastTransitionTime PodReady true condition time1  stop proxy wait node not ready pod ready condition changed false set kube controller manager  record LastTransitionTime PodReady false condition time2  start proxy again wait pod ready  record LastTransitionTime PodReady true condition time3  will time3    time1 time3 time2      socat    http proxy            Kube controller manager         Pod Ready        endpoint controller             Pod Ready   Pod IP                        endpoint            endpoint                               endpoint               Pod                           Pod             Ready                  Condition LastTransitionTime        t1      Pod              t2   t3    Pod              bug    feature        feature    bug                           Condition Pod Ready Condition     kubelet                           Condition    Pod Ready Condition             node controller     Node NotReady     Custom Condition    endpoint controller    Pod Ready Condition   Custom Condition      Pod                                                                                               2017                Kubernetes         Bug                                                     Kubernetes service     Kubernetes endpoints                                                      v1 7        v1 9                                        v1 6                        Fixes bug cache watcher returning  current  object watch event  not historic event  means broke behavior when introducing watch cache  may API implications filtering watch consumers   hand  prevents clients filtering seeing objects outside watch correctly  lead subtl",
        "objectID": "posts/backclock",
        "date": "2023-09-25T14:15:51.000Z",
        "lastmod": "2023-09-25T14:15:51.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "back",
            "time"
        ],
        "description": "kubernetes 时间倒流",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "背包问题golang",
        "uri": "posts/backpack",
        "content": "01                                    golang                                                    N         V     i       c i     w i                                                                        f i   i           v                           f i max f i 1 f i 1  w i                                                       i        v                i                           i 1            i              i 1        v         f i 1     i              i 1           v ci                   f  i 1         i        w i             func main     v      int 7  5  8         w      int 2  3  4         goods    int    int 7  2     int 5  3     int 8  4     fmt Println zeroonepack1 v  w  5   fmt Println zeroonepack goods  5   fmt Println zeroonepack2 v  w  5              3             0    1           j       dpi   max dpi 1  goodsi   dpi 1 0    func zeroonepack goods int  capacity int  int   num    len goods  dp    make int  num     0    goodsi   dpi   max dpi 1  dpi 10   goods i    else   dpi   dpi 1       return dpnum 1   func zeroonepack1 weight   int  value   int  capacity int  int   num    len weight  dp    make int  num     0    weight i    dpi   max dpi 1  dpi 1  value i     else   dpi   dpi 1       return dpnum 1                     O VN                                                                  golang                                                O VN                                O                           i 1  N          fi                f0  V        i      f v              f  i  f i  f i 1 f i 1                 f i      i      fv       f  i 1 f i 1                      v V  0    fv         f v  f v c i        f  i 1          func zeroonepack2 weight   int  value   int  capacity int  int   num    len weight  dp    make   int  capacity 1     weight 0     0  j     j    weight i    dp j    max dp j   dp j weight i   value i         return dp capacity       fv  max f v  f v c i                 f i max fi 1 fi 1        fv c i         f  i 1     v                       f i f i                                            01",
        "objectID": "posts/backpack",
        "date": "2019-11-07T15:35:20.000Z",
        "lastmod": "2019-11-07T15:35:20.000Z",
        "draft": false,
        "keywords": [
            "背包",
            "backpack"
        ],
        "description": "背包问题",
        "tags": [
            "动态规划"
        ],
        "categories": [
            "算法"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "让子弹飞一会儿",
        "uri": "posts/bomb",
        "content": "Kubernetes 1 12 2018 7      2019 7 8             2023 10                      4                                                                      1 12     1 20    Kubernetes Deprecation Policy 5         Beta API                     8                                                    Plan B                     Kubernetes                                                       Node                                                      k8s                                                   k8s                                                                                               k8s                                                                      Pod            IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1 12      1 20                                                                                                                             Kubernetes                                                                                                                                         karmada member                                                                                                   karmada CNCF                            clusternet CNCF sandbox     OCM                                                 karmada                                                                                                                                                                               PPT                                           3           buffer io               PPT                                                                                                                                                                                                                                                                                                                                                         assume                                                                       Bind          pod update        cache                                                                                                                                                                                                                      k8s                                                                                                                                                                                                                                                     SRE                      SRE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                k8s",
        "objectID": "posts/bomb",
        "date": "2023-12-06T04:53:24.000Z",
        "lastmod": "2023-12-06T04:53:24.000Z",
        "draft": false,
        "keywords": [
            "谣言",
            "故障"
        ],
        "description": "",
        "tags": [
            "思考",
            "随笔"
        ],
        "categories": [
            "随笔"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "high QPS for configmap GET requests in kube-apiserver - 1",
        "uri": "posts/cachebasedmanager1",
        "content": "k8s    kube apiserver   ConfigMap    QPS          Etcd   ConfigMap        QPS                  kubelet    k8s v1 22 13          v1 28 0        kube apiserver         2023 08 23T08 55 54 331196195Z stderr F I0823 08 55 54 330840 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 926865ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  36cfcbe3 d76a 4a4d b251 47cc2df060cb  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  1 269527ms  resp 200 2023 08 23T08 57 09 333913507Z stderr F I0823 08 57 09 333470 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 810334ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  563bd337 df29 4342 afd0 9ca6e0632f0f  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  1 177012ms  resp 200 2023 08 23T08 58 14 338971779Z stderr F I0823 08 58 14 338630 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 563356ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  45350dc7 7a4b 43f1 8972 3b8053578234  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  929 214 s  resp 200                                kubelet   Pod                                                kubelet   Pod                               ConfigMap            QPS          kube apiserver                    ConfigMap                                            ConfigMap       Pod     Volume                                                                ConfigMap          client go          pkg kubelet          ConfigMaps           pkg kubelet configmap configmap_manager go              manager                  kubelet     configMapAndSecretChangeDetectionStrategy  Cache     NewCachingConfigMapManager         cacheBasedManager      ConfigMap       NewCachingConfigMapManager creates manager keeps cache configmaps    necessary registered pods     implement following logic       whenever pod create updated  cached versions configmaps    invalidated      every GetObject   call tries fetch value local cache     not there  invalidated old  fetch apiserver refresh    value cache  otherwise just fetched cache func NewCachingConfigMapManager kubeClient clientset Interface  getTTL manager GetObjectTTLFunc  Manager   getConfigMap    func namespace  name string  opts metav1 GetOptions   runtime Object  error    return kubeClient CoreV1   ConfigMaps namespace  Get context TODO    name  opts    configMapStore    manager NewObjectStore getConfigMap  clock RealClock    getTTL  defaultTTL  return  configMapManager  manager  manager NewCacheBasedManager configMapStore  getConfigMapNames       NewCachingConfigMapManager                 ConfigMap            Pod          ConfigMap                   GetObject                                             apiserver                                                            Pod       Pod     ConfigMap           GetObject                 ConfigMap            apiserver                               GetObject               GetObject               GetObject                       klog                                 pkg kubelet util manager cachebasedmanager go func  c  cacheBasedManager  GetObject namespace  name string   runtime Object  error    return c objectStore Get namespace  name    func  s  objectStore  Get namespace  name string   runtime Object  error    key    objectKey namespace  namespace  name  name  data    func    objectData   s lock Lock   defer s lock Unlock   item  exists    s items key   exists   return nil   item data    nil   klog V 5  InfoS  empty item data    key   key namespace     key name  item data    objectData     return item data     data    nil   return nil  fmt Errorf  object  q  q not registered   namespace  name       updating data objectStore  lock data  fetch object    needed return data  data Lock   defer data Unlock   data err    nil     s isObjectFresh data    opts    metav1 GetOptions   data object    nil    data err    nil      just periodic refresh object successfully fetched previously     case  server data apiserver cache reduce load    etcd apiserver  the cache eventually consistent   util FromApiserverCache  opts  klog V 5  InfoS  set resourceversion 0    key   key namespace     key name    object  err    s getObject namespace  name  opts  err    nil     apierrors IsNotFound err     data object    nil    data err    nil      Couldn t fetch latest object  no cached data return     Return fetch result instead  return object  err    err    nil     isObjectOlder object  data object      apierrors IsNotFound err       fetch succeeded newer version object     object not found apiserver  update cached data    reflect current status  data object   object data err   err data lastUpdateTime   s clock Now       else   kl",
        "objectID": "posts/cachebasedmanager1",
        "date": "2023-08-23T10:13:30.000Z",
        "lastmod": "2023-08-23T10:13:30.000Z",
        "draft": false,
        "keywords": [
            "high qps",
            "configmap",
            "kube-apiserver"
        ],
        "description": "high QPS for configmap GET requests in kube-apiserver - 1",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "high QPS for configmap GET requests in kube-apiserver - 2",
        "uri": "posts/cachebasedmanager2",
        "content": "k8s    kube apiserver   ConfigMap    QPS          Etcd   ConfigMap        QPS                  kubelet    k8s v1 22 13          v1 28 0        kube apiserver         2023 08 23T08 55 54 331196195Z stderr F I0823 08 55 54 330840 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 926865ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  36cfcbe3 d76a 4a4d b251 47cc2df060cb  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  1 269527ms  resp 200 2023 08 23T08 57 09 333913507Z stderr F I0823 08 57 09 333470 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 810334ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  563bd337 df29 4342 afd0 9ca6e0632f0f  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  1 177012ms  resp 200 2023 08 23T08 58 14 338971779Z stderr F I0823 08 58 14 338630 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 563356ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  45350dc7 7a4b 43f1 8972 3b8053578234  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  929 214 s  resp 200                                kubelet   Pod                                                kubelet   Pod                               ConfigMap            QPS          kube apiserver                    QPS                Etcd                ConfigMap           Pod    Sync       syncPod   syncPod      configMapManager RegisterPod        reconciler goroutine   100ms      mountAttachVolumes     Pod     Volume              apiserver            Pod         Volume                 DesiredStateOfWorld ActualStateOfWorld      QPS    QPS                 kubelet   ConfigMap                      Pod            Container Runtime           syncCh      syncPod        sync tiker      1s  reconciler      100ms    sync  frequency       1m     pkg kubelet pod_workers go    completeWork requeues error next sync interval immediately executes pending    work  func  p podWorkers  completeWork pod v1 Pod  phaseTransition bool  syncErr error       Requeue last update last sync returned error  switch       case syncErr    nil     No error  requeue regular resync interval  p workQueue Enqueue pod UID  wait Jitter p resyncInterval  workerResyncIntervalJitterFactor         p completeWorkQueueNext pod UID       reconciler    100ms                     apiserver                    Etcd                               resyncInterval          sync frequency k8s                                                                        Enqueue              1m   1m30s             sync ticker     1s                       Pod                Pod Enqueue                  Enqueue           syncPod            Pod       ConfigMap           QPS    1 90   1 60           QPS            90      deployment      ConfigMap      deployment                      QPS       1   90        100      deployment         ConfigMap            QPS       100   9000         9000   Pod         100   9000                     apiserver              apiserver                                  syncPod                                                                  apiserver QPS              deployment                   deployment        ConfigMap            ConfigMap   Pod                 syncPod      goroutine         Pod       ConfigMap      Key     namespace name            ConfigMap         reconciler                      CM                                          apiserver    CM                CM                     QPS            CM    Pod Volume           Pod        CM       QPS             apiserver                1m   1m30s s      syncPod          1m    node annotation node alpha kubernetes io ttl                 kube controller manager    node                         1m                       apiserver        apiserver cache               resourceversion 0                          remountRequired         MountVolume             false                                            apiserver                               true         pkg kubelet volumemanager populator desiredstateofworldpopulator go func  asw  actualStateOfWorld  MarkRemountRequired  podName volumetypes UniquePodName    asw Lock   defer asw Unlock   volumeName  volumeObj    range asw attachedVolumes   podObj  podExists    volumeObj mountedPods podName   podExists   volumePlugin  err    asw volumePluginMgr FindPluginBySpec podObj volumeSpec  err    nil    volumePlugin    nil      Log continue processing klog ErrorS nil   MarkRemountRequired failed FindPluginBySpec volume    uniquePodName   podObj podName   podUID   podObj podUID   volumeName   volumeName   volumeSpecName   podObj volumeSpec Name    continue   volumePlugin RequiresRemount podObj volumeSpec    podObj remountR",
        "objectID": "posts/cachebasedmanager2",
        "date": "2023-08-25T08:02:05.000Z",
        "lastmod": "2023-08-25T08:02:05.000Z",
        "draft": false,
        "keywords": [
            "high qps",
            "configmap",
            "kube-apiserver"
        ],
        "description": "high QPS for configmap GET requests in kube-apiserver - 2",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "high QPS for configmap GET requests in kube-apiserver - 3",
        "uri": "posts/cachebasedmanager3",
        "content": "k8s    kube apiserver   ConfigMap    QPS          Etcd   ConfigMap        QPS                  kubelet    k8s v1 22 13          v1 28 0        kube apiserver         2023 08 23T08 55 54 331196195Z stderr F I0823 08 55 54 330840 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 926865ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  36cfcbe3 d76a 4a4d b251 47cc2df060cb  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  1 269527ms  resp 200 2023 08 23T08 57 09 333913507Z stderr F I0823 08 57 09 333470 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 810334ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  563bd337 df29 4342 afd0 9ca6e0632f0f  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  1 177012ms  resp 200 2023 08 23T08 58 14 338971779Z stderr F I0823 08 58 14 338630 1 httplog go 132   HTTP  verb  GET  URI   api v1 namespaces default configmaps nginx cfgmap  latency  1 563356ms  userAgent  kubelet v1 28 0  linux amd64  kubernetes 855e7c4  audit ID  45350dc7 7a4b 43f1 8972 3b8053578234  srcIP  192 168 228 2 59052  apfpl  system  apffs  system nodes  apfiseats 1 apffseats 0 apfadditionalLatency  0s  apfexecution_time  929 214 s  resp 200                                kubelet   Pod                                                kubelet   Pod                               ConfigMap            QPS          kube apiserver                                               syncPod dswp disiredStateOfWorldPolulator  volumemanager               kubelet   goroutine             1s     queue           pod        goroutine     1    dswp populatorLoop   100ms                goroutine     2    volumemanager reconciler   100ms                     pod     kubelet           podworker goroutine podworker             pod     kubelet         worker worker      pod              syncPod                     RegisterPod          ConfigMap         t1     WaitForAttachAndMount     pod   dsp   processedPods          t2     syncPod          completeWork               pod           sync frequncy                    1   queue        dswp populatorLoop        pod             return         pod   volume       dsw disiredStateOfWorld    volumesToMount       remountRequired   true  volumemanager reconcile                                 ConfigMap             apiserver      etcd              apiserver       etcd      apiserver                            apiserver             mount          remountRequired   false  1            3   enqueue                pod worker     2 3            4 5                                   etcd                       etcd                          apiserver cache                                                  apiserver cache            watchBasedManager     watch     reflector              apiserver             etcd                             apiserver          etcd                                 apiserver        etcd                    etcd                     etcd          apiserver                        aspiserver                      AddReference                                                   etcd          apiserver                               apiserver qps                          kube controller manager                  annotation node alpha kubernetes io ttl                     ttlBoundaries     ttlBoundary   sizeMin  0  sizeMax  100  ttlSeconds  0    sizeMin  90  sizeMax  500  ttlSeconds  15    sizeMin  450  sizeMax  1000  ttlSeconds  30    sizeMin  900  sizeMax  2000  ttlSeconds  60    sizeMin  1800  sizeMax  10000  ttlSeconds  300    sizeMin  9000  sizeMax  math MaxInt32  ttlSeconds  600     size        ttlSeconds    ttl    0              kubelet       1min                                 sync frequency                 ConfigMap              ConfigMap                            1 5     sync frequency                                     ttl            apiserver      ttl             100      1m                  9000         10min                             5000              1   1 5min            5m      QPS       1 5        apiserver       etcd      qps        1             etcd                                    ConfigMap    Volume                                                                                                            resourceversion 0                                                                                                                                             https   github com kubernetes kubernetes pull 120255",
        "objectID": "posts/cachebasedmanager3",
        "date": "2023-08-26T08:02:05.000Z",
        "lastmod": "2023-08-26T08:02:05.000Z",
        "draft": false,
        "keywords": [
            "high qps",
            "configmap",
            "kube-apiserver"
        ],
        "description": "high QPS for configmap GET requests in kube-apiserver - 3",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "kube-apiserver 又 OOM 了？",
        "uri": "posts/cacher",
        "content": "v1 26             Informer     Informer   kube apiserver     list   watch               kube apiserver                         kube apiserver OOM                    kube apiserver OOM            kube apiserver   Informer           list   watch                                                                                                                                                   Cacher          kubernetes                     watch             Cacher watchCache cacheWatcher reflector    watchCache    reflector   store Etcd    listerWatcher   storage store   listerWatcher          reflector          kube apiserver                   cacher   startCaching      reflector ListAndWatch    listerWatcher   list   watch    Etcd list     watch watch      watchChan   Etcd            watchChan   incomingEventChan      transform        watchChan   resultChan     reflector     reflector       resultChan       watch Event              store           store   watchCache    watchCache processEvent       watchCacheEvent       watchCache   cache                  event   store             eventHandler       cacher   incoming chan    cacher dispatchEvents    incoming chan                cacheWatcher   input chan       kube apiserver watch             cacheWachter        cacheWatcher   Watch         input chan    watchCacheEvent         Cacher                  watchCache            cache cyclic buffer  store thread safe store            watchCacheEvent             store              cache                              watchCacheEvent                 store             kube apiserver                                         kube apiserver OOM        kube apiserver                                Event      Event   k8s                     watchCacheEvent              chan                                               list    kube apiserver                                                                            golang GC              list           Informer  list                          resourceversion          etcd                                     ResourceVersion                ResourceVersion  0              client go                                                                                          kube apiserver OOM         DaemonSet            Informer                                      kube apiserver                                  kube apiserver   OOM     OOM              master                               master              APF MaxInflightRequest                        kube apiserver     timeout                list        Informer            list                                  old resource version                                                         RV    resourceversion             watch api      0   RV        cacher   watch              RV   cyclic buffer         RV     watchCacheEvent      event          cyclic buffer     RV        RV                    RV                                               watchCacheEvent                       kubelet    apiserver          watch    labelselector   fieldselector           kubelet          Pod        Pod                Pod          kubelet    Informer     last RV     cyclic buffer       RV                      Informer    timeout          kube apiserver         too old resoure version       kube apiserver                                    watch             Informer        last RV        RV           kube apiserver                 RV   watch                   Informer             ListAndWatch        LIstAndWatch      kube apiserver        OOM        RV                   1                   2            RV                                  cyclic buffer           Informer     last RV                                                                                                                             BOOKMARK                       BOOKMARK     event           RV          ProgressNotify          RV        kube apiserver     Informer resume               Etcd   clientv3 ProgressNotify     kube apiserver   Watch Etcd           Options       ProgressNotify    Etcd         WithProgressNotify makes watch server send periodic progress updates every 10 minutes when no incoming events  Progress updates zero events WatchResponse           KEP 956 watch bookmark   1904 efficient watch resumption stale read                    watchCache                      Etcd          Etcd              kube apiserver cache            T1  StatefulSet controller creates pod 0  uid 1  scheduled node 1 T2  pod 0 deleted part rolling upgrade node 1 sees pod 0 deleted cleans up  deletes pod api StatefulSet controller creates second pod pod 0  uid 2  assigned node 2 node 2 sees pod 0 scheduled starts pod 0 kubelet node 1 crashes restarts  performs initial list pods scheduled against API server HA setup  more one API server  partitioned master  watch cache arbitrarily delayed   watch cache returns list pods T2 node 1 fills its local cache list pods T2 node 1 starts pod 0  uid 1  node 2 already running pod 0  uid 2          issue 59848                                                                  ",
        "objectID": "posts/cacher",
        "date": "2023-10-23T16:13:59.000Z",
        "lastmod": "2023-10-23T16:13:59.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "cacher",
            "watch"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Cgroup泄露1",
        "uri": "posts/cgroup-leak",
        "content": "k8s          no space left device                              runc   docker   opencontainers runc  fork   docker runc         docker   1 13 1    docker runc commit  9df8b306d01f59d3a8029be411de015b7304dd8f         func  s MemoryGroup  Apply d cgroupData   err error    path  err    d path  memory   err    nil     cgroups IsNotFound err    return err   memoryAssigned d config    path         err    os MkdirAll path  0755   err    nil   return err             d config KernelMemory    0   err    EnableKernelMemoryAccounting path   err    nil   return err       defer func     err    nil   os RemoveAll path           need join memory cgroup set memory limits     kmem limitinbytes set when cgroup empty  _  err   d join  memory   err    nil     cgroups IsNotFound err    return err   return nil          KernelMemory     docker runc           kubelet     kubelet 1 12 4   pkg kubelet cm cgroupmanagerlinux go  func  s MemoryGroup  Apply d cgroupData   err error    path  err    d path  memory   err    nil     cgroups IsNotFound err    return err   else path         return nil   memoryAssigned d config    _  err    os Stat path   os IsNotExist err    err    os MkdirAll path  0755   err    nil   return err      enable kernel memory accouting when cgroup    created libcontainer  otherwise    error when people use cgroupsPath join existed    cgroup whose kernel memory not initialized          err    EnableKernelMemoryAccounting path   err    nil   return err       defer func     err    nil   os RemoveAll path           need join memory cgroup set memory limits     kmem limitinbytes set when cgroup empty  _  err   d join  memory   err    nil     cgroups IsNotFound err    return err   return nil             KernelMemory               EnableKernelMemoryAccounting         kubelet       docker cgroup   cgroup driver cgroupfs   systemd          systemd       KernelMemory                                kubelet     sys fs cgroup memory kubepods memory kmem slabinfo             kmem     kubelet                  kmem                             kubelet            sys fs cgroup memory kubepods kubelet                                kubelet                         cgroup     Pod         cgroup                kmem",
        "objectID": "posts/cgroup-leak",
        "date": "2019-07-10T01:54:43.000Z",
        "lastmod": "2019-07-10T01:54:43.000Z",
        "draft": false,
        "keywords": [
            "cgorup leak",
            "leak"
        ],
        "description": "cgroup泄露",
        "tags": [
            "linux",
            "cgroup"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Cgroup泄露2",
        "uri": "posts/cgroup-leak2",
        "content": "kubernetes   1 12  kubelet      kmem accounting    kernel memory    4 0                      cgroup      cgroup                     kubelet log           mkdir  sys fs cgroup memory kubepods burstable pod79fe803c 072f 11e9 90ca 525400090c71 b98d4aea818bf9d1d1aa84079e1688cd9b4218e008c58a8ef6d6c3c106403e7b  no space left devic                                      kernel cgroup c L139      cgroup    group          1                kmem accounting     cgroup                         65535 cgroup                   kmem accounting      memory cgroup                                     cgroup      cat  proc cgroups                                cgroup                              cgroup      usage   stap  g getmemcgcount stp     include  include  include    embedded c function return value  doesn t argument  use specified void here     int getmemcgcount void    struct cgroupsubsysstate  tmp  int count   1  int i  rcureadlock     i   1  memory movechargeat_immigrate Note  bits movechargeat_immigrate its own meaning type charges moved  8 2 details  Note  Charges moved when move mm  owner  words  leader thread group  Note  cannot find enough space task destination cgroup  try space reclaiming memory  Task migration may fail cannot enough space  Note  several seconds move charges much       task                                        memcg                        quota                       cgroup     task                memory limitinbytes memory usageinbytes tasks         memcg          memory usageinbytes                      task",
        "objectID": "posts/cgroup-leak2",
        "date": "2019-07-10T01:54:43.000Z",
        "lastmod": "2019-07-10T01:54:43.000Z",
        "draft": false,
        "keywords": [
            "cgorup leak",
            "leak"
        ],
        "description": "cgroup泄露",
        "tags": [
            "linux",
            "cgroup"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubernetes 陈年老 bug - 绑核",
        "uri": "posts/cpusetbug1",
        "content": "lxcfs        cgroup v2              top    htop        cpu                lxcfs               cpuset   cpu max                                        k8s                                                       k8s                              v1 28   worker     12c      system    kubelet      1c               10c     allocatable cpu   10c     cpuManagerPilicy   staitic    cpuManagerReconcilePeriod       10s              Pod   cpumanagerstate     defaultCPU                Burstable Podb   cpu request 4c cpu limit 8c    Podb   cpuset                       Guaranteed Podg1    6c    Podb   cpuset              Podg1    Podb   cpuset                       Podg2     Podb                    12c           6c                                                                                                                                  feature            bug                                          defaultCPU                https   kubernetes io zh cn docs tasks administer cluster cpu management policies            CPU                    CPU          CPU           CPU        kubelet   kube reserved     system reserved       CPU       1 17           kubelet   reserved cpus         CPU           reserved cpus       CPU          kube reserved     system reserved     CPU               CPU              ID                   BestEffort   Burstable Pod     CPU     Guaranteed Pod                 CPU requests           CPU       Guaranteed Pod          CPU requests             CPU                            Guaranteed Pod                                  Podg1   Podb   cpuset      6c      cpustatemanager             defaultCPU    6c    Podg1                          6c                 cpu              cpu   Podb        Podb      6c          cpumanagerstate      defaultCPU     6c                PodID           Pod     6c                           Podg2                                      bug            k8s         https   www likakuli com posts kubernetes cpu manager         ISSUE                ISSUE      1 8          ISSUE                Internal PreStartContainer hook failed  not enough cpus available satisfy request  63018     cpumanager  AddContainer error  not enough cpus available satisfy request  79159     TopologyManager  Guarantee Aligned resources Multiple Containers  83476     Container cpuset lost  apparently due race PostStopContainer   new container creation  90303     CPU manager does not work correctly guaranteed pod multiple containers  103952         PR     CPU manager release CPUs when Pod enters completed phase  52363     cpumanager  rollback state updateContainerCPUSet failed  67430     clean containers reconcileState cpuManager  68619     Update CPUManager stored state semantics  84462     Fix exclusive CPU allocations deleted container restart  90377     not clear state pods pending admission CPU Memory Device manager  103979                                                        v1 22   kubelet                                           2021   v1 22       2023 9 v1 28                  func  m  manager  removeStaleState        once sources ready attempt remove stale state     ensures call m activePods   below will succeed    actual active pods list   m sourcesReady AllReady     return      grab lock ensure no new containers will grab CPUs    executing code below  Without lock  its possible end    removing state newly added asynchronous call    AddContainer   during execution code  m Lock   defer m Unlock      list active pods  activeAndAdmittedPods    m activePods   m pendingAdmissionPod    nil   activeAndAdmittedPods   append activeAndAdmittedPods  m pendingAdmissionPod                    activePods      Completed   Pod        admission     Pod     active                 pendingAdmissionPod      admit             Pod                   Pod                         Pod       Pod   admit          Pod                       Podg1         pendingAdmissionPod    Podg1 kubelet                              Podg2           pendingAdmissionPod      Podg2      removeStaleState      Podg1                                            admission     Pod     Pod                kubelet            Pod                  cpuset                                              admission     Pod          pendingAdmissionPod   not clear state pods pending admission CPU Memory Device manager  103979          CPU manager does not work correctly guaranteed pod multiple containers  103952                  Guaranteed Pod       Container      admit     cpuset                 Container                                                                            v1 22                                                      pr                   activePods        admission     Pod                    Pod           admission     Pod        podworker    active                    https   github com kubernetes kubernetes issues 103952 issuecomment 887859214 https   github com kubernetes kubernetes issues 103952 issuecomment 888387811                       admission     Pod         pr      pr       issue                                                 reconcileState         ",
        "objectID": "posts/cpusetbug1",
        "date": "2023-09-14T12:03:59.000Z",
        "lastmod": "2023-09-14T12:03:59.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "cpuset",
            "cpu_manager"
        ],
        "description": "kubernetes 陈年老 bug 之绑核",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "CRUD工程师的福音",
        "uri": "posts/crud",
        "content": "CRUD                 CRUD                 apiserver    dao           apiserver          dao                         go struct                         table     go struct         table sql    table           go struct                            BUG     https   github com smallnest gen                                                                      go struct dao  api            restful api         swagger                                                                                     golang        golang           golang        go  u github com smallnest gen          example        sample db                                              sample db         gen   sqltype sqlite3     connstr    sample db      database main     json     gorm     guregu     rest     out   example     module example com rest example     mod     server     makefile     json fmt snake     generate dao     generate proj     overwrite       make       packr2          cd   example   example        bin example   cp       sample db       example           http   127 0 0 1 8080 swagger index html                 curl http   localhost 8080 artists                                        GOPATH             go mod   get                 GOPATH               so easy                                                                             gen                                             templateDir                                 exec                         custom     sample gen           exec sample gen               master                2020 8 4                  sample gen                                golang template     template                  GIN   GORM   crud                       packr                                                                    CRUD",
        "objectID": "posts/crud",
        "date": "2021-04-29T14:08:12.000Z",
        "lastmod": "2021-04-29T14:08:12.000Z",
        "draft": false,
        "keywords": [
            "CRUD",
            "auto generate",
            "table",
            "apiserver"
        ],
        "description": "",
        "tags": [
            "gen"
        ],
        "categories": [
            "开源项目介绍"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "cgroup mount destination: unknown",
        "uri": "posts/docker-cgroup-unknown",
        "content": "k8s                Failed create pod sandbox  rpc error  code   Unknown desc   failed start sandbox container pod  xxx sf 32c80 0   Error response daemon  cgroups  cannot find cgroup mount destination  unknown      cgroup                                   issue  cgroups  cannot found cgroup mount destination  unknown                                                         cgroup             kubelet  docker docker    docker 18 06                                                  docker               containerd               PidPath will return correct cgroup paths existing process running inside cgroup    commonly used Load function restore existing container func PidPath pid int  Path   p    fmt Sprintf   proc  d cgroup   pid  paths  err    parseCgroupFile p  err    nil   return errorPath errors Wrapf err   parse cgroup file  s   p     return existingPath paths        func existingPath paths map string string  suffix string  Path      localize paths based root mount dest nested cgroups n  p    range paths   dest  err    getCgroupDestination string n   err    nil   return errorPath err    rel  err    filepath Rel dest  p  err    nil   return errorPath err    rel          rel   dest   paths n    filepath Join      rel    return func name Name   string  error    root  ok    paths string name    ok   root  ok   paths fmt Sprintf  name  s   name     ok   return     fmt Errorf  unable find  q controller set   name      suffix         return filepath Join root  suffix   nil   return root  nil     func getCgroupDestination subsystem string   string  error    f  err    os Open   proc self mountinfo   err    nil   return     err   defer f Close   s    bufio NewScanner f  s Scan     fields    strings Split s Text         len fields    10      broken mountinfo  continue   fields len fields  3      cgroup    continue   _  opt    range strings Split fields len fields  1          opt    subsystem   return fields 3   nil       err    s Err    err    nil   return     err   return     ErrNoCgroupMountDestination   func parseCgroupFile path string   map string string  error    f  err    os Open path  err    nil   return nil  err   defer f Close   return parseCgroupFromReader f    func parseCgroupFromReader r io Reader   map string string  error    var   cgroups   make map string string  s   bufio NewScanner r    s Scan     err    s Err    err    nil   return nil  err   var   text   s Text   parts   strings SplitN text       3    len parts    3   return nil  fmt Errorf  invalid cgroup entry   q   text    _  subs    range strings Split parts 1          subs         cgroups subs    parts 2        return cgroups  nil             proc id cgroup        subsystem     parseCgroupFromReader    proc id cgroup                     2                                existingPath                  getCgroupDestination                    getCgroupDestination       proc id mountinfo                            cgroup                                                                                                     agent     mount      cpumirror cgroup          java                    umount      umount   proc id cgroup    cpumirror      proc id mountinfo                                  docker     1 13 1          1 13 1  containerd",
        "objectID": "posts/docker-cgroup-unknown",
        "date": "2021-02-10T03:41:36.000Z",
        "lastmod": "2021-02-10T03:41:36.000Z",
        "draft": false,
        "keywords": [
            "cgroup",
            "mount",
            "unknown"
        ],
        "description": "cgroup mount destination: unknown",
        "tags": [
            "linux",
            "cgroup",
            "docker"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "docker for mac - 1",
        "uri": "posts/docker-for-mac-1",
        "content": "Docker Mac                              Docker Mac         macOS    IP           Known limitations  use cases  workarounds                mac docker connector         Docker Mac               MacOS               docker inspect                                             MacOS                        screen                                                       linux     namespace         docker run  it   privileged   pid host debian nsenter  t 1  m  u  n  i sh                        pid namespace        nsenter        1   mount uts net namespaec                  pid namespace      1        1              Exec Permission denied docker run                     linux         mac                                         chmod 755 filename",
        "objectID": "posts/docker-for-mac-1",
        "date": "2021-11-03T11:18:00.000Z",
        "lastmod": "2021-11-03T11:18:00.000Z",
        "draft": false,
        "keywords": [
            "docker for mac",
            "docker",
            "desktop"
        ],
        "description": "",
        "tags": [
            "docker"
        ],
        "categories": [
            "有用的知识"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "docker hang问题排查",
        "uri": "posts/docker-hang",
        "content": "1            kubelet    kubelet  Pod                  redis            kubelet                NotReady     kubelet             NotReady            container runtime down                                    docker       docker            docker ps               docker inspect                    docker hang             docker       docker    1 13 1         18 06 3     docker    18 06 3 docker hang    1 13 1             docker ps      hang              docker          docker 18 06 3             docker ps                  docker inspect                         docker                                   docker ps docker inspect     docker     kubelet       docker API                   docker hang         docker hang        kubelet          NotReady  2   kubelet       kubelet        Ready  NotReady       docker hang                        kubelet         Condition                                           ReadyCondition         kubectl           Statue    ReadCondition                   Ready             OK      Pod   NotReady        kubelet               Pod   NotReady                  Unknown       kubelet      kubelet   ReadyCondition            defaultNodeStatusFuncs factory generates default set    setNodeStatus funcs func  kl Kubelet  defaultNodeStatusFuncs     func v1 Node  error          setters   append setters  nodestatus OutOfDiskCondition kl clock Now  kl recordNodeStatusEvent   nodestatus MemoryPressureCondition kl clock Now  kl evictionManager IsUnderMemoryPressure  kl recordNodeStatusEvent   nodestatus DiskPressureCondition kl clock Now  kl evictionManager IsUnderDiskPressure  kl recordNodeStatusEvent   nodestatus PIDPressureCondition kl clock Now  kl evictionManager IsUnderPIDPressure  kl recordNodeStatusEvent   nodestatus ReadyCondition kl clock Now  kl runtimeState runtimeErrors  kl runtimeState networkErrors  validateHostFunc  kl containerManager Status  kl recordNodeStatusEvent   nodestatus VolumesInUse kl volumeManager ReconcilerStatesHasBeenSynced  kl volumeManager GetVolumesInUse      TODO mtaufen   decided not move setter now  does send event    record state back Kubelet runtime object  future  I d isolate    side effects decoupling decisions send events partial status recording    Node setters  kl recordNodeSchedulableEvent    return setters     nodestatus ReadyCondition            Ready                                              func  s  runtimeState  runtimeErrors     string   s RLock   defer s RUnlock   var ret   string  s lastBaseRuntimeSync Add s baseRuntimeSyncThreshold  After time Now         1 ret   append ret   container runtime down     s internalError    nil   ret   append ret  s internalError Error      _  hc    range s healthChecks      2 ok  err    hc fn     ok   ret   append ret  fmt Sprintf   s not healthy   v   hc name  err       return ret                                                       30s                     NotReady             kubelet     kubelet  5s                I0715 10 43 28 049240 16315 kubelet go 1835  skipping pod synchronization    container runtime down  I0715 10 43 33 049359 16315 kubelet go 1835  skipping pod synchronization    container runtime down  I0715 10 43 38 049492 16315 kubelet go 1835  skipping pod synchronization    container runtime down              1   NotReady              kubelet        lastBaseRuntimeSync kubelet        goroutine    goroutine     lastBaseRuntimeSync       func  kl  Kubelet  Run updates kl cadvisor Start    cc Manager Start    self createContainer    m createContainerLocked    container NewContainerHandler    factory CanHandleAndAccept    self client ContainerInspect            kubelet  docker inspect    hang        kubelet       Ready  NotReady                 docker inspect  hang     docker inspect hang    kubelet            Ready           oneTimeInitializer sync Once         kebelet          kubelet        Pod                           Pod                 kubelet     docker inspect                      kubelet                               docker hang      3  docker hang     docker hang                                  docker 1 13 1                                     docker          docker 18 06 3   docker hang        4                          docker hang                                    docker             docker inspect                3 1              docker                  go               pprof     pprof    docker         goroutine profile  total 722373 717594   0x7fe8bc202980 0x7fe8bc202a40 0x7fe8bc2135d8 0x7fe8bc2132ef 0x7fe8bc238c1a 0x7fe8bd56f7fe 0x7fe8bd56f6bd 0x7fe8bcea8719 0x7fe8bcea938b 0x7fe8bcb726ca 0x7fe8bcb72b01 0x7fe8bc71c26b 0x7fe8bcb85f4a 0x7fe8bc4b9896 0x7fe8bc72a438 0x7fe8bcb849e2 0x7fe8bc4bc67e 0x7fe8bc4b88a3 0x7fe8bc230711 0x7fe8bc2132ee sync runtime_SemacquireMutex 0x3e  usr local go src runtime sema go 71 0x7fe8bc238c19 sync   Mutex  Lock 0x109  usr local go src sync mutex go 134 0x7fe8bd56f7fd github com docker docker daemon   Daemon  ContainerInspectCurrent 0x8d  root rpmbuild BUILD src engine  gopath src github com docker docker daemon inspect go 40 0x7fe8bd56f6bc github com docker docker daemon   Da",
        "objectID": "posts/docker-hang",
        "date": "2020-10-26T13:52:54.000Z",
        "lastmod": "2020-10-26T13:52:54.000Z",
        "draft": false,
        "keywords": [
            "docker",
            "hang"
        ],
        "description": "",
        "tags": [
            "docker"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Java服务突现毛刺",
        "uri": "posts/docker-java-cpu",
        "content": "agent                         Container                           agent                                      agent    sidecar                                              agent          cgroup         cgroup                                       Java                 java                        jdk                       cpu                                             jdk8u191                                                 jdk      202   191                      cpu                            java         cpu            java  XX  UnlockDiagnosticVMOptions  XX  PrintContainerInfo  version                                         jdk                                           strace   java                    cpu              cpu              cpu_mirror             cpu                        agent                    sys fs cgroup                  mount      cgroup      jdk                        jdk              Container Support doesn t work Join Controllers combinations                                             cpu_mirror                     prof self mountinfo        strstr      cpu memory             proc self cgroup                                  strstr       cpu memory       proc self mountinfo                      strcmp     cpu memory       proc self cgroup                                              strcmp     cpu memory            if contains str   cpu   set cpu subsystme     subStr split str       subStr equals  cpu  set cpu subsystem           jdk                    cpu_mirror     umount                                        umount                                   agent",
        "objectID": "posts/docker-java-cpu",
        "date": "2021-02-10T03:41:20.000Z",
        "lastmod": "2021-02-10T03:41:20.000Z",
        "draft": false,
        "keywords": [
            "java",
            "docker",
            "cgroup",
            "controllers"
        ],
        "description": "",
        "tags": [
            "docker",
            "上云"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Dockerd资源泄露系列 - 3",
        "uri": "posts/docker-leak3",
        "content": "k8s       fd     80      dockerd    26G                 dockerd                            fd         ss  anp   grep dockerd                       8    0                                    pprof            dockerd  debug       service          ExecReload  bin kill  s HUP  MAINPID KillMode process     etc docker daemon json       debug   true           systemctl daemon reload    docker         systemctl reload docker     docker     debug   dockerd    uds                    socat docker          sudo socat  d  d TCP LISTEN 8080 fork bind 0 0 0 0 UNIX  var run docker sock                8080     docker api             go tool pprof http   ip 8080 debug pprof heap                        golang   bufio NewWriterSize NewReaderSize    http                   Goroutine                                     goroutine            http   ip 8080 debug pprof goroutine debug 1       1572822 goroutine            786212                               docker 18 09 2                              goroutine      dockerd containerd                 goroutine        docker kill  wait chan close    wait         goroutine   docker kill       goroutine              Kill forcefully terminates container  func  daemon Daemon  Kill container containerpkg Container  error    container IsRunning     return errNotRunning container ID       1  Send SIGKILL err    daemon killPossiblyDeadProcess container  int syscall SIGKILL    err    nil      normally  return err  we re not going    can t stop container point    it s probably it s already stopped  Meaning     time IsRunning   call above stopped     Also  err return will environment specific can t    look particular  common  error indicate    process already dead vs something else going wrong     So  instead we ll give 2 seconds complete    time container running  error    probably valid so return caller  isErrNoSuchProcess err    return nil   ctx  cancel    context WithTimeout context Background    2 time Second  defer cancel   status    dockerd        3   image2020 12 23_13 51 12 png  leak3 5 png                task exit              goroutine       docker stop          kubelet                                                                                          D          Kill                                             Kubelet   docker                                                D            D             ps aux   awk   8   D       D      Kubelet                                              docker stop api  dockerd    uds   dockerd            goroutine  rpc    containerd                             goroutine        containerd   runc               D                task exit   dockerd      goroutine                     fd    goroutine                           kubelet           kubelet                                    docker api    timeout dockerd                            timeout  dockerd      task exit       container remove          docker stop              context Background   Wait              Wait",
        "objectID": "posts/docker-leak3",
        "date": "2020-12-24T09:26:12.000Z",
        "lastmod": "2020-12-24T09:26:12.000Z",
        "draft": false,
        "keywords": [
            "docker",
            "泄露",
            "内存泄露",
            "leak",
            "memory leak"
        ],
        "description": "",
        "tags": [
            "docker"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Pod terminating",
        "uri": "posts/docker-pod-terminating",
        "content": "stupig 1                                           Pod Terminating         Ready         Ready         Pod     Pod                 kubelet     docker  1                             2       2 1   kubelet   Pod       stupig master     kubectl pod  owide pod 976a0 5 0 1 Terminating 0 112m   kubelet                    kubelet          kubelet          I1014 10 56 46 492682 34976 kubeletpods go 1017  Pod  pod 976a0 5default f1e03a3d 0dc7 11eb b4b1 246e967c4efc   terminated  containers not cleaned up   ID  Type docker ID 41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef  Name stupig State exited CreatedAt 2020 10 14 10 49 57 859913657  0800 CST StartedAt 2020 10 14 10 49 57 928654495  0800 CST FinishedAt 2020 10 14 10 50 28 661263065  0800 CST ExitCode 0 Hash 2101852810 HashWithoutResources 2673273670 RestartCount 0 Reason Completed Message  Resources map CpuQuota 200000 Memory 2147483648 MemorySwap 2147483648   E1014 10 56 46 709255 34976 remoteruntime go 250  RemoveContainer  41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef  runtime service failed  rpc error  code   Unknown desc   failed remove container  41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef   Error response daemon  container 41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef  driver  overlay2  failed remove root filesystem  unlinkat  home dockerrt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged  device resource busy E1014 10 56 46 709292 34976 kuberuntimegc go 126  Failed remove container  41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef   rpc error  code   Unknown desc   failed remove container  41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef   Error response daemon  container 41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef  driver  overlay2  failed remove root filesystem  unlinkat  home dockerrt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged  device resource busy     kubelet  Pod Terminating                 kubelet         docker rm  f                 xxx merged           device resource busy        kubelet                                stupig hostname     sudo docker ps  a   grep pod 976a0 5 41020461ed4d Removal Progress k8sstupigpod 976a0 5defaultf1e03a3d 0dc7 11eb b4b1 246e967c4efc_0 f0a75e10b252 Exited  0  2 minutes ago k8sPODpod 976a0 5defaultf1e03a3d 0dc7 11eb b4b1 246e967c4efc_0  stupig hostname     sudo docker rm  f 41020461ed4d Error response daemon  container 41020461ed4d801afa8d10847a16907e65f6e8ca34d1704edf15b0d0e72bf4ef  driver  overlay2  failed remove root filesystem  unlinkat  home docker_rt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged  device resource busy                       Google    device resource busy                2 2 Google       Google           Google                                   docker  MountFlags slave   docker          mnt             docker device busy                        docker       MountFlags slave             so                    2 3 docker          docker           docker                         docker                  2 4   docker      docker     docker                device resource busy   docker                                      stupig hostname     grep  rwn   home docker_rt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged   proc   mountinfo  proc 22283 mountinfo 50 386 542 0 92    home docker_rt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged rw relatime   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 22407 mountinfo 50 386 542 0 92    home docker_rt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged rw relatime   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 28454 mountinfo 50 386 542 0 92    home docker_rt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged rw relatime   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 28530 mountinfo 50 386 542 0 92    home docker_rt overlay2 e5dab77be213d9f9cfc0b0b3281dbef9c2878fee3b8e406bc8ab97adc30ae4d5 merged rw relatime   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX                            docker                         docker                   docker stop                    func  daemon Daemon  Cleanup container container Container    err    daemon conditionalUnmountOnCleanup container   err    nil   mountid  err    daemon imageService GetLayerMountID container ID  container OS   err    nil   daemon cleanupMountsByID mountid        func  daemon Daemon  conditionalUnmountOnCleanup container container Container  error   return daemon Unmount container    func  daemon Daemon  Unmount container container Container  error   container RWLayer    nil   return errors New  RWLayer container     container ID     unexpectedly nil     err    container RWLayer Unmount    err    nil   logrus Errorf  Error unmounting container  s   s   container ID  err  return err   return nil   func  rl  ",
        "objectID": "posts/docker-pod-terminating",
        "date": "2020-10-31T02:37:37.000Z",
        "lastmod": "2020-10-31T02:37:37.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "docker",
            "terminating"
        ],
        "description": "",
        "tags": [
            "docker"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Pod terminating2",
        "uri": "posts/docker-pod-terminating2",
        "content": "1                                                       docker    18 06 3 ce              docker   systemd     MountFlags slave     dockerd                  live restore true    docker       dockerd shim  mnt ns                                                                                                                     MountFlags slave   live restore true                                  docker    live restore             docker                                   docker                          MountFlags slave                   docker device busy               docker                            17                             2               MountFlags slave     docker                       1 13 1   18 06 3 ce               docker device busy                          docker   systemd    MountFlags slave     systemd    PrivateTmp true           httpd                   docker 1 13 1            1          stupig hostname2     sudo systemctl daemon reload    2    docker  stupig hostname2     sudo systemctl restart docker    3        stupig hostname2     sudo docker run  d nginx c89c2aeff6e3e6414dfc7f448b4a560b4aac96d69a82ba021b78ee576bf6771c    4    httpd  stupig hostname2     sudo systemctl restart httpd    5        stupig hostname2     sudo docker stop c89c2aeff6e3e6414dfc7f448b4a560b4aac96d69a82ba021b78ee576bf6771c c89c2aeff6e3e6414dfc7f448b4a560b4aac96d69a82ba021b78ee576bf6771c    6        stupig hostname2     sudo docker rm c89c2aeff6e3e6414dfc7f448b4a560b4aac96d69a82ba021b78ee576bf6771c Error response daemon  Driver overlay2 failed remove root filesystem c89c2aeff6e3e6414dfc7f448b4a560b4aac96d69a82ba021b78ee576bf6771c  remove  home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged  device resource busy    7         stupig hostname2     grep  rwn  home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged  proc   mountinfo  proc 19973 mountinfo 40 231 227 0 40    home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged rw relatime shared 119   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 19974 mountinfo 40 231 227 0 40    home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged rw relatime shared 119   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 19975 mountinfo 40 231 227 0 40    home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged rw relatime shared 119   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 19976 mountinfo 40 231 227 0 40    home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged rw relatime shared 119   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 19977 mountinfo 40 231 227 0 40    home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged rw relatime shared 119   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX  proc 19978 mountinfo 40 231 227 0 40    home docker_rt overlay2 6c77cfb6c0c4b1e809c47af3c5ff6a4732a783cc14ff53270a7709c837c96346 merged rw relatime shared 119   overlay overlay rw lowerdir XXX upperdir XXX workdir XXX    8          stupig hostname2     ps  ef egrep  19973 19974 19975 19976 19977 19978  root 19973 1 0 15 13   00 00 00  usr sbin httpd  DFOREGROUND apache 19974 19973 0 15 13   00 00 00  usr sbin httpd  DFOREGROUND apache 19975 19973 0 15 13   00 00 00  usr sbin httpd  DFOREGROUND apache 19976 19973 0 15 13   00 00 00  usr sbin httpd  DFOREGROUND apache 19977 19973 0 15 13   00 00 00  usr sbin httpd  DFOREGROUND apache 19978 19973 0 15 13   00 00 00  usr sbin httpd  DFOREGROUND docker 1 13 1                                docker rm            docker rm  f                      docker   MountFlags slave                        docker 18 06 3 ce                             docker 18 06 3 ce          stupig hostname     sudo systemctl daemon reload  stupig hostname     sudo systemctl restart docker  stupig hostname     sudo docker run  d nginx 718114321d67a817c1498e530b943c2514ed4200f2d0d138880f8c345df7048f  stupig hostname     sudo systemctl restart httpd  stupig hostname     sudo docker stop 718114321d67a817c1498e530b943c2514ed4200f2d0d138880f8c345df7048f 718114321d67a817c1498e530b943c2514ed4200f2d0d138880f8c345df7048f  stupig hostname     sudo docker rm 718114321d67a817c1498e530b943c2514ed4200f2d0d138880f8c345df7048f 718114321d67a817c1498e530b943c2514ed4200f2d0d138880f8c345df7048f   docker 18 06 3 ce                                          docker 18 06 3 ce                                                 3                                      docker                                                       docker                     4                       docker 1 13 1  stupig hostname2     sudo docker run  d nginx 0fe8d412f99a53229ea0df3ec44c93496e150a39f724ea304adb7f924910d61b  stupig hostname2     sudo docker inspect  f    GraphDriver Data MergedDir   0fe8d412f99a53229ea0df3ec44c93496e150a39f724ea304adb7f924910d61b  home docker_rt overla",
        "objectID": "posts/docker-pod-terminating2",
        "date": "2020-10-31T02:51:39.000Z",
        "lastmod": "2020-10-31T02:51:39.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "docker",
            "terminating"
        ],
        "description": "",
        "tags": [
            "docker"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Dockerd内存泄露",
        "uri": "posts/dockerd-memory-leak1",
        "content": "dockerd             100G                  dockerd                         dockerd      10G    live restore     dockerd                                                 live restore  true     live restore  true    dockerd                   dockerd    debug                  docker        live restore  true               dockerd   tail  f  var log messages   grep dockerd              dockerd                      sandbox                               2        dockerd                                                    pprof     dockerd debug       etc docker daemon json   debug  true      dockerd     pprof                  go tool pprof http   ip port debug pprof heap   top                                              web      svg                                                            docker api     SubscribeTopic                                                      docker   tag v1 13 1               docker      github com docker docker pkg pubsub publisher go    SubscribeTopic adds new subscriber filters messages sent topic  func  p  Publisher  SubscribeTopic topic topicFunc  chan interface     ch    make chan interface    p buffer  p m Lock   p subscribers ch    topic p m Unlock   return ch             new    chan    chan                           p subscribers ch    topic         map                                      svg                        Subscribe adds new subscriber publisher returning channel  func  p  Publisher  Subscribe   chan interface            SubscribeTopic return p SubscribeTopic nil       collect registers container collector adds    event loop collection specified interval returning    channel subscriber receive on  func  s statsCollector  collect c container Container  chan interface     s m Lock   defer s m Unlock   publisher  exists    s publishers c   exists   publisher   pubsub NewPublisher 100 time Millisecond  1024  s publishers c    publisher          Subscribe return publisher Subscribe     func  daemon Daemon  subscribeToContainerStats c container Container  chan interface     return daemon statsCollector collect c       ContainerStats writes information container stream    given config object  func  daemon Daemon  ContainerStats ctx context Context  prefixOrName string  config backend ContainerStatsConfig  error          subscribe updates    daemon subscribeToContainerStats container     unsubscribe defer daemon unsubscribeToContainerStats container  updates  noStreamFirstFrame    true   select   case v  ok                  ds_agent                                  netns               demo                                                  docker  MountFlags slave   demo       dockerd                                 issue           issue   docker   linux          issue                   MountFlags    live restore                           docker MountFlags                                         api      api                                               ip        bug       netns                                                                                                  api       netstat                  IP Port          ip port            docker sock       docker     tcp                       api               fd            proc  dockerd s pid  fd                                                          unix socket peer          docker                   ss  a   unix  p   grep docker           dockerd    socket           socket                ss  a   unix  p   awk   6   219386905        u_str ESTAB 0 0    219386905    219569454 users    agent  pid 1962370 fd 55416           agent                              live restore  true          dockerd                                                                      dockerd    failed create osl candbox            collecting stats                                            stats     collecting stats          docker stats            dockerd         collecting stats                          unix socket           agent       1 18 1          1 18 1   agent      1 20 0             agent      master                stats func getContainerStats containerID string   threadNum int  err error    dockerClient    nil   dlog Error  dockerClient nil      return           context Background   resp  err    dockerClient ContainerStats context Background    containerID  false  err    nil   dlog Error err  return   var stats DockerStats err   json NewDecoder resp Body  Decode  stats  err    nil   return   threadNum   stats PidsStats Current return   func UpdateContainerStat     fp      home odin container host   file IsExist fp    return   dlog Info  UpdateContainerStat start      go CleanContainerInspectMap   var err error ContainerType  err   file ToString fp  err    nil   dlog Error  read file err    err  fp  return   GetMajorMinor   dockerClient  err   dockerclient NewEnvClient   err    nil   dlog Error err       10s t1    time NewTicker time Duration common DEFAULTINTERVAL common TYPEDOCKER     time Second    updateContainerStat",
        "objectID": "posts/dockerd-memory-leak1",
        "date": "2019-07-09T12:06:53.000Z",
        "lastmod": "2019-07-09T12:06:53.000Z",
        "draft": false,
        "keywords": [
            "docker",
            "泄露",
            "内存泄露",
            "leak",
            "memory leak"
        ],
        "description": "dockerd内存泄露",
        "tags": [
            "docker"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Dragonfly + Harbor实现的p2p镜像分发",
        "uri": "posts/dragonfly",
        "content": "10 0 13 19   harbor    docker compose      4 8G     10 0 13 22 dragonfly supernode   16 64G docker         10 0 13 31 dragonfly supernode   16 64G docker         kubernetes    20     docker storage driver overlay    dragonfly daemon dfget                       centos7 4           ansible      dragonfly      P2P                          CDN                        IO                               Http Header                         cluster manager      supernode        CDN           peer            dfget P2P           peer                              registry          dfget proxy   dfdaemon      docker pull docker push HTTP                    dfget                       cluster manager      supernode                  peer         peer    P2P                                                 1    docker pull    dfget proxy   docker pull         CM cluster manager   cm      client    etc dragonfly conf                dfget proxy    df daemon Dragonfly       client  getter python  daemon golang  docker pull  df daemon        dfget       server  supernode java   2 df daemon       registry       dfget     supernode supernode                  block                    supernode       client          block         client           server                       Dragonfly      Docker Physical Machine      server           docker      docker run  d  p 8001 8001  p 8002 8002   restart always registry cn hangzhou aliyuncs com alidragonfly supernode 0 2 0               0 1 0   wget https   github com alibaba Dragonfly raw master package df client linux amd64 tar gz     tar  zxvf df client linux amd64 tar gz    Env vim    bashrc              bashrc    PATH  PATH  root df client    vim        source    bashrc Harbor                  http     Harbor Harbor   1 2 2 1    wget https   storage googleapis com harbor releases harbor online installer v1 5 2 tgz tar  zxvf harbor online installer v1 5 2 tgz 2      cd harbor vim harbor cfg hostname 10 0 13 19          ip 3      harbor                Harbor              docker compose    sh install sh      1  client           CM cluster manager    vi  etc dragonfly conf      node  address 10 0 13 22 10 0 13 31 2     Dragonfly    harbor            configure daemon mirror                          docker proxy                1 vi  etc systemd system docker service d http proxy conf                   proxy                           Service  Environment  HTTP_PROXY http   127 0 0 1 65001   2      systemctl daemon reload 3  client    harbor insecure     etc docker daemon json insecure registries   10 0 13 19   disable legacy registry  false  graph    data docker   insecure registries    10 0 13 19    4   client   df daemon   registry http   10 0 13 19 5   docker systemctl restart docker 6 docker   docker login   username admin 10 0 13 19                7          65001        tcpdump  i lo port 65001      shell   docker pull 10 0 13 19 kaku bigimage v1 0            2 supernode 20                       native cost   dragonfly cost   native harbor     dragonfly harbor                                                                                                       1 28G   2m       1m30s     201 28   21 28     3 48G   10 m      5m30s     203 48   23 48     df    harbor         20           33       p2p                                                                         docker pull          df supernode 0 2 0   client 0 0 1      0 1 0 0 1 1   client           dragonfly harbor    P2P      https   github com alibaba Dragonfly issues 17 https   github com alibaba Dragonfly issues 20 https   github com alibaba Dragonfly issues 50 issuecomment 382286474",
        "objectID": "posts/dragonfly",
        "date": "2018-09-13T12:17:52.000Z",
        "lastmod": "2018-09-13T12:17:52.000Z",
        "draft": false,
        "keywords": [
            "docker",
            "harbor",
            "dragonfly",
            "蜻蜓",
            "p2p"
        ],
        "description": "docker image p2p",
        "tags": [
            "docker",
            "dragonfly"
        ],
        "categories": [
            "使用说明"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Etcd分布式锁加锁失败",
        "uri": "posts/etcd-lock",
        "content": "lock failed  context deadline exceeded  retry                               etcd          etcd           etcd   rejected connection  ip port   error  tls  first record does not look TLS handshake   ServerName                         IP       IP                          py03 etcd                          etcd      key         key  notifier locker  leaseid   notifier locker rwl  leaseid       key notifier         key               redis whitelist         key      notifier                   key         key            key   notifier                        etcd                             etcdctl lock            a b      a           a      a b                          etcd               etcd                                     etcd             etcdctl                                etcd                                client       etcdctl lock                    go etcd io etcd etcdctl ctlv3 command lock_command go func lockUntilSignal c  clientv3 Client  lockname string  cmdArgs   string  error       err    m Lock ctx   err    nil   return err               Lock           etcd              func  m  Mutex  Lock ctx context Context  error   s    m s client    m s Client         pfx  prefix             s Lease             int64     session   m myKey   fmt Sprintf   s x   m pfx  s Lease             prefix lease createrevision   0  0        key     Put               0        key       Get      createrevision     cmp    v3 Compare v3 CreateRevision m myKey        0     put self lock waiters via myKey  oldest waiter holds lock put    v3 OpPut m myKey      v3 WithLease s Lease        reuse key case session already holds lock    v3 OpGet m myKey             getOwner    v3 OpGet m pfx  v3 WithFirstCreate       resp  err    client Txn ctx  If cmp  Then put  getOwner  Else get  getOwner  Commit   err    nil   return err   m myRev   resp Header Revision  resp Succeeded   m myRev   resp Responses 0  GetResponseRange   Kvs 0  CreateRevision      no key prefix   minimum rev key  already hold lock ownerKey    resp Responses 1  GetResponseRange   Kvs                    owner createrevision     kv revision                len ownerKey     0    ownerKey 0  CreateRevision    m myRev   m hdr   resp Header return nil                     fmt Printf  ownerKey   s n   ownerKey                              revision    revision kv    hdr  werr    waitDeletes ctx  client  m pfx  m myRev 1     release lock key wait failed werr    nil   m Unlock client Ctx      else   m hdr   hdr   return werr      waitDeletes          key revision  key             func waitDeletes ctx context Context  client v3 Client  pfx string  maxCreateRev int64   pb ResponseHeader  error    getOpts    append v3 WithLastCreate    v3 WithMaxCreateRev maxCreateRev     resp  err    client Get ctx  pfx  getOpts     err    nil   return nil  err   len resp Kvs     0   return resp Header  nil   lastKey    string resp Kvs 0  Key                fmt Printf  wait  s delete n   lastKey  err   waitDelete ctx  client  lastKey  resp Header Revision   err    nil   return nil  err       func waitDelete ctx context Context  client  v3 Client  key string  rev int64  error   cctx  cancel    context WithCancel ctx  defer cancel   var wr v3 WatchResponse    wch  channel key        chan    wch    client Watch cctx  key  v3 WithRev rev   wr   range wch   _  ev    range wr Events   ev Type    mvccpb DELETE   return nil       err    wr Err    err    nil   return err   err    ctx Err    err    nil   return err   return fmt Errorf  lost watcher waiting delete                 etcd                      Prefix           getOwner             Put  Get      getOwner         getOwner options     v3 WithFirstCreate               WithFirstCreate gets key oldest creation revision request range  func WithFirstCreate     OpOption   return withTop SortByCreateRevision  SortAscend       withTop gets first key get s prefix given sort order func withTop target SortTarget  order SortOrder    OpOption   return   OpOption WithPrefix    WithSort target  order   WithLimit 1        WithPrefix enables  Get    Delete    Watch  requests operate    keys matching prefix  example   Get foo  WithPrefix        return  foo1    foo2   so on  func WithPrefix   OpOption   return func op  Op    len op key     0   op key  op end     byte 0     byte 0  return   op end   getPrefix op key                                      WithPrefix                getOwner             lockkey   kv       createrevision                             lockkey prefix  createrevision     key           key                  a b       a          getOwner      a b  createrevision   a revision    a     a b     watch chanel                                ab         a        a    ab prefix                            func NewMutex s Session  pfx string  Mutex   return  Mutex s  pfx             1  nil         NewMutex           pfx  prefix                    ab     a              prefix suffix                                          etcd                 etcd          client                      client                             etcd",
        "objectID": "posts/etcd-lock",
        "date": "2019-01-31T06:20:28.000Z",
        "lastmod": "2019-01-31T06:20:28.000Z",
        "draft": false,
        "keywords": [
            "etcd",
            "lock"
        ],
        "description": "etcd分布式锁加锁失败",
        "tags": [
            "etcd"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Etcd watch内存泄漏",
        "uri": "posts/etcd-watch",
        "content": "kube odin                           kube odin               golang          CPU  Memory           pprof            kube odin       net http pprof              go tool pprof httpaddress     kube odin           pprof                                                                  M       1G          newWatcherGrpcStream                           newWatcherGrpcStream       list                fmt Sprintf      86 01M       chan                  chan                                                                                          etcd                                     fmt Println                             Watch posts watch request run   waits new watcher channel func  w  watcher  Watch ctx context Context  key string  opts    OpOption  WatchChan       ctxKey    fmt Sprintf   v   ctx     find allocate appropriate grpc watch stream w mu Lock   w streams    nil      closed w mu Unlock   ch    make chan WatchResponse  close ch  return ch   fmt Println ctxKey          key fmt Println len w streams            wgs    w streams ctxKey  wgs    nil   fmt Println  new watcher stream             key wgs   w newWatcherGrpcStream ctx  w streams ctxKey    wgs  else  fmt Println  use exist watcher stream         key                 watcher implements Watcher interface type watcher struct   remote pb WatchClient    mu protects grpc streams map mu sync RWMutex    streams holds active grpc streams keyed ctx value  streams map string  watchGrpcStream           fmt Sprintf newWatcherGrpcStream             w streams   watch      fmt Sprintf   key                                                    func  w  watcher  Close    err error    w mu Lock   fmt Println  begin close watcher   streams    w streams w streams   nil w mu Unlock   _  wgs    range streams   werr    wgs Close    werr    nil   err   werr     return err   func  w watcher  closeStream wgs watchGrpcStream    w mu Lock   fmt Println  delete watch stream            close wgs donec  wgs cancel   w streams    nil   fmt Println  before delete   len w streams             fmt Println wgs ctxKey  _ ok  w streams wgs ctxKey  ok  fmt Println  delete key exist        key         else  fmt Println  delete key NOT exist        key          delete w streams  wgs ctxKey  fmt Println  after delete   len w streams                w mu Unlock                      Close     etcdclient                  lock unlock         etcdclient                closeStream                           closeStream     func  w watcher  newWatcherGrpcStream inctx context Context  watchGrpcStream       go wgs run   return wgs      run root goroutines managing watcher client func  w  watchGrpcStream  run         defer func         w owner closeStream w                                       demo      demo     func main     client    instance GetEtcdClient   locker    lock New client  lock WithTTL 1 time Second   go foo locker  http HandleFunc   gc   func writer http ResponseWriter  request  http Request    runtime GC      http ListenAndServe   8080   nil    func foo locker lock Locker    ticker    time NewTicker 1   time Second  ids      string  1    2    3    4    5    6    7    8    9    10   range ticker C   _  v    range ids   go func i string    unlock  _  err    locker Trylock context TODO    fmt Sprintf   s  s     kaku test etcd lock   i   err    nil   err    context DeadlineExceeded   fmt Println  lock task failed  s   err    return     fmt Println  task locked   defer func     time Sleep time Second  unlock     fmt Println  task unlocked         v                   lock unlock                   demo      context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293267  0800 CST m  3 078016721  750 274218ms   WithCancel 0 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293375  0800 CST m  3 078124824  704 968531ms   WithCancel 1 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293271  0800 CST m  3 078020710  704 72989ms   WithCancel 2 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293342  0800 CST m  3 078090947  704 058853ms   WithCancel 3 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293275  0800 CST m  3 078023966  703 750266ms   WithCancel 4 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293282  0800 CST m  3 078031664  703 519141ms   WithCancel 5 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293339  0800 CST m  3 078088098  702 930648ms   WithCancel 6 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293454  0800 CST m  3 078203813  688 620812ms   WithCancel 7 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293371  0800 CST m  3 078120807  688 102422ms   WithCancel 8 new watcher stream context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293341  0800 CST m  3 078090285  688 007852ms   WithCancel 9 new watcher stream delete watch stream delete  10 context TODO WithCancel WithDeadline 2019 01 27 12 03 04 293282  0800 CST m  3 078031664  703 500369ms   WithCancel delete key NOT exist",
        "objectID": "posts/etcd-watch",
        "date": "2019-01-31T06:20:39.000Z",
        "lastmod": "2019-01-31T06:20:39.000Z",
        "draft": false,
        "keywords": [
            "etcd",
            "watch",
            "leak"
        ],
        "description": "etcd watch内存泄露",
        "tags": [
            "etcd"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "通用Restful API项目模板",
        "uri": "posts/generic-project-template",
        "content": "Restful API               Go        Restful API     SOLID            service pattern go    Gin Gorm Testify  Test   Mock framework  Mockery  Mock generator  Hystrix Go  Circuit Breaker                Mocking Tesing                git clone https   github com likakuli generic project template git   mysql          docker run   name mysql  it  p 3306 3306  e MYSQLROOTPASSWORD 123456  d registry cn beijing aliyuncs com likakuli mysql        MacOS   Docker Mac            docker connector             IP                      docker connector brew install wenjunxiao brew docker connector   docker     bridge           docker network ls   filter driver bridge   format     ID      xargs docker network inspect   format  route   range  IPAM Config     Subnet    end        usr local etc docker connector conf      sudo brew services start docker connector   docker     wenjunxiao mac docker connector      host         NET_ADMIN docker run  it  d   restart always   net host   cap add NET_ADMIN   name connector wenjunxiao mac docker connector       Dockerfile sql   docker            test      build            MySQL connectionString   docker replace_ip sh        generic project template   config   conf config toml   log_dir   logs   v 1      curl http   localhost 8080 api v1 score Lucy vs Lily             Restful API          Mocking                  Restful API                                              Mock                   IPlayerServie     IPlayerRepository type PlayerController struct   service interfaces IPlayerService   type playerService struct   repo interfaces IPlayerRepository         cmd    apiserver  conf  pkg    config    controllers    interfaces    models    repositories    server    middlewares    container go    router go    server go    services    viewmodels controllers            Gin Route Handler        Request Response                         interfaces  IService             interafces           IService IRepository       Mockery                          models                         Go Struct                       gen                     repositories                       interfaces    IRepository       models             services              services    IService       controllers                       interfaces  IRepository                viewmodels                API           API               models         api            router                     Restful API         container                  Provider                      Mocking             Mockery  interfaces          IPlayerService         interfaces                 interfaces     mocks               mockery  name IPlayerService       mokery   Testing        Mock                               serviceshecontrollers               x  Tracing  x  PProf  x  Prometheus Metrics  x  Health Check  x  Mock  x  Testing  x  Circuit Breaker  x  Rate Limit x  Common  go utils",
        "objectID": "posts/generic-project-template",
        "date": "2021-05-11T07:47:58.000Z",
        "lastmod": "2021-05-11T07:47:58.000Z",
        "draft": false,
        "keywords": [
            "Restful api",
            "template",
            "Golang"
        ],
        "description": "",
        "tags": [
            "Golang",
            "Resetful API"
        ],
        "categories": [
            "使用说明"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Golang监控",
        "uri": "posts/golang-monitor",
        "content": "golang                            expvar go   runtime          goroutine              go                  go                              expvar  expvar                     JSON       debug vars     HTTP                             metricBeat ES Kibana                    gin             web                           GIN HTTP web framework   package main import    expvar   github com gin gonic gin   net http   net http pprof   time    func main     router    gin Default   router GET   debug vars   monitor GetCurrentRunningStats  s     http Server  Addr    9090   Handler  router  ReadTimeout  5   time Second  WriteTimeout  5   time Second  MaxHeaderBytes  1   20    s ListenAndServe        handler package monitor import    encoding json   expvar   fmt   github com gin gonic gin   net http   runtime   time            var start   time Now      calculateUptime        func calculateUptime   interface     return time Since start  String        currentGoVersion    Golang    func currentGoVersion   interface     return runtime Version        getNumCPUs    CPU      func getNumCPUs   interface     return runtime NumCPU        getGoOS        func getGoOS   interface     return runtime GOOS      getNumGoroutins    goroutine    func getNumGoroutins   interface     return runtime NumGoroutine        getNumCgoCall CGo      func getNumCgoCall   interface     return runtime NumCgoCall     var lastPause uint32    getLastGCPauseTime      GC       func getLastGCPauseTime   interface     var gcPause uint64 ms    new runtime MemStats  statString    expvar Get  memstats   String   statString         json Unmarshal   byte statString   ms  lastPause    0    lastPause    ms NumGC   gcPause   ms PauseNs  ms NumGC 255  256  lastPause   ms NumGC     return gcPause      GetCurrentRunningStats          func GetCurrentRunningStats c  gin Context    c Writer Header   Set  Content Type    application json  charset utf 8   first    true report    func key string  value interface       first   fmt Fprintf c Writer     n     first   false str  ok    value  string   ok   fmt Fprintf c Writer    q   q   key  str    else   fmt Fprintf c Writer    q   v   key  value      fmt Fprintf c Writer     n   expvar Do func kv expvar KeyValue    report kv Key  kv Value     fmt Fprintf c Writer    n  n   c String http StatusOK        func init                      expvar         expvar                 expvar Publish         expvar Func calculateUptime   expvar Publish  version   expvar Func currentGoVersion   expvar Publish  cores   expvar Func getNumCPUs   expvar Publish  os   expvar Func getGoOS   expvar Publish  cgo   expvar Func getNumCgoCall   expvar Publish  goroutine   expvar Func getNumGoroutins   expvar Publish  gcpause   expvar Func getLastGCPauseTime            http   localhost 9090 debug vars         expvar                               memstats   memstats                              GC                 type MemStats struct      General statistics     Alloc bytes allocated heap objects        HeapAlloc  see below   Alloc uint64    TotalAlloc cumulative bytes allocated heap objects        TotalAlloc increases heap objects allocated     unlike Alloc HeapAlloc  does not decrease when    objects freed  TotalAlloc uint64    Sys total bytes memory obtained OS        Sys sum XSys fields below  Sys measures    virtual address space reserved Go runtime    heap  stacks  internal data structures  It s    likely not virtual address space backed    physical memory given moment  though general    point  Sys uint64    Lookups number pointer lookups performed    runtime        primarily useful debugging runtime internals  Lookups uint64    Mallocs cumulative count heap objects allocated     number live objects Mallocs   Frees  Mallocs uint64    Frees cumulative count heap objects freed  Frees uint64    Heap memory statistics        Interpreting heap statistics requires knowledge    Go organizes memory  Go divides virtual address    space heap  spans   contiguous    regions memory 8K larger  span may one    three states         idle  span contains no objects data     physical memory backing idle span released back    OS  but virtual address space is      converted  in use   stack  span         in use  span contains least one heap object may    free space available allocate heap objects         stack  span used goroutine stacks  Stack spans    not considered part heap  span change    heap stack memory  used    simultaneously     HeapAlloc bytes allocated heap objects         Allocated  heap objects include reachable objects     unreachable objects garbage collector    not yet freed  Specifically  HeapAlloc increases heap    objects allocated decreases heap swept    unreachable objects freed  Sweeping occurs    incrementally GC cycles  so two processes    occur simultaneously  result HeapAlloc tends    change smoothly  in contrast sawtooth    typical stop the world garbage collectors   HeapAlloc uint64    HeapSys bytes heap memory obtained OS        HeapSys measures amount virtual address space    reserved heap  includes virtual address space    reserved not yet used  consumes no    p",
        "objectID": "posts/golang-monitor",
        "date": "2018-07-01T14:35:22.000Z",
        "lastmod": "2018-07-01T14:35:22.000Z",
        "draft": false,
        "keywords": [
            "golang",
            "pprof",
            "prometheus"
        ],
        "description": "golang监控",
        "tags": [
            "golang"
        ],
        "categories": [
            "使用说明"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Golang netpoll源码分析",
        "uri": "posts/golang-netpoll",
        "content": "go             io        go                    io      linux     epoll   windows       iocp         linux                  runtime netpoll go runtime netpoll_epoll go runtime proc go net fd_unix go internal poll fdpollruntime go internal poll fd_unix go                                    io     go                                io    select poll epoll goroutine                         v1 10 2  golang   epoll                                        netFD      netFD   Sysfd pollDesc         netFD     EAGAIN        goroutine     netFD   pollDesc     goroutine park      netFD             goroutine   ready                   goroutine                epoll        netFD      Listen     Listener        listener Accept     Conn                 netFD netFD     poll FD      poll FD            Sysfd pollDesc                                                             netFD listen    epoll      listenFD  epoll      netFD accept     connFD   epoll      netFD      syscall EAGAIN     pollDesc    goroutine park    ready  pollDesc waitRead              type TCPListener struct   fd  netFD   type conn struct   fd  netFD      Network file descriptor  type netFD struct   pfd poll FD    immutable until Close family int sotype int isConnected bool net string laddr Addr raddr Addr      FD file descriptor  net os packages use type    field larger type representing network connection OS file  type FD struct      Lock sysfd serialize access Read Write methods  fdmu fdMutex    System file descriptor  Immutable until Close             Sysfd int    I O poller  pd pollDesc    Writev cache  iovecs    syscall Iovec    Semaphore signaled when file closed  csema uint32    Whether streaming descriptor  opposed    packet based descriptor UDP socket  Immutable  IsStream bool    Whether zero byte read indicates EOF  false    message based socket connection  ZeroReadIsEOF bool    Whether file rather network socket  isFile bool    Whether file set blocking mode  isBlocking bool   pollDesc      net conn              poll FD      poll FD         poll pollDesc        type pollDesc struct   runtimeCtx uintptr                                        runtime pollDesc          Network poller descriptor        No heap pointers       go notinheap type pollDesc struct   link  pollDesc    pollcache  protected pollcache lock    lock protects pollOpen  pollSetDeadline  pollUnblock deadlineimpl operations     fully covers seq  rt wt variables  fd constant throughout PollDesc lifetime     pollReset  pollWait  pollWaitCanceled runtime netpollready  IO readiness notification     proceed w o taking lock  So closing  rg  rd  wg wd manipulated    lock free operations     NOTE dvyukov   following code uses uintptr store  g  rg wg      will blow when GC starts moving objects  lock mutex    protects following fields fd uintptr closing bool seq uintptr    protects stale timers ready notifications rg uintptr    pdReady  pdWait  G waiting read nil rt timer    read deadline timer  set rt f    nil  rd int64    read deadline wg uintptr    pdReady  pdWait  G waiting write nil wt timer    write deadline timer wd int64    write deadline user uint32    user settable cookie   runtime pollDesc                   runtime pollDesc    go                                runtime pollDesc   runtime pollCache          type pollCache struct   lock mutex first  pollDesc    PollDesc objects type stable     ready notification epoll kqueue    descriptor closed reused     Stale notifications detected using seq variable     seq incremented when deadlines changed descriptor reused     tcp         Listen Accept      Listen func Listen network  address string   Listener  error    addrs  err    DefaultResolver resolveAddrList context Background     listen   network  address  nil  err    nil   return nil   OpError Op   listen   Net  network  Source  nil  Addr  nil  Err  err    var l Listener switch la    addrs first isIPv4   type    case  TCPAddr  l  err   ListenTCP network  la  case  UnixAddr  l  err   ListenUnix network  la  default  return nil   OpError Op   listen   Net  network  Source  nil  Addr  la  Err   AddrError Err   unexpected address type   Addr  address     err    nil   return nil  err    l non nil interface containing nil pointer   return l  nil      ListenTCP acts Listen TCP networks        network TCP network name  func Dial details        IP field laddr nil unspecified IP address     ListenTCP listens available unicast anycast IP addresses    local system     Port field laddr 0  port number automatically    chosen  func ListenTCP network string  laddr TCPAddr   TCPListener  error    switch network   case  tcp    tcp4    tcp6   default  return nil   OpError Op   listen   Net  network  Source  nil  Addr  laddr opAddr    Err  UnknownNetworkError network     laddr    nil   laddr    TCPAddr     ln  err    listenTCP context Background    network  laddr  err    nil   return nil   OpError Op   listen   Net  network  Source  nil  Addr  laddr opAddr    Err  err    return ln  nil        net Listen  tcp  addr     address     ListenTCP      ListenTCP              listenTCP        func listenTCP ctx context Context  net",
        "objectID": "posts/golang-netpoll",
        "date": "2018-06-10T05:59:38.000Z",
        "lastmod": "2018-06-21T15:10:36.000Z",
        "draft": false,
        "keywords": [
            "golang",
            "netpoll",
            "io"
        ],
        "description": "golang netpoll 源码分析",
        "tags": [
            "golang",
            "netpoll"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "容器开启特权模式后无法通过cadvisor获取GPU metrics指标",
        "uri": "posts/gpu-metrics-not-display",
        "content": "privileged        nvidia GPU      cAdvisor  GPU   metrics   Google         Issue  2018         Open    cAdvisor                                           cAdvisor             gpu       curl localhost 4194 api v1 3 docker  containerID             gpu                     gpu                           root node1  curl localhost 4194 api v1 3 docker a0f3c54d8c6beba5d9947723494e4c9b625f03ce4eb0c096e4cf46cae9e389e0   jq     stats 0  accelerators      make    nvidia    model    Tesla T4    id    GPU a2d26dd1 5a8f 35e5 c325 2cd0756d5ed2    memory_total   15843721216   memory_used   15127085056   duty_cycle   6       make    nvidia    model    Tesla T4    id    GPU febe3f91 914e cb7f bf0a d96ffeda2777    memory_total   15843721216   memory_used   11367940096   duty_cycle   44                GPU                          cAdvisor          cAdvisor  gpu                           cAdvisor                             GPU         cAdvisor               device  dev nvidia0  dev nvidia0                                privileged                              GPU   Feature   Bug            cAdvisor                           cAdvisor     privileged     Docker v17 04 0 ce                device cgroup rule  c 195   mrw           device  dev nvidiactl  dev nvidiactl  dev nvidia0  dev nvidia0  dev nvidia1  dev nvidia1                                 GPU                      cAdvisor     In Tree           GPU      Out Of Tree                       GPU         cAdvisor                                 cAdvisor         cAdvisor                                  watch cgroup                          ID             containerHandler    ID             watch       docker        docker API    ID                    Env                                      collector          nvidia      nvidiaCollector                                                          accelerators        nvidia go        GetCollector returns collector fetch NVIDIA gpu metrics NVIDIA devices    present devices list file given devicesCgroupPath  func  nm  nvidiaManager  GetCollector devicesCgroupPath string   stats Collector  error    nc     nvidiaCollector    nm devicesPresent   return  stats NoopCollector    nil      Makes sure don t call initializeNVML   concurrently    call initializeNVML   when it s not initialized  nm Lock    nm nvmlInitialized   err    initializeNVML nm  err    nil   nm Unlock   return  stats NoopCollector    err     nm Unlock   len nm nvidiaDevices     0   return  stats NoopCollector    nil       cgroup          nvidia         gpu     nvidiaMinorNumbers  err    parseDevicesCgroup devicesCgroupPath  err    nil   return  stats NoopCollector    err   _  minor    range nvidiaMinorNumbers   device  ok    nm nvidiaDevices minor   ok   return  stats NoopCollector    fmt Errorf  NVIDIA device minor number  d not found cached devices   minor    nc devices   append nc devices  device    return nc  nil              NVML   C   API        nvidia          nvidia smi                parseDevicesCgroup            GPU                               parseDevicesCgroup  device cgroup  devices list             GPU   minor                     nvidia             devices list           var parseDevicesCgroup   func devicesCgroupPath string     int  error       Always return non nil slice nvidiaMinorNumbers      int   devicesList    filepath Join devicesCgroupPath   devices list   f  err    os Open devicesList  err    nil   return nvidiaMinorNumbers  fmt Errorf  error opening devices cgroup file  q   v   devicesList  err    defer f Close   s    bufio NewScanner f     https   www kernel org doc Documentation cgroup v1 devices txt file format s Scan     text    s Text   fields    strings Fields text  len fields     3   return nvidiaMinorNumbers  fmt Errorf  invalid devices cgroup entry  q  contain three whitespace separated fields   text       Split second field find major minor numbers majorMinor    strings Split fields 1        len majorMinor     2   return nvidiaMinorNumbers  fmt Errorf  invalid devices cgroup entry  q  second field one colon   text       NVIDIA graphics devices character devices major number 195     https   github com torvalds linux blob v4 13 Documentation admin guide devices txt L2583 fields 0      c     majorMinor 0      195    minorNumber  err    strconv Atoi majorMinor 1   err    nil   return nvidiaMinorNumbers  fmt Errorf  invalid devices cgroup entry  q  minor number not integer   text       don t want devices nvidiactl  195 255  nvidia modeset  195 254  minorNumber   128   nvidiaMinorNumbers   append nvidiaMinorNumbers  minorNumber       ignoring  195    case    container access NVIDIA devices machine       ignoring     case    container access devices machine    return nvidiaMinorNumbers  nil                    linux       https   www kernel org doc Documentation cgroup v1 devices txt https   github com torvalds linux blob v4 13 Documentation admin guide devices txt L2583       cgroup v1 device                  device                                            device cgroup    device                                     c char  b block  a all      rwm     read writ",
        "objectID": "posts/gpu-metrics-not-display",
        "date": "2021-05-30T06:23:23.000Z",
        "lastmod": "2021-05-30T06:23:23.000Z",
        "draft": false,
        "keywords": [
            "docker",
            "cadvisor",
            "privilege"
        ],
        "description": "",
        "tags": [
            "docker",
            "gpu",
            "cadvisor"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "容器开启特权模式后无法通过cadvisor获取GPU metrics指标",
        "uri": "posts/gpu-metrics-not-display2",
        "content": "privileged        nvidia GPU      cAdvisor  GPU   metrics   Google         Issue  2018         Open    cAdvisor                                            cAdvisor           GPU                      cAdvisor          GPU                              devices list                     GPU                                         devics lists              device cgroup        devices allow devices deny      devices list      device      device whitelist                                                     whitelist     devices allow               devices deny                  devices list                 devices allow devices deny               devices allow devices deny          nvidia container runtime webhook   github    nvidia container toolkit             kubelet device plugin  containerd  runC nvidia container runtime nvidia container runtime hook            docker                                                                    Docker Engine  rpc containerd   containerd  rpc containerd shim      containerd shim  runC             runC     OCI Open Container Initiative  OCI                                 runtime spec image spce   runC   runtime spec                      nvidia container runtime          GPU      runtime spec            runC        nvidia container runtime  runC     runC                       create                                init                          ns cgroups  seccomp  apparmor  caps   start          init                 nvidia container runtime   nvidia container runtime     runtime spec      PreStart Hook      runc start                  nviadia container runtime hook          GPU      device cgroup         C C       nvidia container cli libnvidia container            prestart hook            OCI spec     start        runc        init          start nvidia container runtime hook    runtime spec         NVIDIAVISIBLEDEVICES             GPU  ID    nvidia container cli configure   device ID s                       GPU     device cgroup                     OCI hook spec             GPU  ID     NVIDIAVISIBLEDEVICES                                         NVIDIAVISIBLEDEVICES     Kubernetes       device plugin   beta 1 10                 Kubelet   Kubelet   Kube apiserver      Kubernetes              GPU     NIC FPGA  InfiniBand                                              device plugin    Kubelet Kubelet  watchdevice plugin            Kubelet  device plugin   Allocate    Pod       Kubelet        Pod              checkpoint             Kubelet            KubeletPodResource      Kubulet     rpc       pod resources         https   kubernetes io zh docs concepts extend kubernetes compute storage net device plugins                            GPU              Kubelet         nidia   k8s device plugin                            Constants represent various device list strategies const   DeviceListStrategyEnvvar    envvar  DeviceListStrategyVolumeMounts    volume mounts       migStrategyNone func  s migStrategyNone  GetPlugins     NvidiaDevicePlugin   return    NvidiaDevicePlugin  NewNvidiaDevicePlugin   nvidia com gpu   NewGpuDeviceManager false      Enumerate device even MIG enabled  NVIDIAVISIBLEDEVICES   gpuallocator NewBestEffortPolicy    pluginapi DevicePluginPath  nvidia gpu sock           Allocate return list devices  func  m NvidiaDevicePlugin  Allocate ctx context Context  reqs pluginapi AllocateRequest    pluginapi AllocateResponse  error    responses    pluginapi AllocateResponse   _  req    range reqs ContainerRequests   _  id    range req DevicesIDs    m deviceExists id    return nil  fmt Errorf  invalid allocation request   s   unknown device   s   m resourceName  id      response    pluginapi ContainerAllocateResponse   uuids    req DevicesIDs deviceIDs    m deviceIDsFromUUIDs uuids        DeviceListStrategyEnvvar m deviceListEnvvar    NVIDIAVISIBLEDEVICES deviceListStrategyFlag    DeviceListStrategyEnvvar   response Envs   m apiEnvs m deviceListEnvvar  deviceIDs    deviceListStrategyFlag    DeviceListStrategyVolumeMounts   response Envs   m apiEnvs m deviceListEnvvar    string deviceListAsVolumeMountsContainerPathRoot   response Mounts   m apiMounts deviceIDs    passDeviceSpecsFlag   response Devices   m apiDeviceSpecs nvidiaDriverRootFlag  uuids    responses ContainerResponses   append responses ContainerResponses   response    return  responses  nil            Kubelet  Allocate    k8s device plugin response Env                          GPU                          devices list         NVIDIAVISIBLEDEVICES       nvidia container cli  device cgroup                 device cgroup             runc        nvidia container runtime hook                  device cgroup      runc int               cgroup               cgroup      cgroup        create            linux     init                        create  cgroup                    func CreateCgroupConfig opts CreateOpts   configs Cgroup  error           rootless containers  attempt cgroup changes likely fail     libcontainer will validate ignores error  c Resources AllowedDevices   AllowedDevices spec Linux    nil   r    spec Linux Resources r    ni",
        "objectID": "posts/gpu-metrics-not-display2",
        "date": "2021-05-30T06:23:24.000Z",
        "lastmod": "2021-05-30T06:23:23.000Z",
        "draft": false,
        "keywords": [
            "docker",
            "cadvisor",
            "privilege"
        ],
        "description": "",
        "tags": [
            "docker",
            "gpu",
            "cadvisor"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "容器开启特权模式后无法通过cadvisor获取GPU metrics指标",
        "uri": "posts/gpu-metrics-not-display3",
        "content": "privileged        nvidia GPU      cAdvisor  GPU   metrics   Google         Issue  2018         Open    cAdvisor                                                                 cadvisor  GPU metrics                cadvisor  GPU metrics                     NVIDIA GPU       Kubelet   Device Plugin Nvidia container runtime          cAdvisor          GPU         cAdvisor                                  device cgroup        GPU    containerd                                    a   rwm        GPU                      Env     GPU                         device plugin Pod spec   Env     GPU           nvidia k8s deivice plugin                                  GPU                               GPU                                      container runtime                   CDI                                      GPU                             GPU       k8s device plugin    GPU         deviceIDStrategyFlag      index uuid         index           cAdvisor   index     device cgroup                      uuid     cAdvisor       GPU       Pod Resource Kubelet   pod resource       rpc                   Kubelet                cAdvisor Kubelet         In Tree       Out Of Tree       OCI spec cAdvisor          OCI spec            GPU                  cAdvisor    cAdvisor           GPU          GPU    k8s device plugin                GPU      Env Volume Mount          GPU                 Mig Strategy               GPU                 None    MIG   Single   MIG     GPU                Mixed   MIG   GPU                         GPU                   GPU            k8s device plugin          Allocate",
        "objectID": "posts/gpu-metrics-not-display3",
        "date": "2021-05-30T06:23:25.000Z",
        "lastmod": "2021-05-30T06:23:23.000Z",
        "draft": false,
        "keywords": [
            "docker",
            "cadvisor",
            "privilege"
        ],
        "description": "",
        "tags": [
            "docker",
            "gpu",
            "cadvisor"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "你真的搞懂 Informer 了吗？",
        "uri": "posts/informer1",
        "content": "v 126    Informer    client go                                         Informer         Informer                         Informer                                                                                                                     Informer                                                      Informer           Informer vs SharedInformer     shared                 Resync Informer           HasSynced    true            NamespacedName    key                       ResourceEventHandler                                                           shared    Reflector          k8s                SharedInformer SharedInformer      Store             Queue              Resync          kube apiserver      Informer   Resync                   Informer HasSynced    true         event handler           SharedInformer     Queue Reflector Store           Pop             Indexer             processorListener             event handler                     ID       NamespacedName                                                                                        Informer               SharedInformer                     ResourceEventHandler       Informer ResourceEventHandler          Informer                     SharedInformer              ResourceEventHandler     SharedProcessor     SharedProcessor     SharedInformer    Shared                    Reflector Store                  Informer                         SharedInformer                           Resync      Reflector Store     DeltaFIFO   KnownObjects      Queue        x  HasSynced                       k8s                  chan     RingBuffer                                     client go                  dispatcher     Informer    HasSynced    true          ResourceEventHandler                  SharedInformer          7      7                              ResourceEventHandler                                    SharedInformer                                                 Pod                                                            PR 113985          v1 27              ResourceEventHandler    HasSynced                                  ResourceEventHandler   HasSynced     NamespacedName         SharedInformer    Pod1   Add       Pod1     Store    SharedInformer   Kubernetes API            ResourceVersion1     Pod1                 ResourceVersion2  Etcd       ResourceVersion2             SharedInformer            ResourceVersion1   ResourceVersion2           SharedInformer     Pod1 Delete                   Pod1                 Pod1 NamespacedName     Store                    Update                         Delete Add            UID                                                                   Update               UID          Update    Delete   Add                                                                                 Informer                              APIServer                           APIServer OOM             Watch                APIServer",
        "objectID": "posts/informer1",
        "date": "2023-10-13T16:13:59.000Z",
        "lastmod": "2023-10-13T16:13:59.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "informer"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Knative组件镜像制作",
        "uri": "posts/knative-build",
        "content": "knative 0 14 0          serverless                                                           knative                              github        Dockerfile               image    Dockerfile           shell            docker history   no trunc 8b13dd01e81b   tac   tr  s       cut  d      f 5    sed  s   bin sh  c   nop    g    sed  s   bin sh  c RUN g    sed  s       n    g    sed  s  s 0 9      0 9  s kMG B s    g    head  n  1 bazel build     ko publish knative dev net istio cmd webhook 463kB kodata contents   KODATAPATH ko publish knative dev net istio cmd webhook 52 9MB go build output   ko app webhook WTF         Dockerfile           google   google   bazel                            ko yaml                     google   ko               ko    diamante               k8s               google               load        push    k8s        local                                                                                           knative    0 14 0",
        "objectID": "posts/knative-build",
        "date": "2020-07-09T13:00:16.000Z",
        "lastmod": "2020-07-09T13:00:16.000Z",
        "draft": false,
        "keywords": [
            "knative",
            "image",
            "build"
        ],
        "description": "knative build docker image",
        "tags": [
            "knative"
        ],
        "categories": [
            "使用说明"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Knative健康检查",
        "uri": "posts/knative-healthcheck",
        "content": "knative 0 14 0                                                          ksvc     IngressNotConfigured                                             200      404 func  m Prober  probeVerifier item workItem  prober Verifier   return func r  http Response  _   byte   bool  error       happy path  probe request forwarded Activator Queue Proxy response  HTTP 200     contains  K Network Hash  header compared expected hash  hashes match     probing successful  don t match  new probe will sent later     HTTP 404 503 expected case creation new Knative service rules will    not present Envoy config until new VirtualService applied     No information extracted scenario  e g  HTTP 302   therefore case     probing assumed successful better say Ingress Ready    actually Ready marking Ready  best effort  switch r StatusCode   case http StatusOK  hash    r Header Get network HashHeaderName  switch hash   case     m logger Errorf  Probing  s abandoned  IP   s  s  response doesn t contain  q header   item url  item podIP  item podPort  network HashHeaderName  return true  nil case item ingressState hash  return true  nil default  m logger Warnf  unexpected hash  want  q   q   item ingressState hash  hash  return true  nil                     200      404 case http StatusNotFound  http StatusServiceUnavailable  return false  fmt Errorf  unexpected status code  want  v   v   http StatusOK  http StatusNotFound  default  m logger Errorf  Probing  s abandoned  IP   s  s  response status  v  expected 200 404   item url  item podIP  item podPort  r StatusCode  return true  nil                                  USN           Url      USN                                      processWorkItem processes single work item workQueue     returns false when no items process  true otherwise  func  m  Prober  processWorkItem   bool          probePath  healthz probeURL Path   path Join probeURL Path  probePath  ok  err    prober Do  item context  transport  probeURL String    prober WithHeader network UserAgentKey  network IngressReadinessUserAgent   prober WithHeader network ProbeHeaderName  network ProbeHeaderValue   m probeVerifier item                     Path   heathz                          wotkitem     USN   path    func  l gatewayPodTargetLister  ListProbeTargets ctx context Context  ing v1alpha1 Ingress     status ProbeTarget  error           Use sorted hosts list consistent ordering  i  host    range gatewayHosts gatewayName  List     newURL     target URLs 0  newURL Host   host         target Port var usn string ing Annotations    nil   usn   ing Annotations  serverless kakuchuxing com usn     newURL Path   path Join newURL Path  usn  qualifiedTarget URLs i     newURL                                                              k8s",
        "objectID": "posts/knative-healthcheck",
        "date": "2020-08-20T05:26:19.000Z",
        "lastmod": "2020-08-20T05:26:19.000Z",
        "draft": false,
        "keywords": [
            "knative",
            "health check",
            "IngressNotConfigured"
        ],
        "description": "knative健康检查",
        "tags": [
            "knative"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Knative通过外部域名访问集群内服务",
        "uri": "posts/knative-ingress-gateway",
        "content": "knative 0 14 0                                                 serverless                       PATH                          IP PORT        helloworld   curl  v  H  Host  api test sls intra kaku com  http   api test sls intra kaku com  Trying 10 88 128 112    TCP_NODELAY set Connected api test sls intra kaku com  10 88 128 112  port 80   0      HTTP 1 1   Host  api test sls intra kaku com   User Agent  curl 7 54 0   Accept        HTTP 1 1   Host api test sls intra kaku com   User Agent  curl 7 54 0   Accept      configuration     revision     deployment               ksvc     route     king    virtualservice                               istio  vs         vs                  spec hosts   spec http match authority                         spec hosts    spec http match authority                            MutatingWebhook                  net istio controller  webhook    net istio webhook              webhook                          virtualservice          mutate                controller        MutatingWebhookConfiguration            var types   map schema GroupVersionKind resourcesemantics GenericCRD  appsv1 SchemeGroupVersion WithKind  Deployment     defaults IstioDeployment    v1alpha3 SchemeGroupVersion WithKind  VirtualService     defaults IstioVirtualService         pkg defaults virtualservice_default go    match authority   package defaults import    context   istio io client go pkg apis networking v1alpha3   knative dev pkg apis    type IstioVirtualService struct   v1alpha3 VirtualService json   inline    func  vs IstioVirtualService  Validate context Context  apis FieldError   return nil   func  vs  IstioVirtualService  SetDefaults ctx context Context    _  http    range vs Spec Http   _  match    range http Match   match Authority   nil                                     Pod Image                vs   vs         vs wtf                     kube apiserver         vs   webhook   webhook                 deployment          webhook                                                             vs  king         king         king  vs              domains         annotation          hosts      annotation     MakeIngressSpec creates new IngressSpec func MakeIngressSpec  ctx context Context  r  servingv1 Route  tls   v1alpha1 IngressTLS  targets map string traffic RevisionTargets  visibility map string netv1alpha1 IngressVisibility  acmeChallenges    v1alpha1 HTTP01Challenge     v1alpha1 IngressSpec  error           add custom external domains customHostStr    r Annotations  serverless kakuchuxing com domains   sort Sort sort Reverse sort StringSlice names    len customHostStr    0   customHosts    strings Split customHostStr       _  name    range names   name     default    visibility    netv1alpha1 IngressVisibilityExternalIP rule     makeIngressRule customHosts  r Namespace  visibility  name  targets name      public rule  need configure ACME challenge paths  rule HTTP Paths   append  makeACMEIngressPaths challengeHosts  customHosts   rule HTTP Paths     rules   append rules  rule                  ksvc      annotaiton                          vs   vs                               HelloWorld                            webhook                webhook        k8s  webhook                      knative                         ksvc                      ksvc                           ksvc                   knative",
        "objectID": "posts/knative-ingress-gateway",
        "date": "2020-07-09T13:00:07.000Z",
        "lastmod": "2020-07-09T13:00:07.000Z",
        "draft": false,
        "keywords": [
            "knative",
            "domain",
            "gateway"
        ],
        "description": "通过外部域名访问knative集群内的服务",
        "tags": [
            "knative"
        ],
        "categories": [
            "定制开发"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Knative根据Path转发请求",
        "uri": "posts/knative-pathfilter",
        "content": "knative 0 14 0                                                 serverless                       PATH                     knative                                                               knative                   Path                              Path              ksvc        Path                                                    USN   USN         knative     Path        rewrite url  USN                   USN                            vs       Path             ksvc             king  vs             destination   url rewrite     func makeVirtualServiceSpec ing v1alpha1 Ingress  gateways map v1alpha1 IngressVisibility sets String  hosts sets String  istiov1alpha3 VirtualService   spec    istiov1alpha3 VirtualService  Hosts  hosts List               usn    ing Annotations  serverless kakuchuxing com usn   usn         usn         strings Trim usn               gw    sets String   _  rule    range ing Spec Rules   _  p    range rule HTTP Paths   hosts    hosts Intersection sets NewString rule Hosts      hosts Len      0   http    makeVirtualServiceRoute hosts  usn   p  gateways  rule Visibility     Add Gateways exist inside http match section    VirtualService     ensures using Gateways actually appear    VirtualService routes  _  m    range http Match   gw   gw Union sets NewString m Gateways           rewrite path       USN usn         http Rewrite    nil   http Rewrite    istiov1alpha3 HTTPRewrite     http Rewrite Uri         spec Http   append spec Http  http        spec Gateways   gw List   return  spec   func makeVirtualServiceRoute hosts sets String  usn string  http v1alpha1 HTTPIngressPath  gateways map v1alpha1 IngressVisibility sets String  visibility v1alpha1 IngressVisibility  istiov1alpha3 HTTPRoute       _  host    range hosts List     g    gateways visibility  strings HasSuffix host  clusterDomainName     len gateways v1alpha1 IngressVisibilityClusterLocal     0      local hostname  always use private gateway g   gateways v1alpha1 IngressVisibilityClusterLocal    matches   append matches  makeMatch host  usn  http Path  g              func makeMatch host string  usn string  pathRegExp string  gateways sets String     istiov1alpha3 HTTPMatchRequest          add custom usn filter   USN      usn            0   matches i  Uri    istiov1alpha3 StringMatch  MatchType   istiov1alpha3 StringMatch_Prefix Prefix  usn       else   matches i  Uri    istiov1alpha3 StringMatch  MatchType   istiov1alpha3 StringMatch_Exact Exact  strings TrimRight usn                                                   tricky       url rewrite          vs istio  crd                                             vs   url rewrite   rewrite               url            400                                                                             makeMatch  if else                                             http  match  uri  prefix    echo   uri  prefix    echo  rewrite  uri                   echo abc         abc   404                          Path",
        "objectID": "posts/knative-pathfilter",
        "date": "2020-08-19T09:26:18.000Z",
        "lastmod": "2020-08-19T09:26:18.000Z",
        "draft": false,
        "keywords": [
            "knative",
            "traffic"
        ],
        "description": "Knative根据Path转发请求",
        "tags": [
            "knative"
        ],
        "categories": [
            "定制开发"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Knative通过header访问指定版本",
        "uri": "posts/knative-version",
        "content": "knative 0 14 0                                                 serverless                       PATH                           Path                                                  knative   url                   url              url               url                 header               url                  vs     Match   Authroty    url prefix                   url                         header                     header                  revision     header                      Match   Header                                              MakeIngressSpec creates new IngressSpec func MakeIngressSpec  ctx context Context  r  servingv1 Route  tls   v1alpha1 IngressTLS  targets map string traffic RevisionTargets  visibility map string netv1alpha1 IngressVisibility  acmeChallenges    v1alpha1 HTTP01Challenge     v1alpha1 IngressSpec  error           add custom external domains customHostStr    r Annotations  serverless kakuchuxing com domains                        name          name     sort Sort sort Reverse sort StringSlice names    len customHostStr    0   customHosts    strings Split customHostStr       _  name    range names   name     default    visibility    netv1alpha1 IngressVisibilityExternalIP rule     makeIngressRule customHosts  r Namespace  visibility  name  targets name      public rule  need configure ACME challenge paths  rule HTTP Paths   append  makeACMEIngressPaths challengeHosts  customHosts   rule HTTP Paths     rules   append rules  rule              func makeIngressRule domains   string  ns string  visibility netv1alpha1 IngressVisibility  name string  targets traffic RevisionTargets   v1alpha1 IngressRule       return  v1alpha1 IngressRule  Hosts  domains  Visibility  visibility  HTTP   v1alpha1 HTTPIngressRuleValue  Paths    v1alpha1 HTTPIngressPath    Splits  splits     TODO lichuqiang    2201  plumbing config timeout retries      tag name        vs           header AppendHeaders  map string string   RevisionName   name                  func makeVirtualServiceRoute hosts sets String  usn string  http v1alpha1 HTTPIngressPath  gateways map v1alpha1 IngressVisibility sets String  visibility v1alpha1 IngressVisibility  istiov1alpha3 HTTPRoute          add revision tag header custom domain           tag   match header tag    http AppendHeaders  RevisionName    tag            0    len matches   i     matches i  Headers    nil   matches i  Headers   make map string  istiov1alpha3 StringMatch    matches i  Headers  RevisionName      istiov1alpha3 StringMatch  MatchType   istiov1alpha3 StringMatch_Exact  Exact  http Splits 0  ServiceName                                             Path                    header",
        "objectID": "posts/knative-version",
        "date": "2020-08-19T09:26:47.000Z",
        "lastmod": "2020-08-19T09:26:47.000Z",
        "draft": false,
        "keywords": [
            "knative",
            "revision"
        ],
        "description": "通过header访问指定版本",
        "tags": [
            "knative"
        ],
        "categories": [
            "定制开发"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kube-apiserver goroutine leak",
        "uri": "posts/kubernetes-apiserver-goroutine-leak",
        "content": "master apiserver                                                                    apiserver                                                                                        k8s api       k8s apiserver    bug         goroutine                                                   3                                apiserver   apiserver                   apiserver                            ip         master            pprof        goroutine          45000        goroutine      pprof tree                               http   ip port debug pprof goroutine       goroutine                                                               1 12 4     k8s io kubernetes vendor k8s io apiserver pkg server filters timeout go func  t timeoutHandler  ServeHTTP w http ResponseWriter  r http Request    r  after  postTimeoutFn  err    t timeout r     nil   t handler ServeHTTP w  r  return   errCh    make chan interface    tw    newTimeoutWriter w  go func     defer func     err    recover   err    nil   const size   64   10 buf    make   byte  size  buf   buf  runtime Stack buf  false   err   fmt Sprintf   v n s   err  buf    errCh",
        "objectID": "posts/kubernetes-apiserver-goroutine-leak",
        "date": "2019-12-06T09:15:45.000Z",
        "lastmod": "2019-12-06T09:15:45.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "leak",
            "apiserver"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kube-apiserver重启导致产生全量的update event",
        "uri": "posts/kubernetes-apiserver-refused",
        "content": "k8s master       notifier  client go   informer     EndPoint Update Handler  kube apiserver         update                                      update          reflect DeepEqual old  new            true  old new        update                                  reflect ListAndWatch                sharedIndexedInformer HandleDeltas                            HandleDeltas        func  s  sharedIndexInformer  HandleDeltas obj interface    error   s blockDeltas Lock   defer s blockDeltas Unlock      oldest newest _  d    range obj  Deltas    switch d Type   case Sync  Added  Updated  isSync    d Type    Sync s cacheMutationDetector AddObject d Object          old  exists  err    s indexer Get d Object   err    nil    exists   err    s indexer Update d Object   err    nil   return err   s processor distribute updateNotification oldObj  old  newObj  d Object   isSync    else   err    s indexer Add d Object   err    nil   return err   s processor distribute addNotification newObj  d Object   isSync    case Deleted  err    s indexer Delete d Object   err    nil   return err   s processor distribute deleteNotification oldObj  d Object   false      return nil           delta    Delete  informer     indexer              object             object   key    key                    update                notification                                    update                                      object      object       update                               apiserver   deltafifo                   resourceVersion    watch           ListAndWatch                   k8s io client go tools cache reflector go    ListAndWatch first lists items resource version moment call     use resource version watch     returns error ListAndWatch didn t even try initialize watch  func  r  Reflector  ListAndWatch stopCh",
        "objectID": "posts/kubernetes-apiserver-refused",
        "date": "2019-08-21T06:34:37.000Z",
        "lastmod": "2019-08-21T06:34:37.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "apiserver",
            "watch",
            "refused"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查",
            "bug修复"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kube-apiserver watch实现",
        "uri": "posts/kubernetes-apiserver-watch",
        "content": "List Watch kubernetes        kubelet kube controller manager kube scheduler         pod service                 add delete update  kube apiserver                                       list watch            https   zhuanlan zhihu com p 33335726          kube apiserver etcd List watch           PodStorage kube apiserver        pod service endpoint replication controller depolyments     Storage     PodStorage  PodStorage Pod Store    etcd     store CompleteWithOptions   etcdOptions GetRESTOptions        generic UndecoratedStorage   cache Store      genericregistry StorageWithCacher   Cache Store  StorageWithCacher   NewCacherFromConfig    Cacher      Cacher      watchCache   cacheListerWatcher   cacheListWatcher   ListerWatcher        List   Watch        Cacher           watchCache reflector watchers incoming channel  1  watchCache   cache     apiserver etcd  watch      watchers   map map     cacheWatcher  kubelet kube scheduler  watch          kube apiserver  watch   kube apiserver      cacheWatcher cacheWatcher   watch     http apiserver   kubelet kube scheduler  Reflector          ListerWatcher ListerWatcher          List   Watch   listerWatcher   Storage     watch      watchCache   incoming channel  watchCacheEvent      cacher dispatchEvents watchCache incoming channel  watchCacheEvent   watchers inputChan       cacher startCaching  StartCaching   cacheListerWatcher List   Watch      reflector watchHandler    cacheListWatcher List cacheListWatcher Watch List     storage List      etcdHelper List    Watch     storage watch      etcdHelper WatchList    etcdHelper List etcdHelper Watch etcdHelper   Storage         etcdHelper List    1    etcd      resourceVersion     etcdHelper WatchList    1    etcdWatcher  etcdWatcher      Watch    etcdWatcher           etcdIncoming channel outgoing channel      etcdWatcher translate         etcdWatcher etcdWatch  etcdWatcher etcdWatch   resourceVersion  0    etcdGetInitialWatchState        pods        etcdIncoming channel          watcher Next          etcdIncoming channel  etcdWatcher translate   etcdIncoming channel      etcdWatcher sendResult         outgoing channel  reflector watchHandler   outgoing channel     watchCache    watchCache     watchCache processEvent   watchCacheEvent   watchCache updateCache   watchCache       kube apiserver etcd watch        kube apiserver        watch        kube apiserver watch API       kube apiserver watch restful API kube apiserver  watch restful API      kubelet kube controller manager kube scheduler kube proxy  watch restful API      PUT DELETE GET REST API              registerResourceHandlers ListResource 1   rw watch         Store watch  2   serveWatch    Store watch   Storage Watch   Storage WatchList        Cacher watch   Cacher WatchList   Cacher watch watch      newCacheWatcher  newCacheWatcher        watcher   watcher   cacher watchers       cacheWatcher process          input channel       input channel   input channel       sendWatchCacheEvent    sendWatchCacheEvent kube apiserver watch         watchCacheEvent  Filter    cacher result channel",
        "objectID": "posts/kubernetes-apiserver-watch",
        "date": "2019-08-21T11:25:13.000Z",
        "lastmod": "2019-08-21T11:25:13.000Z",
        "draft": false,
        "keywords": [
            "kube-apiserver",
            "watch"
        ],
        "description": "kube-apiserver watch实现",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubernetes 1.9.6 CA IPVS CoreDNS",
        "uri": "posts/kubernetes-ca",
        "content": "kubernetes            TLS                 CloudFlare   PKI     cfssl     Certificate Authority  CA            CentOS7 amd64       10 202 43 132 master   etcd 10 202 43 133 master   node   etcd 10 202 43 134 node   etcd      ca csr json etcd csr json admin csr json kubernetes csr json kube proxy csr json     CA            ca key pem ca pem kubernetes key pem kubernetes pem kube proxy pem kube proxy key pem admin pem admin key pem etcd pem etcd key pem           etcd    ca pem etcd key pem etcd pem  kube apiserver    ca pem kubernetes key pem kubernetes pem  kubelet    ca pem  kube proxy    ca pem kube proxy key pem kube proxy pem  kubectl    ca pem admin key pem admin pem  kube controller kube scheduler       kube apiserver                                CFSSL                     go     cd  usr local bin wget https   pkg cfssl org R1 2 cfssl_linux amd64 mv cfssl_linux amd64 cfssl wget https   pkg cfssl org R1 2 cfssljson_linux amd64 mv cfssljson_linux amd64 cfssljson wget https   pkg cfssl org R1 2 cfssl certinfo_linux amd64 mv cfssl certinfo_linux amd64 cfssl certinfo chmod  x      CA  Certificate Authority     CA      mkdir  opt ssl cd  opt ssl ca config json    vim ca config json    signing      default      expiry    87600h      profiles      kubernetes      usages      signing    key encipherment    server auth    client auth      expiry    87600h               ca config json        profiles                                  profile  signing                    ca pem     CA TRUE  server auth   client     CA  server           client auth   server     CA  client              CA        ca csr json    vim ca csr json    CN    kubernetes    key      algo    rsa    size   2048     names        C    CN    ST    BeiJing    L    BeiJing    O    k8s    OU    System              CN  Common Name kube apiserver                    User Name                     O  Organization kube apiserver                      Group      CA       cfssl gencert  initca ca csr json   cfssljson  bare ca ls ca csr ca key pem ca pem ca csr json ca config json             mkdir  p  etc kubernetes ssl            cp   pem  etc kubernetes ssl cp ca csr  etc kubernetes ssl             k8s     scp   pem 10 202 43 133  etc kubernetes ssl  scp   csr 10 202 43 133  etc kubernetes ssl  scp   pem 10 202 43 134  etc kubernetes ssl  scp   csr 10 202 43 134  etc kubernetes ssl     etcd      etcd             etcd         10 202 43 132     10 202 43 133     10 202 43 134           IP                    IP                     vim etcd csr json    CN    etcd    hosts      127 0 0 1    10 202 43 132    10 202 43 133    10 202 43 134      key      algo    rsa    size   2048     names        C    CN    ST    BeiJing    L    BeiJing    O    k8s    OU    System           etcd       cfssl gencert  ca ca pem    ca key ca key pem    config ca config json    profile kubernetes etcd csr json   cfssljson  bare etcd ls etcd  etcd csr etcd csr json etcd key pem etcd pem    etcd    etcd 1 cp etcd  pem  etc kubernetes ssl  etcd 2 scp etcd  pem 10 202 43 133  etc kubernetes ssl  etcd 3 scp etcd  pem 10 202 43 134  etc kubernetes ssl     etcd    etcd 1 vim  usr lib systemd system etcd service  Unit  Description Etcd Server After network target After network online target Wants network online target  Service  Type notify WorkingDirectory  opt etcd  User etcd set GOMAXPROCS number processors ExecStart  usr bin etcd     name etcd1     cert file  etc kubernetes ssl etcd pem     key file  etc kubernetes ssl etcd key pem     peer cert file  etc kubernetes ssl etcd pem     peer key file  etc kubernetes ssl etcd key pem     trusted ca file  etc kubernetes ssl ca pem     peer trusted ca file  etc kubernetes ssl ca pem     initial advertise peer urls https   10 202 43 132 2380     listen peer urls https   10 202 43 132 2380     listen client urls https   10 202 43 132 2379 http   127 0 0 1 2379     advertise client urls https   10 202 43 132 2379     initial cluster token k8s etcd cluster     initial cluster etcd1 https   10 202 43 132 2380 etcd2 https   10 202 43 133 2380 etcd3 https   10 202 43 134 2380     initial cluster state new     data dir  opt etcd  Restart on failure RestartSec 5 LimitNOFILE 65536  Install  WantedBy multi user target                         IP                    cert file  etc kubernetes ssl etcd pem   key file  etc kubernetes ssl etcd key pem   peer cert file  etc kubernetes ssl etcd pem   peer key file  etc kubernetes ssl etcd key pem   trusted ca file  etc kubernetes ssl ca pem   peer trusted ca file  etc kubernetes ssl ca pem      etcd    systemctl daemon reload systemctl start etcd        systemctl enable etcd   etcd   systemctl status etcd    etcd      etcdctl   endpoints https   10 202 43 132 2379 https   10 202 43 133 2379 https   10 202 43 134 2379    cert file  etc kubernetes ssl etcd pem     ca file  etc kubernetes ssl ca pem     key file  etc kubernetes ssl etcd key pem   cluster health    kubernetes       admin                vim admin csr json    CN    admin    hosts        key      algo    rsa    size   2048     names        C    CN    ST    BeiJing    L    B",
        "objectID": "posts/kubernetes-ca",
        "date": "2018-05-24T13:56:42.000Z",
        "lastmod": "2018-05-24T13:56:42.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "CA",
            "k8s"
        ],
        "description": "kubernetes deploy with CA",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "使用说明"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubelet与CNI交互源码",
        "uri": "posts/kubernetes-cni",
        "content": "https   www cnblogs com haoqingchuan p 8668746 html         1 12 4      kubelet     grpc         CRI   dockershim    rpc    CNI    dockershim grpc server      kubelet    CRI shim    container runtime    container POD        kubelet   docker server   cni   UML      CNI       kubelet            containerRuntime Docker     dockershim rpc server case kubetypes DockerContainerRuntime     Create start CRI shim running grpc server  streamingConfig    getStreamingConfig kubeCfg  kubeDeps  crOptions          ds  err    dockershim NewDockerService kubeDeps DockerClientConfig  crOptions PodSandboxImage  streamingConfig   pluginSettings  runtimeCgroups  kubeCfg CgroupDriver  crOptions DockershimRootDirectory   crOptions RedirectContainerStreaming  err    nil   return nil  err   crOptions RedirectContainerStreaming   klet criHandler   ds      unix socket kubelet dockershim communication  glog V 5  Infof  RemoteRuntimeEndpoint   q  RemoteImageEndpoint   q   remoteRuntimeEndpoint  remoteImageEndpoint  glog V 2  Infof  Starting GRPC server docker CRI shim    server    dockerremote NewDockerServer remoteRuntimeEndpoint  ds  err    server Start    err    nil   return nil  err      Create dockerLegacyService when logging driver not supported  supported  err    ds IsCRISupportedLogDriver   err    nil   return nil  err    supported   klet dockerLegacyService   ds legacyLogProvider   ds      dockerservice       cniplugin    rpc server  func NewDockerService config ClientConfig  podSandboxImage string  streamingConfig streaming Config  pluginSettings  NetworkPluginSettings  cgroupsName string  kubeCgroupDriver string  dockershimRootDir string  startLocalStreamingServer bool   DockerService  error             kubelet   pluginbindir pluginSettings PluginBinDirs   cni SplitDirs pluginSettings PluginBinDirString  cniPlugins    cni ProbeNetworkPlugins pluginSettings PluginConfDir  pluginSettings PluginBinDirs  cniPlugins   append cniPlugins  kubenet NewPlugin pluginSettings PluginBinDirs   netHost     dockerNetworkHost   namespaceGetter ds    portMappingGetter ds     plug  err    network InitNetworkPlugin cniPlugins  pluginSettings PluginName  netHost  pluginSettings HairpinMode  pluginSettings NonMasqueradeCIDR  pluginSettings MTU  err    nil   return nil  fmt Errorf  didn t find compatible CNI plugin given settings   v   v   pluginSettings  err    ds network   network NewPluginManager plug  glog Infof  Docker cri networking managed  v   plug Name                 confdir   bindir  networkplugin func ProbeNetworkPlugins confDir string  binDirs   string    network NetworkPlugin   old    binDirs binDirs   make   string  0  len binDirs   _  dir    range old   dir         binDirs   append binDirs  dir      plugin     cniNetworkPlugin  defaultNetwork  nil  loNetwork  getLoNetwork binDirs   execer  utilexec New    confDir  confDir  binDirs  binDirs       sync NetworkConfig best effort during probing  plugin syncNetworkConfig   return   network NetworkPlugin plugin       cniplugin    pluginDir           CNI config        config          CNI bin    InitNetworkPlugin inits plugin matches networkPluginName  Plugins unique names  func InitNetworkPlugin plugins   NetworkPlugin  networkPluginName string  host Host  hairpinMode kubeletconfig HairpinMode  nonMasqueradeCIDR string  mtu int   NetworkPlugin  error    networkPluginName            default no_op plugin plug     NoopNetworkPlugin   plug Sysctl   utilsysctl New   err    plug Init host  hairpinMode  nonMasqueradeCIDR  mtu   err    nil   return nil  err   return plug  nil   pluginMap    map string NetworkPlugin   allErrs      error   _  plugin    range plugins   name    plugin Name   errs    validation IsQualifiedName name   len errs     0   allErrs   append allErrs  fmt Errorf  network plugin invalid name   q   s   name  strings Join errs         continue   _  found    pluginMap name   found   allErrs   append allErrs  fmt Errorf  network plugin  q registered once   name   continue   pluginMap name    plugin   chosenPlugin    pluginMap networkPluginName  chosenPlugin    nil   err    chosenPlugin Init host  hairpinMode  nonMasqueradeCIDR  mtu  err    nil   allErrs   append allErrs  fmt Errorf  Network plugin  q failed init   v   networkPluginName  err     else   glog V 1  Infof  Loaded network plugin  q   networkPluginName      else   allErrs   append allErrs  fmt Errorf  Network plugin  q not found    networkPluginName     return chosenPlugin  utilerrors NewAggregate allErrs    func  plugin  cniNetworkPlugin  Init host network Host  hairpinMode kubeletconfig HairpinMode  nonMasqueradeCIDR string  mtu int  error   err    plugin platformInit   err    nil   return err   plugin host   host plugin syncNetworkConfig   return nil   func  plugin  cniNetworkPlugin  syncNetworkConfig     network  err    getDefaultCNINetwork plugin confDir  plugin binDirs  err    nil   glog Warningf  Unable update cni config   s   err  return   plugin setDefaultNetwork network       plugin        conf  conflist  json                               cni      plugin                 func getDefaultCNINetwork confDir string  binDirs   string ",
        "objectID": "posts/kubernetes-cni",
        "date": "2019-07-16T05:53:02.000Z",
        "lastmod": "2019-07-16T05:53:02.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "CNI",
            "kubelet"
        ],
        "description": "kubelet与cni交互流程",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kube-controller-manager同步数据慢",
        "uri": "posts/kubernetes-controllerrevisionhistory-bug",
        "content": "1 12 4     kube controller manager                                               5000 statefulset                statefulset                   statefulset                                statefulset                                                                    goroutine       statefulset controller      goroutine         statefulset                goroutine          Informer List     trace                statefulset      controllerrevision              adoptOrphanRevisions adopts orphaned ControllerRevisions matched set s Selector  func  ssc StatefulSetController  adoptOrphanRevisions set apps StatefulSet  error          revisions  err    ssc control ListRevisions set                            syncStatefulSet syncs tuple  statefulset     v1 Pod   func  ssc StatefulSetController  syncStatefulSet set apps StatefulSet  pods    v1 Pod  error          TODO  investigate mutate set during update not obvious     UpdateStatefulSet       ListRevisions   err    ssc control UpdateStatefulSet set DeepCopy    pods   err    nil   return err                  statefulset   100 ms   5000  statefulset          20m  ControllerRevision   statefulset     controllerrevision                      statefulset                   statefulset                     statefulset  10         statefulset                           statefulset     controllerrevision                                          controllerrevision          ListInformer                                                                   statesetfulset controller     controllerrevision          revision   revision                                          controller manager               20m     1m                                        controller manager                                                                                   master                                                  bug   controllerrevision          statefulset       statefulset controller   bug pr   master   v1 18",
        "objectID": "posts/kubernetes-controllerrevisionhistory-bug",
        "date": "2020-04-01T02:52:12.000Z",
        "lastmod": "2020-04-01T02:52:12.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "adopt",
            "revision"
        ],
        "description": "orphan controller revision cannot be adopt",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "bug修复",
            "问题排查",
            "性能优化"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "那些年，我们一起追的Bug",
        "uri": "posts/kubernetes-cpu-manager",
        "content": "bug                                                              bug                  k8s              k8s             1 8     CPU Manager                         CPU Manager    alpha      Kubernetes 1 8    1 12       beta                                    NUMA Topology Aware                            kubelet                admit                                            cpu      not enough cpus available satisfy request        1 8                                                        beta                 PR                                                                                   Kubelet         cpumanagerstate       Kubelet        99                 k8s            k8s          k8s                                                           Reconsile   PreStartContaier             Reconsile   Admit PreCreateContainer        Admit                          Docker                       Config         Docker                     Docker API             ISSUE   PR ISSUE            ISSUE      1 8          ISSUE            Internal PreStartContainer hook failed  not enough cpus available satisfy request  63018  cpumanager  AddContainer error  not enough cpus available satisfy request  79159 TopologyManager  Guarantee Aligned resources Multiple Containers  83476 Container cpuset lost  apparently due race PostStopContainer   new container creation  90303 CPU manager does not work correctly guaranteed pod multiple containers  103952 PR CPU manager release CPUs when Pod enters completed phase  52363 cpumanager  rollback state updateContainerCPUSet failed  67430 clean containers reconcileState cpuManager  68619 Update CPUManager stored state semantics  84462 Fix exclusive CPU allocations deleted container restart  90377 not clear state pods pending admission CPU Memory Device manager  103979 Slack          CPU Manager                           1 22           bug   kubelet             1 22    kubelet             Commit    PR              Bug    Failing Test                                   Commit                        CPU Manager                       1 18                 k8s            PR             PR                                  docker    load   io                        1 18       cpumanagerstate            map ContainerID resource         container ID    Key                                 Pod   Container Name      Container         ID              cpumanagerstate                1 18    cpumanagerstate              map PODUID map ContainerName resource          Pod   Container Name                           Pod                   Container            cpumanagerstate                                      3                                1 18               1 23      release   1 22     Kubulet                       1 18   1 21",
        "objectID": "posts/kubernetes-cpu-manager",
        "date": "2021-10-16T08:06:50.000Z",
        "lastmod": "2021-10-16T08:06:50.000Z",
        "draft": false,
        "keywords": [
            "cpu manager",
            "kubernetes",
            "bug",
            "kubelet"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析",
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubernetes惊天地泣鬼神之大bug",
        "uri": "posts/kubernetes-ep-bug",
        "content": "docker one             Kubernetes         Bug                                                 bug                                                     Kubernetes service       kubectl delete svc xxx           service      service event list         resourceVersion             controller manager         service event list                 service   ADDED DELETED event    controller manager        service          EndpointController          service     endpoints                                     bug                                           1 9 2                                         watchHandler watches w keeps  resourceVersion date  func  r Reflector  watchHandler w watch Interface  resourceVersion string  errc chan error  stopCh",
        "objectID": "posts/kubernetes-ep-bug",
        "date": "2018-05-26T08:20:01.000Z",
        "lastmod": "2018-05-26T08:20:01.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "bug",
            "endpoint"
        ],
        "description": "kubernetes's bug because of the resourceversion",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Endpoint异常变化",
        "uri": "posts/kubernetes-ep-event",
        "content": "k8s 1 12 4                                              7         watch Endpoint ready      2s                                image         k8s                  API        2s   2s           API                                                                                                                                                                      endpoint                                  Endpoint          k8s              controller                       Endpoint      kube controller manager  endpoint controller                   func  e  EndpointController  syncService key string  error       subsets      v1 EndpointSubset   var totalReadyEps int   0 var totalNotReadyEps int   0 _  pod    range pods   len pod Status PodIP     0   glog V 5  Infof  Failed find IP pod  s  s   pod Namespace  pod Name  continue    tolerateUnreadyEndpoints    pod DeletionTimestamp    nil   glog V 5  Infof  Pod deleted  s  s   pod Namespace  pod Name  continue   epa     podToEndpointAddress pod  hostname    pod Spec Hostname len hostname    0    pod Spec Subdomain    service Name    service Namespace    pod Namespace   epa Hostname   hostname      Allow headless service not ports  len service Spec Ports     0   service Spec ClusterIP    api ClusterIPNone   subsets  totalReadyEps  totalNotReadyEps   addEndpointSubset subsets  pod  epa  nil  tolerateUnreadyEndpoints     No need repack subsets headless service without ports      else      range service Spec Ports   servicePort     service Spec Ports i  portName    servicePort Name portProto    servicePort Protocol portNum  err    podutil FindPort pod  servicePort  err    nil   glog V 4  Infof  Failed find port service  s  s   v   service Namespace  service Name  err  continue   var readyEps  notReadyEps int epp     v1 EndpointPort Name  portName  Port  int32 portNum   Protocol  portProto  subsets  readyEps  notReadyEps   addEndpointSubset subsets  pod  epa  epp  tolerateUnreadyEndpoints  totalReadyEps   totalReadyEps   readyEps totalNotReadyEps   totalNotReadyEps   notReadyEps           glog V 4  Infof  Update endpoints  v  v  ready   d not ready   d   service Namespace  service Name  totalReadyEps  totalNotReadyEps                syncService                 32    Pod    PodReady Condition   true true     IP  subnet Addresses        NotReadyAddresses  Condition   kubelet     generateAPIPodStatus               generateAPIPodStatus creates final API pod status pod  given    internal pod status  func  kl Kubelet  generateAPIPodStatus pod v1 Pod  podStatus  kubecontainer PodStatus  v1 PodStatus   glog V 3  Infof  Generating status  q   format Pod pod      check internal module requested pod evicted  _  podSyncHandler    range kl PodSyncHandlers   result    podSyncHandler ShouldEvict pod   result Evict   return v1 PodStatus  Phase  v1 PodFailed  Reason  result Reason  Message  result Message        s    kl convertStatusToAPIStatus pod  podStatus     Assume info ready process spec     pod Spec allStatus    append append   v1 ContainerStatus    s ContainerStatuses      s InitContainerStatuses     s Phase   getPhase spec  allStatus     Check illegal phase transition pod Status Phase    v1 PodFailed    pod Status Phase    v1 PodSucceeded      API server shows terminal phase  transitions not allowed s Phase    pod Status Phase   glog Errorf  Pod attempted illegal phase transition  s  s   v   pod Status Phase  s Phase  s     Force back phase API server s Phase   pod Status Phase     kl probeManager UpdatePodStatus pod UID  s  s Conditions   append s Conditions  status GeneratePodInitializedCondition spec  s InitContainerStatuses  s Phase   s Conditions   append s Conditions  status GeneratePodReadyCondition spec  s Conditions  s ContainerStatuses  s Phase   s Conditions   append s Conditions  status GenerateContainersReadyCondition spec  s ContainerStatuses  s Phase      Status manager will care LastTransitionTimestamp  either preserve    timestamp apiserver  set new one  When kubelet sees pod     PodScheduled condition true  s Conditions   append s Conditions  v1 PodCondition  Type  v1 PodScheduled  Status  v1 ConditionTrue     kl kubeClient    nil   hostIP  err    kl getHostIPAnyWay   err    nil   glog V 4  Infof  Cannot host IP   v   err    else   s HostIP   hostIP String   kubecontainer IsHostNetworkPod pod     s PodIP         s PodIP   hostIP String         return  s               PodStatus  docker           Status     Pod Status          Condition   GeneratePodReadyCondition           GenerateContainersReadyCondition  Pod  container ContainerReadyCondition     PodReadyCondition         GeneratePodReadyCondition returns  Ready  condition pod     status  Ready  condition  True   containers pod ready    matching conditions specified ReadinessGates status equal  True   func GeneratePodReadyCondition spec  v1 PodSpec  conditions   v1 PodCondition  containerStatuses   v1 ContainerStatus  podPhase v1 PodPhase  v1 PodCondition   containersReady    GenerateContainersReadyCondition spec  containerStatuses  podPhase     status ContainersReady not True  return status  reason message ContainersReady  contain",
        "objectID": "posts/kubernetes-ep-event",
        "date": "2020-06-23T11:53:31.000Z",
        "lastmod": "2020-06-23T11:53:31.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "Endpoint",
            "流量"
        ],
        "description": "endpoint变化",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Flannel key not found",
        "uri": "posts/kubernetes-flannel",
        "content": "etcd 3 3 1     flannel 0 11 0 flannel               flannel  etcd keyfile  etc kubernetes ssl etcd client key pem  etcd cafile  etc kubernetes ssl ca pem  etcd endpoints https   ip port  etcd certfile  etc kubernetes ssl etcd client pem  etcd prefix  coreos com network         E0908 20 27 17 671602 2331 main go 382  Couldn t fetch network config  100  Key not found   coreos com   22  timed E0908 20 27 18 680096 2331 main go 382  Couldn t fetch network config  100  Key not found   coreos com   22  timed E0908 20 27 19 688339 2331 main go 382  Couldn t fetch network config  100  Key not found   coreos com   22    coreos com   flannel  etcd prefix        coreos com network                    key     etcdctl        key      ETCDCTL_API 3 etcdctl   cacert  etc kubernetes ssl ca pem   cert  etc kubernetes ssl etcd client pem   key  etc kubernetes ssl etcd client key pem   endpoints https   ip port put  coreos com network config    Network   192 168 0 0 16   SubnetLen  24  Backend    Type   vxlan     OK     flannel        etcdctl get  key                            etcd api                     flannel   etcd    etcd v2   api       key value     v3   api                v2                 v2   api       etcdctl   cacert  etc kubernetes ssl ca pem   cert  etc kubernetes ssl etcd client pem   key  etc kubernetes ssl etcd client key pem   endpoints https   ip port set  coreos com network config    Network   192 168 0 0 16   SubnetLen  24  Backend    Type   vxlan             v3      put  set         master         ETCDCTL_API    v3   api                      etcd     api   url path prefix   v2    v2 keys v3    v3 alpha beta  kv               API         client",
        "objectID": "posts/kubernetes-flannel",
        "date": "2019-12-16T09:58:20.000Z",
        "lastmod": "2019-12-16T09:58:20.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "flannel",
            "etcd",
            "key not found"
        ],
        "description": "flannel启动提示key not found",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubernetes 启用GPU",
        "uri": "posts/kubernetes-gpu",
        "content": "kubernetes   k8s 1 10     kube apiserver kube controller manager kube scheduler kubelet     feature                        feature gates  DevicePlugins true     NVIDIA Driver  361 93   nvidia docker2        docker                                      nvidia docker 1 0 installed  need remove existing GPU containers docker volume ls  q  f driver nvidia docker   xargs  r  I    n1 docker ps  q  a  f volume      xargs  r docker rm  f sudo yum remove nvidia docker Add package repositories distribution      etc os release echo  ID VERSION_ID  curl  s  L https   nvidia github io nvidia container runtime  distribution nvidia container runtime repo     sudo tee  etc yum repos d nvidia container runtime repo Install nvidia runtime hook sudo yum install  y nvidia container runtime hook sudo mkdir  p  usr libexec oci hooks d echo  e     bin sh nPATH   usr local sbin  usr local bin  usr sbin  usr bin  sbin  bin  exec nvidia container runtime hook           sudo tee  usr libexec oci hooks d nvidia sudo chmod  x  usr libexec oci hooks d nvidia Test nvidia smi latest official CUDA image can t use   runtime nvidia setup  docker run   rm nvidia cuda nvidia smi   nvidia container runtime              yum repo                                                 yum     nvidia docker2           install runtime yum install nvidia container runtime update docker daemon  docker daemon          daemon json              default runtime    nvidia         runtime      runc            runtime nvidia  default runtime    nvidia    runtimes      nvidia      path     usr bin nvidia container runtime    runtimeArgs            NVIDIA device plugin    daemonset            CPU  GPU       label   GPU    GPU           Kubernetes v1 8 kubectl create  f https   raw githubusercontent com NVIDIA k8s device plugin v1 8 nvidia device plugin yml Kubernetes v1 9 kubectl create  f https   raw githubusercontent com NVIDIA k8s device plugin v1 9 nvidia device plugin yml    apiVersion  v1 kind  Pod metadata  name  cuda vector add spec  restartPolicy  OnFailure containers  name  cuda vector add https   github com kubernetes kubernetes blob v1 7 11 test images nvidia cuda Dockerfile image   k8s gcr io cuda vector add v0 1  resources  limits  nvidia com gpu  1 nodeSelector  GPU   true            GPU    GPU true label kubectl create  f test yaml        root vm10 0 13 17     kubectl pods  a NAME READY STATUS RESTARTS AGE cuda vector add 0 1 Completed 0 3h nvidia device plugin daemonset pv6z8 1 1 Running 0 4h  root vm10 0 13 17     kubectl logs cuda vector add  Vector addition 50000 elements  Copy input data host memory CUDA device CUDA kernel launch 196 blocks 256 threads Copy output data CUDA device host memory Test PASSED Done",
        "objectID": "posts/kubernetes-gpu",
        "date": "2018-09-06T08:36:27.000Z",
        "lastmod": "2018-09-06T08:36:27.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "GPU",
            "Custom"
        ],
        "description": "kubernetes启用GPU",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "使用说明"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Sidecar优雅退出",
        "uri": "posts/kubernetes-graceful-shutdown",
        "content": "codis                                                                 IP        pending                                master                                              kubectl describe po kirovpre krds sf f3dec 0   Pod       20 40 11         20 40 12                       20 39 38                30s                             20 39 38       kube odin    20 40 11         k8s  20 40 12         k8s                        30s                1s                    k8s          Pod api         backgroud foregroud                api                                   backgroud     20 39 38         api                                20 40 11                      kubelet                      I0603 20 39 37 908557 3033 kubelet go 1913  SyncLoop  DELETE   api     kirovpre krds sf f3dec 0_default 01473fb7 a17b 11ea 8d10 c88d83d31d55   I0603 20 39 37 908655 3033 kubeletpods go 1433  Generating status  kirovpre krds sf f3dec 0default 01473fb7 a17b 11ea 8d10 c88d83d31d55   I0603 20 39 37 908799 3033 kuberuntime_container go 468  Running preStop hook container  docker   5fe57cf36af267adae571272f234762ad8741922e24074182ff25301e953ec72  I0603 20 39 37 916683 3033 statusmanager go 499  Patch status pod  kirovpre krds sf f3dec 0default 01473fb7 a17b 11ea 8d10 c88d83d31d55        I0603 20 39 37 916699 3033 statusmanager go 506  Status pod  kirovpre krds sf f3dec 0default 01473fb7 a17b 11ea 8d10 c88d83d31d55   updated successfully   6   Phase Running Conditions   Type Initialized Status True LastProbeTime 0001 01 01 00 00 00  0000 UTC LastTransitionTime 2020 05 29 15 07 09  0800 CST Reason  Message    Type Ready Status True LastProbeTime 0001 01 01 00 00 00  0000 UTC LastTransitionTime 2020 05 29 15 07 26  0800 CST Reason  Message    Type ContainersReady Status True LastProbeTime 0001 01 01 00 00 00  0000 UTC LastTransitionTime 2020 05 29 15 07 26  0800 CST Reason  Message    Type PodScheduled Status True LastProbeTime 0001 01 01 00 00 00  0000 UTC LastTransitionTime 2020 05 29 15 07 08  0800 CST Reason  Message    Message  Reason  NominatedNodeName  HostIP 10 89 231 24 PodIP 10 169 92 60 StartTime 2020 05 29 15 07 09  0800 CST InitContainerStatuses    ContainerStatuses   Name agent kirovpre krds ys02 State  Waiting nil Running  ContainerStateRunning StartedAt 2020 05 29 15 07 18  0800 CST   Terminated nil  LastTerminationState  Waiting nil Running nil Terminated nil  Ready true RestartCount 0 Image registry kaku com kakuonline kvstore sidecar python2 centos7 agent ea6d410 ImageID docker pullable   registry kaku com kakuonline kvstore sidecar python2 centos7 agent sha256 6d61df206fef0fbfd940e1139d7dff6b0dfaacd847d8d64b2b480cf5afd8a513 ContainerID docker   5fe57cf36af267adae571272f234762ad8741922e24074182ff25301e953ec72   Name kirovpre krds ys02 State  Waiting nil Running  ContainerStateRunning StartedAt 2020 05 29 15 07 22  0800 CST   Terminated nil  LastTerminationState  Waiting nil Running nil Terminated nil  Ready true RestartCount 0 Image registry kaku com kakuonline kvstore sidecar krds stable ImageID docker pullable   registry kaku com kakuonline kvstore sidecar krds sha256 3945a5304ee92b89605831d991874d0b9fdffb89b19fc92d5bbc4969b8a3cf1f ContainerID docker   2e2354889588dc7483d2bb9be27a5253f292374c8e179b12367e0deea8b2d825   QOSClass Burstable   I0603 20 39 37 916795 3033 kubeletpods go 993  Pod  kirovpre krds sf f3dec 0default 01473fb7 a17b 11ea 8d10 c88d83d31d55   terminated  containers running I0603 20 39 40 975805 3033 kuberuntime_container go 485  preStop hook container   docker   5fe57cf36af267adae571272f234762ad8741922e24074182ff25301e953ec72   completed I0603 20 39 40 975845 3033 kuberuntime_container go 563  Killing container  docker   2e2354889588dc7483d2bb9be27a5253f292374c8e179b12367e0deea8b2d825  5 second grace period I0603 20 39 40 975856 3033 kuberuntime_container go 468  Running preStop hook container  docker   2e2354889588dc7483d2bb9be27a5253f292374c8e179b12367e0deea8b2d825  I0603 20 39 41 402077 3033 kubeletpods go 993  Pod  kirovpre krds sf f3dec 0default 01473fb7 a17b 11ea 8d10 c88d83d31d55   terminated  containers running I0603 20 39 44 044590 3033 kuberuntime_container go 485  preStop hook container   docker   2e2354889588dc7483d2bb9be27a5253f292374c8e179b12367e0deea8b2d825   completed I0603 20 39 44 044634 3033 kuberuntime_container go 580  Killing container   docker   2e2354889588dc7483d2bb9be27a5253f292374c8e179b12367e0deea8b2d825    using 2 second grace period override I0603 20 39 46 217074 3033 kuberuntime_container go 587  Container  docker   2e2354889588dc7483d2bb9be27a5253f292374c8e179b12367e0deea8b2d825  exited normally I0603 20 39 46 217139 3033 kuberuntime_container go 563  Killing container  docker   5fe57cf36af267adae571272f234762ad8741922e24074182ff25301e953ec72  5 second grace period I0603 20 39 46 217149 3033 kuberuntime_container go 468  Running preStop hook container  docker   5fe57cf36af267adae571272f234762ad8741922e24074182ff25301e953ec72  I0603 20 39 46 217139 3033 event go 221  Event v1 ObjectReference Kind  Pod   Namespace  default   Name  kirovpre krds sf f3dec 0   UID  01473fb7 a17b 11ea 8d10 ",
        "objectID": "posts/kubernetes-graceful-shutdown",
        "date": "2020-06-23T11:46:45.000Z",
        "lastmod": "2020-06-23T11:46:45.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "graceful",
            "terminate",
            "shutdown"
        ],
        "description": "优雅退出",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Informer DeltaFIFO源码解析",
        "uri": "posts/kubernetes-informer-deltafifo",
        "content": "DeltaFIFO  Reflector LocalStore                                          client go tools cache delta_fifo go type DeltaFIFO struct      lock cond protects access  items   queue              Mutex  lock sync RWMutex     pop                 cond sync Cond    depend property items set    queue vice versa  Deltas    map least one Delta       map    Deltas DeltaFIFO                                                           queue    map keys  map        slice     items map string Deltas queue   string                          populated true first batch items inserted Replace   populated    Delete Add Update called first  populated bool    initialPopulationCount number items inserted first call Replace   initialPopulationCount int    keyFunc used key used queued item    insertion retrieval  deterministic  keyFunc KeyFunc    knownObjects list keys  known      purpose figuring items deleted    when Replace   Delete   called           Indexer knownObjects KeyListerGetter    Indication queue closed     Used indicate queue closed so control loop exit when queue empty     Currently  not used gate CRED operations  closed bool closedLock sync Mutex          client go tools cache delta_fifo go type Delta struct   Type DeltaType Object interface            k8s       type DeltaType string    Delta          const   Added DeltaType    Added        Updated DeltaType    Updated        Deleted DeltaType    Deleted        Sync DeltaType    Sync          type Deltas   Delta    Delta   Delta                         Deltas                     slice  key                     DeltaFIFO        kubernetes             DeltaFIFO                        client go tools cache fifo go type Queue interface            Indexer     Store    Pop blocks until something process     returns object process result processing     PopProcessFunc may return ErrRequeue      indicate item    requeued releasing lock queue     pop                     sync Cond                    PopProcessFunc                     Pop PopProcessFunc   interface    error     AddIfNotPresent adds value previously    returned Pop back queue long    nothing else  presumably recent     added  AddIfNotPresent interface    error    HasSynced returns true first batch items popped HasSynced   bool    Close queue Close                 Queue    Store       Pop                Indexer Indexer  Store                               DeltaFIFO                    client go tools cache delta_fifo go           func  f  DeltaFIFO  Add obj interface    error   f lock Lock   defer f lock Unlock   f populated   true                    return f queueActionLocked Added  obj              func  f  DeltaFIFO  Update obj interface    error   f lock Lock   defer f lock Unlock   f populated   true                    return f queueActionLocked Updated  obj              func  f  DeltaFIFO  Delete obj interface    error   id  err    f KeyOf obj  err    nil   return KeyError obj  err    f lock Lock   defer f lock Unlock   f populated   true                                knownObjects  Indexer             f knownObjects    nil         Indexer                   _  exists    f items id    exists   return nil     else         Indexer                 _  exists  err    f knownObjects GetByKey id  _  itemsExist    f items id  err    nil     exists     itemsExist   return nil     return f queueActionLocked Deleted  obj               func  f  DeltaFIFO  ListKeys     string   f lock RLock   defer f lock RUnlock   list    make   string  0  len f items   key    range f items   list   append list  key    return list             func  f  DeltaFIFO  List     interface     f lock RLock   defer f lock RUnlock   return f listLocked                  func  f  DeltaFIFO  listLocked     interface     list    make   interface    0  len f items   _  item    range f items   item   copyDeltas item  list   append list  item Newest   Object    return list                            func  f  DeltaFIFO  Get obj interface     item interface    exists bool  err error    key  err    f KeyOf obj  err    nil   return nil  false  KeyError obj  err    return f GetByKey key                 func  f  DeltaFIFO  GetByKey key string   item interface    exists bool  err error    f lock RLock   defer f lock RUnlock   d  exists    f items key  exists   d   copyDeltas d    return d  exists  nil             func  f  DeltaFIFO  IsClosed   bool   f closedLock Lock   defer f closedLock Unlock   f closed   return true   return false                          queueActionLocked                              client go tools cache delta_fifo go func  f  DeltaFIFO  queueActionLocked actionType DeltaType  obj interface    error                    id  err    f KeyOf obj  err    nil   return KeyError obj  err                                           actionType    Sync    f willObjectBeDeletedLocked id    return nil                       Deltas    newDeltas    append f items id   Delta actionType  obj                delta newDeltas   dedupDeltas newDeltas                _  exists    f items id                 Delta                              len newDeltas    0                               ",
        "objectID": "posts/kubernetes-informer-deltafifo",
        "date": "2021-03-18T09:33:44.000Z",
        "lastmod": "2021-03-18T09:33:44.000Z",
        "draft": false,
        "keywords": [
            "informer",
            "kubernetes"
        ],
        "description": "",
        "tags": [
            "informer",
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Informer LocalStore源码解析",
        "uri": "posts/kubernetes-informer-localstore",
        "content": "cache  Informer  Local Store          1 12                       client go tools cache store go type Store interface   Add obj interface    error Update obj interface    error Delete obj interface    error List     interface   ListKeys     string Get obj interface     item interface    exists bool  err error  GetByKey key string   item interface    exists bool  err error     Replace will delete contents store  using instead    given list  Store takes ownership list  not reference    calling function                  Replace   interface    string  error Resync   error   Store                                                            client go tools cache index go    Indexer storage interface lets list objects using multiple indexing functions type Indexer interface   Store    Retrieve list objects match named indexing function Index indexName string  obj interface       interface    error     IndexKeys returns set keys match named indexing function  IndexKeys indexName  indexKey string     string  error     ListIndexFuncValues returns list generated values Index func ListIndexFuncValues indexName string    string    ByIndex lists object match named indexing function exact key ByIndex indexNtame  indexKey string     interface    error     GetIndexer return indexers GetIndexers   Indexers    AddIndexers adds indexers store  call already data    store  results undefined  AddIndexers newIndexers Indexers  error   Indexer Store                                                      client go tools cache index go    IndexFunc knows provide indexed value object  type IndexFunc func obj interface       string  error     Index maps indexed value set keys store match value type Index map string sets String   sets String map string struct               Indexers maps name IndexFunc type Indexers map string IndexFunc    Indices maps name Index type Indices map string Index                                     client go       IndexFunc  MetaNamespaceIndexFunc    IndexName namespace         Indexers       namespace  MetaNamespaceIndexFunc             Store   Key default test app Pod          map        Indexers    namespace  MetaNamespaceIndexFunc  Index   default    default test app     Indices    namespace    default    default test app                    Indexer             client go tools cache store go type cache struct      cacheStorage bears burden thread safety cache cacheStorage ThreadSafeStore    keyFunc used key objects stored retrieved items     deterministic  keyFunc KeyFunc      KeyFunc knows key object  Implementations deterministic  type KeyFunc func obj interface     string  error         client go tools cache threadsafestore go type ThreadSafeStore interface   Add key string  obj interface    Update key string  obj interface    Delete key string  Get key string   item interface    exists bool  List     interface   ListKeys     string Replace map string interface    string  Index indexName string  obj interface       interface    error  IndexKeys indexName  indexKey string     string  error  ListIndexFuncValues name string    string ByIndex indexName  indexKey string     interface    error  GetIndexers   Indexers    AddIndexers adds indexers store  call already data    store  results undefined  AddIndexers newIndexers Indexers  error Resync   error      threadSafeMap implements ThreadSafeStore type threadSafeMap struct   lock sync RWMutex items map string interface      indexers maps name IndexFunc indexers Indexers    indices maps name Index indices Indices            cache        map string interface     Go       sync Map       sync RWMutex               indexers indices             KeyFunc             MetaNamespaceKeyFunc       cache Add          indexers indices KeyFunc            Add inserts item cache  func  c  cache  Add obj interface    error   key  err    c keyFunc obj  err    nil   return KeyError obj  err    c cacheStorage Add key  obj  return nil             KeyFunc   obj                 Add   func  c  threadSafeMap  Add key string  obj interface      c lock Lock   defer c lock Unlock   oldObject    c items key  c items key    obj c updateIndices oldObject  obj  key             key   obj   Indices                         updateIndices modifies objects location managed indexes  update  provide oldObj    updateIndices called function already lock cache func  c  threadSafeMap  updateIndices oldObj interface    newObj interface    key string       old object  need remove add again oldObj    nil   c deleteFromIndices oldObj  key    name  indexFunc    range c indexers   indexValues  err    indexFunc newObj  err    nil   panic fmt Errorf  unable calculate index entry key  q index  q   v   key  name  err     index    c indices name  index    nil   index   Index   c indices name    index   _  indexValue    range indexValues   set    index indexValue  set    nil   set   sets String   index indexValue    set   set Insert key            KeyFunc Indices Indexers                               Indices     Indexers     IndexFunc      IndexValues     Name Index                 IndexValues      set         key   set                ",
        "objectID": "posts/kubernetes-informer-localstore",
        "date": "2021-03-18T12:35:51.000Z",
        "lastmod": "2021-03-18T12:35:51.000Z",
        "draft": false,
        "keywords": [
            "informer",
            "kubernetes"
        ],
        "description": "",
        "tags": [
            "informer",
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubernetes Informer",
        "uri": "posts/kubernetes-informer",
        "content": "Informer DeltaFIFO Informer LocalStore",
        "objectID": "posts/kubernetes-informer",
        "date": "2021-03-18T12:40:39.000Z",
        "lastmod": "2021-03-18T12:40:39.000Z",
        "draft": false,
        "keywords": [
            "informer",
            "kubernetes"
        ],
        "description": "",
        "tags": [
            "informer",
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kube-scheduler InterPodAffinity性能优化史",
        "uri": "posts/kubernetes-interpodaffinity",
        "content": "Kubernetes        Kube scheduler                                           InterPodAffinity                                            Kubernetes                                                             InterPodAffinity                                                          Pod     Pod          Node       Pod                                      Pod           Pod                                                        Pod                Node           Kube scheduler                    2000           1                                                                                8                    10                                                                                                                                                                               8                              10         M                N   N       X                       1 15 4 InterPodAffinity                    i        j   i   k       j      k  l             l    i    lock   map l     k    unlock                     M   N   X   M             goroutine           map key                map                      1 15 5   1 16                                                              i        j   i   k       j      k  i             l    i    slice i    atomic add slice i   k        1 17 0   1 18              M   N   X   M    M   N   X     map   key map   value                                           i        j   i   k       j      k  lock map   key map i    value     k    unlock i        scorei       map   key                                        map                   goroutine    map               1 19 0                                 map                     map           map     submap         submaps      submap              submap   sub_maps                                      map               map                         index     1 i        j   i   k       j      k  sub_mapsatomic add index  1 map i    value     k    submap submaps map  key   sub_map  key i        scorei       map   key                                                                                         perf",
        "objectID": "posts/kubernetes-interpodaffinity",
        "date": "2021-06-08T12:24:22.000Z",
        "lastmod": "2021-06-08T12:24:22.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "性能优化",
            "interpodaffinity"
        ],
        "description": "",
        "tags": [
            "性能优化",
            "kubernetes"
        ],
        "categories": [
            "性能优化"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubelet重启导致容器重启",
        "uri": "posts/kubernetes-kubelet-restart",
        "content": "cgroup         kubelet         kubelet                                                                       1 12 4                  3                                                                                                                       1   auto srv cwhttp sf 30b71 0   py   10 86 98 42        1     2   conf master sf 19cf6 0   us01   10 15 29 31        1     3   opensource sf dc750 2   us01   10 15 29 31         1                   kubelet      kubelet    py         2020 03 12 10 42 27                                         root ddcloud underlay kube node065 py    grep 0312  var log kubernetes kubelet INFO   grep  E  10 42 26 10 42 27    grep  E  8a61fda8d43e4c28d4092a1bc8e5f372846d955ffffe0353a754c2e42f271b56 auto srv cwhttp sf 30b71 0 bfde4b15 cb98 11e8 a3c8 6c92bf85beda    grep  v  i volume I0312 10 42 26 101676 2353235 kubelet go 1887  SyncLoop  ADD   api     lifejuhe pre sf d46e3 0default 9c048a53 53b2 11ea b6ae 6c92bf85be08   prime manager sf 71a2e 2default 35bc54e5 4ef1 11ea b6ae 6c92bf85be08   ai business sf 0cac5 19default b60c0a18 4d70 11ea b6ae 6c92bf85be08   disconf sf 92894 2default 4ae4dfb8 fee4 11e9 b433 6c92bf85be08   am base api new sf de855 4default e59f4da9 cd68 11e9 92ca 6c92bf85be08   auto srv menu sf 96f75 1default eb6ef2a6 4c7c 11ea b6ae 6c92bf85be08   pre 000default d8f7688a cc39 11e8 a3c8 6c92bf85beda   auto wechat srv sf e680a 0default 9a6e0fc8 051c 11ea b433 6c92bf85be08   oracle pre sf 253a7 0default c0cef405 5fa8 11ea b6ae 6c92bf85be08   auto srv cwhttp sf 30b71 0default bfde4b15 cb98 11e8 a3c8 6c92bf85beda   auto srv chewu sf dc750 0default 1d9eac73 620a 11ea b6ae 6c92bf85be08   member sf 747bb 64default 4e761a14 634e 11ea b6ae 6c92bf85be08   ep arch tmp bh sf 1eaad 4default 7a2d3f79 001a 11e9 a95b 6c92bf85beda   nsky htw h5 extranet sf 900e8 1default 10ac4571 08c5 11e9 a95b 6c92bf85beda   fate saver pre sf 5cee9 0default 39915cd3 f70f 11e9 b433 6c92bf85be08   shortserver sf ab776 4default d1909587 6362 11ea b6ae 6c92bf85be08   rainbow h5 sf c72e4 3default cba38b41 1cbe 11ea b433 6c92bf85be08   agency call service sf 674c2 29default e74635f4 5b46 11ea b6ae 6c92bf85be08   hnc ddrccp sf db379 1default f16fbe5f 9ba4 11e9 a777 6c92bf85be08   log hnc sf 6a5be 152default a87148b5 c002 11e9 92ca 6c92bf85be08   actinia service py sf 61fb7 0default 75ef3250 3998 11e9 a95b 6c92bf85beda   its timing test sf 8dcfc 0default 3ad3b185 d175 11e8 a3c8 6c92bf85beda   de st forecastor sf 5a382 3default 5c6c02b8 ea6c 11e9 8a9f 6c92bf85be08   transit compass sf 69886 3default 5f28569f 7152 11e9 9a4a 6c92bf85be08   gundam centos6 002default 3d075c28 042a 11e9 b650 6c92bf85be08   loan credit server sf c411b 4default 6455d8e9 61fe 11ea b6ae 6c92bf85be08   marketingmodel service sf b1260 16default 9d570b88 5f31 11e9 9b14 6c92bf85beda   csi hnc sf a8523 16default b6078000 5f60 11ea b6ae 6c92bf85be08   ms shutdown datadriver sf 30b86 4default 805e9837 f0d7 11e9 a648 6c92bf85be08   abnormal shutdown service sf 342c4 18default ccb413e6 d832 11e9 92ca 6c92bf85be08   fate lancer sf 49896 2default 241ad7ce 5c53 11ea b6ae 6c92bf85be08   jetfire sf 7dbf2 2default 13f50c1d 5de8 11ea b6ae 6c92bf85be08   hnc pre v sf 745f9 0default 70a98be0 3fbe 11e9 a95b 6c92bf85beda   orderpre sf b433d 0default 03f84b30 1760 11ea b433 6c92bf85be08   gatewayserver sf fc2e7 9default 310030c4 62b3 11ea b6ae 6c92bf85be08   base message service sf 1b6f0 2default f63261ce d0aa 11e9 92ca 6c92bf85be08   athena api pre sf d61bf 0default 9f7e4183 0089 11ea b433 6c92bf85be08   soda f api sf c88f2 2default fc9520db 8211 11e9 913a 6c92bf85beda   soda d api py sf c6659 5default af4a67f9 3216 11ea b433 6c92bf85be08   rollsroyce pre sf 6ed43 0default 78a053cf 6375 11ea b6ae 6c92bf85be08   member sf 747bb 74default 7323a872 634e 11ea b6ae 6c92bf85be08   settle consumer abtest hnc pre v sf b18cf 0default d199f994 6363 11ea b6ae 6c92bf85be08   dpub vote pre sf bc747 0default 7388d4f7 1a82 11ea b433 6c92bf85be08   delta hub web sf bc67e 2default 35699c85 620c 11ea b6ae 6c92bf85be08   drunkeness model service sf a38a4 43default c3cd5daa 5b47 11ea b6ae 6c92bf85be08   lifeapi hnc sf 4a88c 2default 46c7368a 026c 11e9 a95b 6c92bf85beda   prod data service sf a1520 0default 21e423b0 d04f 11e9 92ca 6c92bf85be08   seed pre sf 53a95 0default c51e0a0f 592a 11ea b6ae 6c92bf85be08   I0312 10 42 26 101950 2353235 predicate go 80  pod auto srv cwhttp sf 30b71 0 running local node  just admit it  I0312 10 42 26 101969 2353235 probermanager go 160  DEFAULTPROBER  pod auto srv cwhttp sf 30b71 0 notready state Running  no readiness prober  add default one  I0312 10 42 26 102104 2353235 kubeletpods go 1424  Generating status  auto srv cwhttp sf 30b71 0default bfde4b15 cb98 11e8 a3c8 6c92bf85beda   I0312 10 42 26 101980 2353235 worker go 95  INITIAL_STATUS  Running   Initialized True 0001 01 01 00 00 00  0000 UTC 2018 10 09 15 55 54  0800 CST    Ready False 0001 01 01 00 00 00  0000 UTC 2018 12 26 12 14 26  0800 CST    ContainersReady True 0001 01 01 00 00 00  0000 UTC 2019 04 03 20 02 17  0800 CST    PodScheduled True 0001 01 01 00 00 00  0000 UTC 2018 10 09 15 55 54 ",
        "objectID": "posts/kubernetes-kubelet-restart",
        "date": "2020-10-26T13:27:30.000Z",
        "lastmod": "2020-10-26T13:27:30.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "kubelet",
            "restart",
            "pod"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Pod创建流程",
        "uri": "posts/kubernetes-pod-create",
        "content": "kubernetes     v1 12 kubelet      kubelet                             pod                                   pod             SyncLoop                             pod         pod          node           pod      kubelet           handler      HandlePods            pod   kubelet        kubelet                 pod      Handler    ADD              kubelet      pod       podStatus      pod      volume                          update      kubelet      pod                              kubelet    pod     kubelet    pod     1 kubelet       syncLoop  syncLoop          syncTicker   housekeepingTicker           pod    kubelet             pod                 syncLoopIteration                     kubelet      runtimeState           5         func  kl  Kubelet  syncLoop updates static pod    kubelet       k8s apiserver        static pod                rs          kubelet                  Kubelet     apiserver      static pod         mirror pod             kubectl         pod        kubectl logs        static pod        4      dispatchWork  dispatchWorker            Pod                  podWorkers  func  kl Kubelet  dispatchWork pod v1 Pod  syncType kubetypes SyncPodType  mirrorPod  v1 Pod  start time Time    kl podIsTerminated pod    pod DeletionTimestamp    nil   kl statusManager TerminatePod pod    return          podWorkers   kl podWorkers UpdatePod  UpdatePodOptions  Pod  pod  MirrorPod  mirrorPod  UpdateType  syncType  OnCompleteFunc  func err error    err    nil   metrics PodWorkerLatency WithLabelValues syncType String    Observe metrics SinceInMicroseconds start           syncType    kubetypes SyncPodCreate   metrics ContainersPerPodCount Observe float64 len pod Spec Containers        5       channel UpdatePod  podWorkers                    Pod          Pod             podWorkers               Pod         goroutine        channel goroutine         channel                     podWorkers                     func  p podWorkers  UpdatePod options UpdatePodOptions    pod    options Pod uid    pod UID var podUpdates chan UpdatePodOptions var exists bool p podLock Lock   defer p podLock Unlock           pod        goroutine      goroutine      channel podUpdates  exists   p podUpdates uid    exists         channel podUpdates   make chan UpdatePodOptions  1  p podUpdates uid    podUpdates       goroutine go func     defer runtime HandleCrash   p managePodLoop podUpdates                   p isWorking pod UID    p isWorking pod UID    true podUpdates",
        "objectID": "posts/kubernetes-pod-create",
        "date": "2019-08-06T12:41:24.000Z",
        "lastmod": "2019-08-06T12:41:24.000Z",
        "draft": false,
        "keywords": [
            "kubelet",
            "kubernetes",
            "Pod Create"
        ],
        "description": "kubelet pod创建主流程",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Statefulset创建pod慢",
        "uri": "posts/kubernetes-statefulset-sync",
        "content": "kubernetes     sts   pod                            kube odin       300s                   watch sts       sts              sts    kube controller manager sts              loglevel   4                    sts       kube controller manager      4                      sts    sts                                    sts                                    watch             kube controller manager  watch   kube scheuler watch           watch     sts          sts                                                 watch   sts                                                   sts                sts   2000       sts  40ms                   40ms 2000 80s                           kube controller manager             sts                    2             watch   sts                        sts       sts                        sts                          setInformer Informer   AddEventHandlerWithResyncPeriod  cache ResourceEventHandlerFuncs  AddFunc  ssc enqueueStatefulSet  UpdateFunc  func old  cur interface      oldPS    old   apps StatefulSet  curPS    cur   apps StatefulSet  oldPS Status Replicas    curPS Status Replicas   glog V 4  Infof  Observed updated replica count StatefulSet   v   d   d   curPS Name  oldPS Status Replicas  curPS Status Replicas    ssc enqueueStatefulSet cur     DeleteFunc  ssc enqueueStatefulSet     statefulSetResyncPeriod     30s                   watch sts          sts        30s    sts                 80s       sts            30s         sts                    sts                            sts       sts          2000      watch              sts       Pod      sts controller              sts         Demo                 package main import    fmt   k8s io api apps v1   k8s io client go informers   k8s io client go kubernetes   k8s io client go rest   k8s io client go tools cache   k8s io client go util workqueue   log   math rand   time   unsafe    var queue workqueue RateLimitingInterface func main     defer queue ShutDown   clientset  _    kubernetes NewForConfig  rest Config  Host   http   10 80 101 22 8080      factor    rand Float64     1 syncPeriod    time Duration float64 time Duration 12time Hour  Nanoseconds    factor  informerFactory    informers NewSharedInformerFactory clientset  syncPeriod  stopChan    make chan struct    informerFactory Start stopChan  informerFactory WaitForCacheSync stopChan  stsInformer    informerFactory Apps   V1   StatefulSets   Informer       sts controller   30s      sts stsInformer AddEventHandlerWithResyncPeriod cache ResourceEventHandlerFuncs  AddFunc  onAdd  UpdateFunc  onUpdate  DeleteFunc  onDelete     30 time Second  go consume   stsInformer Run stopChan    func init     queue   workqueue NewNamedRateLimitingQueue workqueue DefaultControllerRateLimiter     statefulset     func consume       func     key  quit    queue Get   quit   fmt Println  done   return   defer queue Done key  sts    key   v1 StatefulSet           sts  40ms time Sleep 40   time Millisecond  log Printf  cosumed  s  queue count   d   sts Name  queue Len            func onAdd obj interface      sts    obj   v1 StatefulSet  sts Name     test delay sf 60f09    log Printf  add address   d   unsafe Pointer sts     queue Add sts    func onUpdate old  new interface      sts    old   v1 StatefulSet         sts                                sts              queue   sts  map key               sts Name     test delay sf 60f09    log Printf  update address   d   unsafe Pointer sts     queue Add sts    func onDelete obj interface      sts    obj   v1 StatefulSet  sts Name     test delay sf 60f09    log Printf  update address   d   unsafe Pointer sts     queue Add sts                queue        2000     1525           sts  2000  queue                 sts      sts               824689074368                                       30s              controller  ReplicationController ServiceController EndpointsController                          sts       queue       sts                 sts resourceversion          sts                             1      30s       https   github com kubernetes kubernetes pull 75622          30s         kube apiserver          Informer          Indexer                                            issue https   github com kubernetes kubernetes issues 75495   sts              k8s            30s         Operator      Controller                             Informer",
        "objectID": "posts/kubernetes-statefulset-sync",
        "date": "2019-03-26T03:16:03.000Z",
        "lastmod": "2019-03-26T03:16:03.000Z",
        "draft": false,
        "keywords": [
            "statefulset",
            "kubernetes",
            "sync"
        ],
        "description": "create pod slowly",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "问题排查",
            "性能优化"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubenetes NUMA拓扑感知功能介绍",
        "uri": "posts/kubernetes-topology-manager",
        "content": "NUMA                   kubelet                               NUMA                                                       blog                                          TopologyManager TopologyManager  1 18      beta          CPU          SR IOV VF   GPU   NUMA                               TopologyManager    CPU                             Multi Socket                            TopologyManager                     blog        NUMA                    CPU       NUMA       TopologyManager        TopologyManager      TopologyManager           NUMA            NUMA   Non Uniform Memory Access            CPU                CPU                          CPU           CPU                             CPU                                              NIC   GPU               CPU                      NUMA              NUMA             CPU                CPU         NUMA               NUMA                                         NUMA               1   CPU 0 3     NUMA node 0        CPU 4 7   NUMA node 1         GPU 0   NIC 0     NUMA node 0               Socket 0   CPU    NUMA node 0       NUMA node 1    GPU 1   NIC 1                  NUMA     Socket   1 1                     NUMA          Socket      Socket     CPU          NUMA        Sub NUMA Clustering         CPU               CPU     NUMA                                      NUMA    TopologyManager              none                         TopologyManager                  best effort       TopologyManager           NUMA                       NUMA              pod     restricted                                  pod         single numa node               NUMA                       NUMA     single numa node                    CPU           NUMA       pod                          pod                                         kubelet             pod           pod                               kubelet             topology manager policy   none   best effort   restricted   single numa node    feature gate          1 16    1 18               feature gates      TopologyManager                             pod spec     CPU   device  request                       intel com sriov nvidia com gpu                          TopologyManager                            Nvidia GPU          SRIOV                             TopologyManager             CPU     CPUManager            static       pod     QoS          CPU               CPU                    1 2 1000m      CPU                CPUManager                CPUManager      static               gpu vendor com   nic vendor com            TopologyManager           pod        TopologyManager           spec  containers  name  numa aligned container image  alpine resources  limits  cpu  2 memory  200Mi gpu vendor com gpu  1 nic vendor com nic  1          1                cpu   0  1   gpu  0  nic  0   cpu   0  2   gpu  0  nic  0   cpu   0  3   gpu  0  nic  0   cpu   1  2   gpu  0  nic  0   cpu   1  3   gpu  0  nic  0   cpu   2  3   gpu  0  nic  0   cpu   4  5   gpu  1  nic  1   cpu   4  6   gpu  1  nic  1   cpu   4  7   gpu  1  nic  1   cpu   5  6   gpu  1  nic  1   cpu   5  7   gpu  1  nic  1   cpu   6  7   gpu  1  nic  1              TopologyManager               CPU        NUMA            Pod   TopologyManager              Terminated        Pod       TopologyAffinityError         pod       Kubernetes                          replicas   deployment               pod                         TopologyAffinityError   pod             TopologyManager                  container    range append InitContainers  Containers       provider    range HintProviders   hints    provider GetTopologyHints container    bestHint    policy Merge hints  provider    range HintProviders   provider Allocate container  bestHint                                    pod                                    gpu vendor com gpu nic vendor com nic cpu       HintProviders     TopologyHints                 TopologyHints                               HintProviders                            pod                                     Pod                                  TopologyHints   HintProviders                           TopologyHints TopologyHint                                        NUMA             type TopologyHint struct   NUMANodeAffinity bitmask BitMask Preferred bool   NUMANodeAffinity               NUMA               2   NUMA                 00    01    10    11  Preferred                               best effort             Preferred         Preferred        restricted    numa node      Preferred             HintProviders                         TopologyHints                     NUMA               TopologyHint                              2      HintProvider        2   NUMA                                NUMA    0   1             NUMA                     01  True    10  True    11  False          NUMANodeAffinity               NUMA         HintProvider    Preferred       True                      NUMA     TopologyHint   True                        NUMA          2             2          NUMA             True   0011  True    0111  False    1011  False    1111  False             Preferred   ",
        "objectID": "posts/kubernetes-topology-manager",
        "date": "2021-06-18T10:59:04.000Z",
        "lastmod": "2021-06-18T10:59:04.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "topology",
            "拓扑",
            "numa"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "原理介绍"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "netns泄露",
        "uri": "posts/netns-leak",
        "content": "1            RD                             driver api          duse api    TCP telnet                                IP    ping                                 IP                                RD                                                    arp    duse api    IP     MAC      telnet        arp    MAC          arp   MAC        MAC         MAC                   net ns              sudo ip netns ls   read ns  sudo ip netns exec  ns ip addr  done   grep inet   grep  v 127   awk   print  2     sort   uniq  c           IP         IP                               2                                  net ns             net ns                 net ns                        ip netns         var run netns              net ns          kubelet  docker      docker  net ns                   ip netns                                             mount   var run netns                                      net ns          var run netns                      ns        2020 04 17 11 34 07                                                     2020 04 17 11 33 26            2020 04 17 11 34 24           2020 04 17 11 34 28                2020 04 17 11 36 22           2020 04 17 11 36 31                                           ns                                      kubelet                           I0417 11 36 30 974674 37736 kubelet_pods go 1180  Killing unwanted pod  duse api sf xxxxx 0  I0417 11 36 30 976803 37736 plugins go 391  Calling network plugin cni tear down pod  duse api sf 80819 0_default  I0417 11 36 30 983499 37736 kubelet_pods go 1780  Orphaned pod  4ae28778 805c 11ea a54c b4055d1e6372  found  removing pod cgroups I0417 11 36 30 986360 37736 podcontainermanager_linux go 167  Attempt kill process pid  48892 I0417 11 36 30 986382 37736 podcontainermanager_linux go 174  successfully killed unwanted processes          I0417 11 36 30 974674              Pod   I0417 11 36 30 976803   cni           I0417 11 36 30 983499        Pod                      cgroup I0417 11 36 30 986360   cgroup              I0417 11 36 30 986382                                                        cgroup                                    Pod              podIsTerminated returns true pod terminated state   Failed   Succeeded    func  kl Kubelet  podIsTerminated pod v1 Pod  bool      Check cached pod status set last sync  status  ok    kl statusManager GetPodStatus pod UID   ok      no cached status  use status    apiserver  useful kubelet recently    restarted  status   pod Status   return status Phase    v1 PodFailed    status Phase    v1 PodSucceeded     pod DeletionTimestamp    nil    notRunning status ContainerStatuses                                                                 Pod sandbox                    kubelet                    cni        cni    Pod             pid 98497  2020 04 17 11 36 30 990707 main go 89        start cni process        pid 98497  2020 04 17 11 36 30 990761 main go 90  os env   CNICOMMAND DEL CNICONTAINERID c2ef79f7596b6b558f0c01c0715bac46714eefd1e9966625a09414c7218e1013 CNINETNS  proc 48892 ns net CNIARGS IgnoreUnknown 1 K8SPODNAMESPACE default K8SPODNAME duse api sf xxxxx 0 K8SPODINFRACONTAINERID c2ef79f7596b6b558f0c01c0715bac46714eefd1e9966625a09414c7218e1013 CNIIFNAME eth0 CNIPATH  home kaku kakucloud cni plugins bin LANG enUS UTF 8 PATH  usr local sbin  usr local bin  usr sbin  usr bin KUBELOGTOSTDERR   logtostderr false KUBELOGLEVEL   v 3 KUBEALLOWPRIV   allow privileged true KUBEMASTER   master https   10 xxx xxx xxx xxxx KUBELETADDRESS   address 0 0 0 0 KUBELETHOSTNAME   hostnameoverride 10 xxx xxx xxx KUBELETPODINFRACONTAINER  KUBELETARGS   network plugin cni   cni bin dir  home kaku kakucloud cni plugins bin   cni conf dir  home kaku kakucloud cni plugins conf   kubeconfig  etc kubernetes kubeconfig kubelet kubeconfig   cert dir  etc kubernetes ssl   log dir  var log kubernetes   stderrthreshold 3   allowed unsafe sysctls net  kernel shm kernel msg kernel sem fs mqueue    pod infra container image registry kaku com kakuk8s pause 3 0   eviction hard    image gc high threshold 75   image gc low threshold 65   feature gates KubeletPluginsWatcher false   restart count limit 5   last upgrade time 2019 07 01   pid 98497  2020 04 17 11 36 30 990771 main go 91  stdin     cniVersion   0 3 0   logDir    home kaku kakucloud cni plugins acllogs   name   ddcloudcni   type   aclCni    pid 98497  2020 04 17 11 36 30 990790 main go 181  failed Statfs   proc 48892 ns net   no file directory  pid 98497  2020 04 17 11 36 30 990814 main go 94        end cni process          main go 181                           func cmdDel args  skel CmdArgs  error   n  _  err    loadConf args StdinData  err    nil   return err   netns  err    ns GetNS args Netns  err    nil   log Println err       Line 181 return fmt Errorf  failed open netns  q   v   netns  err    defer netns Close              cni                    181       cni                                                                         Pod               Pod cgroup    Pod sandbox             cni          sandbox pause                        cni                                       ",
        "objectID": "posts/netns-leak",
        "date": "2020-10-26T13:42:48.000Z",
        "lastmod": "2020-10-26T13:42:48.000Z",
        "draft": false,
        "keywords": [
            "netns",
            "cni",
            "leak"
        ],
        "description": "",
        "tags": [
            "cni"
        ],
        "categories": [
            "问题排查"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kinitiras - 可编程 webhook 规则引擎详解",
        "uri": "posts/opensource/kinitiras-all",
        "content": "1            Webhook                     HTTP                   webhook           Webhook           Webhook          Webhook                 API                                    API                        Webhook                                      kubernetes            k8s   webhook      validating   mutating           k8s                     apiserver     http      validating   mutating webhook     webhook                                   k8s       webhook                              k8s             webhook                      k8s                   CRD                         webhook             apiserver                            webhook                                             label annotation                                                                      webhook   apiserver                                                    webhook    kinitiras                   webhook                           webhook              webhook          2                             kinitiras              2 1                                                                                                                            ns deployment                        annotation                             object           object        cm    secret     object          http                2 2                                                        annotation              affinity toleration                         object        owner       pod           http                  3    Kinitiras                   kini t  ras         engine motor                                    3 1                                                                                                                          validating                       mutating                      policy                           override policy                          validate policy                          cue   cue                 json    https   cuelang org   3 2      kinitiras              validating   mutating     crd        policy                    label                      webhook configuration            label                            apiserver                                             3 3 Api definition          CRD  OverridePolicy           namespace     ClusterOverridePolicy           cluster     ClusterValidatePolicy           cluster            crd              3 3 1 Resource selector ResourceSelector resources will selected    Field   type   required   Description                                                                                                                                                                apiVersion   string   Y   APIVersion represents API version target resources      kind   string   Y   Kind represents Kind target resources      namespace   string   N   Namespace target resource  Default empty  means inherit parent object scope      name   string   N   Name target resource  Default empty  means selecting resources      labelSelector   Kubernetes meta v1 LabelSelector   N   label query set resources  name not empty  labelSelector will ignored      fieldSelector   FieldSelector   N   field query set resources  name not empty  fieldSelector wil ignored                                       label   field              example  match pod contains label webhook enabled resourceSelectors  apiVersion  v1 kind  Pod labelSelector  matchLabels  webhook  enabled 3 3 2 Validate rule Defines validate rules operations    Field   type   required   Description                                                                                                                                                                   targetOperations     Kubernetes admission v1 Operation   Y   Operations operations admission hook cares   CREATE  UPDATE  DELETE  CONNECT   operations future admission operations added    present  length slice one      cue   string   N   Cue represents validate rules defined cue code      template   ValidateRuleTemplate   N   Template condition defines validate cond  will rendered CUE store RenderedCue field  so data added manually will erased      renderedCue   string   N   RenderedCue represents validate rule defined Template  Don t modify value field  modify Rules instead of          validate              targetOperations                     delete      cue          cue                      Example template                              cue    renderedCue            cue             cue example  validateRules                 label                      cue     object  _  tag object  reject  object metadata labels    null    object metadata labels  xxx io no delete       true  validate    reject  reason   operation rejected     reject  reason       valid   reject   targetOperations  DELETE template example        no delete annotation            validateRules  targetOperations  DELETE template  type  condition        condition           condition  affectMode  reject                    allow                reject cond  Exist                      message   cannot delete ns             dataRef            from  current ",
        "objectID": "posts/opensource/kinitiras-all",
        "date": "2023-02-03T07:09:26.000Z",
        "lastmod": "2023-02-03T07:09:26.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "admission webhook",
            "rule engine"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "开源项目介绍"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "admission webhook 花式玩法 - kinitiras 发送 http(s) 请求",
        "uri": "posts/opensource/kinitiras-cue-http",
        "content": "Admission Webhook               http             v0 1 1                       kinitiras     http        kinitiras                           CUE       http s             processing      output              http response              http     CUE http           object  _  tag object  processing    http    method    GET    string url   http   127 0 0 1 8090 api v1 token val test token  request    body    bytes header     Accept Language    en nl    trailer     Accept Language    en nl  User   foo        output    token   string     validate   reason   hello cue  valid  object metadata name     ut cue success with parameter     processing output token     test token         CUE            k8s         http   127 0 0 1 8090 api v1 token val test token    token         validate          k8s        ut cue success with parameter    http        token   test token          CUE http        kubevela                    CUE     internal                    builtin",
        "objectID": "posts/opensource/kinitiras-cue-http",
        "date": "2022-07-18T12:35:09.000Z",
        "lastmod": "2022-07-18T12:35:09.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "admission webhook",
            "rule engine"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "开源项目介绍"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "admission webhook 花式玩法 - kinitiras",
        "uri": "posts/opensource/kinitiras",
        "content": "kubernetes                                                        namespace crd                                                        Label            io      io                     workload    per pod per config                  debug                                           admission webhook                 admission webhook                                    kube builder controller runtime          admission webhook                                                         admission webhook               wehook                                      admission webhok                                 webhook                  Kinitiras                   rule engine                          mutate   validate          CUE                                                      Mutate     OverridePolicy   ClusterOverridePolicy     Mutate        Namespace             Namespace            Cluster                Namespace                                                                   ClusterOverridePolicy                         kind  ClusterOverridePolicy apiVersion  policy kcloudlabs io v1alpha1 metadata  name  add anno cop cue spec  resourceSelectors  apiVersion  v1 kind  Pod labelSelector  matchLabels  kinitiras kcloudlabs io webhook  enabled overrideRules  targetOperations  CREATE overriders  cue     object  _  tag object  patches    object metadata annotations          op   add  path    metadata annotations  value            op   add  path    metadata annotations added by  value   cue      kind  OverridePolicy apiVersion  policy kcloudlabs io v1alpha1 metadata  name  add anno op plaintext namespace  default spec  resourceSelectors  apiVersion  v1 kind  Pod labelSelector  matchLabels  kinitiras kcloudlabs io webhook  enabled overrideRules  targetOperations  CREATE overriders  plaintext  path   metadata annotations added by op  add value  op                    resourceSelector                                overrideRules                   targetOperations                     overriders                      json patch     patches       kube apiserver         overriders plaintext cue                                                         cue                                       object                 patches          object  _  tag object  patch    op  string path  string value  string      mutating result patches      patch               ResourceSelector resources will selected  type ResourceSelector struct      APIVersion represents API version target resources      required APIVersion string json  apiVersion     Kind represents Kind target resources      required Kind string json  kind     Namespace target resource     Default empty  means inherit parent object scope      optional Namespace string json  namespace omitempty     Name target resource     Default empty  means selecting resources      optional Name string json  name omitempty     label query set resources     name not empty  labelSelector will ignored      optional LabelSelector  metav1 LabelSelector json  labelSelector omitempty       Overriders offers various alternatives represent override rules        one alternatives exist  will applied following order       Cue      Plaintext type Overriders struct      Plaintext represents override rules defined plaintext overriders      optional Plaintext   PlaintextOverrider json  plaintext omitempty     Cue represents override rules defined cue code      optional Cue string json  cue omitempty                 Namespace   Pod       kinitiras kcloudlabs io webhook  enabled Label       annotation   added by  cue    default    Pod       kinitiras kcloudlabs io webhook  enabled Label       annotation   added by  op          apply          default       Pod       Label        Pod annotation     added by  op    OverridePolicy         ClusterOverridePolicy      Validate     ClusterValidatePolicy                                                                                    apiVersion  policy kcloudlabs io v1alpha1 kind  ClusterValidatePolicy metadata  name  test delete ns spec  validateRules  cue     object  _  tag object  reject  object metadata labels    null    object metadata labels  kinitiras kcloudlabs io webhook       enabled  validate    reject  reason   operation rejected     reject  reason       valid   reject   targetOperations  DELETE resourceSelectors  apiVersion  v1 kind  Namespace    resourceSelector                                validateRules                   targetOperations                cue                kube apiserver   Mutate      Validate     cue      cue                                      object oldObject           UPDATE              validate          object  _  tag object  oldObject  _  tag oldObject     validating result validate    reason   string valid  bool                  kinitiras kcloudlabs io webhook  enabled     namespace        CRD    kubectl apply  f https   raw githubusercontent com k cloud labs pkg main charts crds bases policy kcloudlabs iooverridepolicies yaml kubectl apply  f https   raw githubusercontent com k cloud labs pkg main charts crds bases policy kcloudlabs ioclusterove",
        "objectID": "posts/opensource/kinitiras",
        "date": "2022-05-12T02:21:43.000Z",
        "lastmod": "2022-05-12T02:21:43.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "admission webhook",
            "rule engine"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "开源项目介绍"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "k8s 集群容量分析工具 - kluster-capacity",
        "uri": "posts/opensource/kluster-capacity",
        "content": "Kubernetes                                                                                              Kubernetes                                                                                  K8s                                                                                                                                                              kluster capacity                                                                       Pod                                                                                                   CPU                                                                     Pod                                          Pod    Pod             Pod                      pod        kluster capacity ce   kubeconfig   schedulerconfig    pods from template          pod          kluster capacity ce   kubeconfig   schedulerconfig    pods from cluster                        kluster capacity ce   help            4      1            2   CPU   4GB        Pod        150m CPU   100Mi         kluster capacity ce   kubeconfig   schedulerconfig    pods from template   verbose Pod requirements  cpu  150m memory  100Mi cluster schedule 52 instance s  pod  Termination reason  FailedScheduling  pod  small pod 52  failed fit node fit failure node  kube node 1   Insufficient cpu fit failure node  kube node 4   Insufficient cpu fit failure node  kube node 2   Insufficient cpu fit failure node  kube node 3   Insufficient cpu Pod distribution among nodes  kube node 1  13 instance s  kube node 4  13 instance s  kube node 2  13 instance s  kube node 3  13 instance s           pod                   pod             kluster capacity ce   kubeconfig   schedulerconfig    pods from template   verbose Pod requirements  cpu  150m memory  100Mi cluster schedule 46 instance s  pod  Termination reason  FailedScheduling  pod  small pod 46  failed fit node fit failure node  kube node 1   Insufficient cpu fit failure node  kube node 4   Insufficient cpu fit failure node  kube node 2   Insufficient cpu fit failure node  kube node 3   Insufficient cpu Pod distribution among nodes  kube node 1  11 instance s  kube node 4  12 instance s  kube node 2  11 instance s  kube node 3  12 instance s       ce         output   o                json   yaml      kluster capacity ce   kubeconfig   schedulerconfig    pods from template  o json yaml                        node pod                pod          pod                                                                kluster capacity ss   kubeconfig   schedulerconfig                         kluster capacity ss   help           AllSucceed   AllScheduled       pod                 pod                   AllSucceed        exit condition                      4      1            2   CPU   4GB      40        100m CPU   200Mi     Pod                LeastAllocated                    kluster capacity ss   kubeconfig   schedulerconfig  Termination reason  AllSucceed  40 pod s  scheduled successfully  Pod distribution among nodes  kube node 1  10 instance s  kube node 2  10 instance s  kube node 3  10 instance s  kube node 4  10 instance s            MostAllocated                    kluster capacity ss   kubeconfig   schedulerconfig  Termination reason  AllSucceed  40 pod s  scheduled successfully  Pod distribution among nodes  kube node 1  20 instance s  kube node 2  20 instance s                                                 2            50                                  node pod                                                                                            kluster capacity cc   kubeconfig   schedulerconfig    verbose                        kluster capacity cc   help            4      1            2   CPU   4GB        40        100m CPU   200Mi     Pod    kluster capacity cc   kubeconfig   schedulerconfig    verbose 2 node s  cluster scaled down  Termination reason  FailedSelectNode  not find node satisfies condition  1 master node s   2 node s  can t scale down insufficient resource nodes  nodes selected scaled down  kube node 1 kube node 3            40   pod             pod                  2          2      50                                                   snapshot                                                                                                https   cloud tencent com developer support plan invite_code ue85q0jbdgn2",
        "objectID": "posts/opensource/kluster-capacity",
        "date": "2023-02-20T15:17:31.000Z",
        "lastmod": "2023-02-20T15:17:31.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "capacity",
            "容量"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "开源项目介绍"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "调度器压测工具介绍",
        "uri": "posts/opensource/scheduler-stress-test",
        "content": "P0                                                Pod                                                                                                                  scheduler stress test                                              Metrics                           metrics                    k8s io kubernetes pkg scheduler metrics metrics go                   type   query example                                                                                                                                           schedulere2eschedulingdurationsecondscount   count   sum rate schedulere2eschedulingdurationsecondscount job  advanced scheduler  profile  default scheduler  result  scheduled   5m     instance      schedulerpendingpods   gauge   schedulerpendingpods queue  active   job  default scheduler       schedulere2eschedulingdurationsecondsbucket   histogram   histogramquantile 0 99  sum rate schedulere2eschedulingdurationseconds_bucket job  default scheduler   5m     le       schedulerschedulingalgorithmdurationsecondsbucket   histogram   histogramquantile 0 99  sum by le   rate schedulerschedulingalgorithmdurationseconds_bucket job  default scheduler   5m         schedulerbindingdurationsecondsbucket   histogram   histogramquantile 0 99  sum by le   rate schedulerbindingdurationseconds_bucket job  default scheduler   5m                                  Condition            Pod PodScheduled Condition          LastTransitionTime   CreationTimestamp                                                                              Pod            Pod        histogram                               LastTransitionTime          Bind     kube apiserver               Etcd       CreationTimestamp   kube apiserver             Etcd           LastTransitionTime   CreationTimestamp        Create     Etcd                   watch   Pod                 apiserver   apiserver                       metav1 Time          RFC3339                                                                                                       scheduler stress test     Condition               README md                         kwok                     NotReady                  Pod         Pod      toleration       NoSchedule                        k8s       kwok     https   kwok sigs k8s io docs user kwok in cluster       k8s                    cat node yaml apiVersion  v1 kind  Node metadata  annotations  node alpha kubernetes io ttl   0  kwok x k8s io node  fake labels  beta kubernetes io arch  amd64 beta kubernetes io os  linux kubernetes io arch  amd64 kubernetes io hostname   NODE_NAME  kubernetes io os  linux kubernetes io role  agent node role kubernetes io agent     type  kwok name   NODE_NAME  spec  taints    Avoid scheduling actual running pods fake Node effect  NoSchedule key  kwok x k8s io node value  fake status  allocatable  cpu   64  ephemeral storage  1Ti hugepages 1Gi   0  hugepages 2Mi   0  memory  250Gi pods   110  capacity  cpu   64  ephemeral storage  1Ti hugepages 1Gi   0  hugepages 2Mi   0  memory  250Gi pods   128  nodeInfo  architecture  amd64 bootID     containerRuntimeVersion     kernelVersion     kubeProxyVersion  fake kubeletVersion  fake machineID     operatingSystem  linux osImage     systemUUID     phase  Running EOF create nodes needed  0  99   sed  s  NODE_NAME  kwok node  i g  node yaml   kubectl apply  f    done             git clone https   github com k cloud labs scheduler stress test git build           create   wait  create               k8s                    pod  wait             pod                    1000   pod    1000       namespace  scheduler stress test  sst create   kubeconfig  root  kube config   count 1000   concurrency 1000   pod template pod yaml      sst wait   kubeconfig  root  kube config   namespace scheduler stress test            pod yaml        k8s     scheduler stress test          1000   pod                       pod yaml     Enjoy it",
        "objectID": "posts/opensource/scheduler-stress-test",
        "date": "2023-02-12T05:12:38.000Z",
        "lastmod": "2023-02-12T05:12:38.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "scheduler",
            "stress test",
            "stress"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "开源项目介绍"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Prometheus",
        "uri": "posts/prometheus",
        "content": "Prometheus   Kubernetes                                                      Prometheus                         Prometheus   2 3 0     AlertManager   1 4 0                                                                                                                                              Prometheus             metric                                                                        HA               HTTP                                                       AlertManager       Grouping    Inhibition    Silences HA                                                                   Prometheus                                   Short lived job Pushgateway     HAProxy StatsD Graphite    exporter        alertmanager           Prometheus     Go                                   Kubernetes  Prometheus AlertManager       1         Prometheus   HA                                   AlertManager              HA        Prometheus              Kubernetes          AlertManager Pod          Service   service           AlertManager        Docker                                           Yaml         Prometheus      prometheus config yaml apiVersion  v2 kind  ConfigMap metadata  name  prometheus config namespace  kube system data  prometheus yml    global  scrape_interval  15s evaluation_interval  15s rule_files   etc prometheus rules   rules alerting  alertmanagers  static_configs  targets  alertmanager 9093 scrape_configs  job_name   kubernetes apiservers  kubernetessdconfigs  role  endpoints scheme  https tls_config  ca_file   var run secrets kubernetes io serviceaccount ca crt bearertokenfile   var run secrets kubernetes io serviceaccount token relabel_configs  sourcelabels   metakubernetesnamespace  metakubernetesservicename  metakubernetesendpointportname  action  keep regex  default kubernetes https job_name   kubernetes nodes  kubernetessdconfigs  role  node scheme  https tls_config  ca_file   var run secrets kubernetes io serviceaccount ca crt bearertokenfile   var run secrets kubernetes io serviceaccount token relabel_configs  action  labelmap regex  metakubernetesnodelabel     targetlabel  address_ replacement  kubernetes default svc 443 sourcelabels   metakubernetesnodename  regex       targetlabel  metricspath replacement   api v1 nodes   1  proxy metrics job_name   kubernetes cadvisor  kubernetessdconfigs  role  node scheme  https tls_config  ca_file   var run secrets kubernetes io serviceaccount ca crt bearertokenfile   var run secrets kubernetes io serviceaccount token relabel_configs  action  labelmap regex  metakubernetesnodelabel     targetlabel  address_ replacement  kubernetes default svc 443 sourcelabels   metakubernetesnodename  regex       targetlabel  metricspath replacement   api v1 nodes   1  proxy metrics cadvisor job_name   kubernetes service endpoints  kubernetessdconfigs  role  endpoints relabel_configs  sourcelabels   metakubernetesserviceannotationprometheusio_scrape  action  keep regex  true sourcelabels   metakubernetesserviceannotationprometheusio_scheme  action  replace targetlabel  scheme_ regex   https   sourcelabels   metakubernetesserviceannotationprometheusio_path  action  replace targetlabel  metricspath regex       sourcelabels   address  _metakubernetesserviceannotationprometheusioport  action  replace targetlabel  address_ regex          d      d   replacement   1  2 action  labelmap regex  metakubernetesservicelabel     sourcelabels   metakubernetes_namespace  action  replace targetlabel  kubernetesnamespace sourcelabels   metakubernetesservicename  action  replace targetlabel  kubernetesname job_name   kubernetes services  kubernetessdconfigs  role  service metrics_path   probe params  module   http_2xx  relabel_configs  sourcelabels   metakubernetesserviceannotationprometheusio_probe  action  keep regex  true sourcelabels   address_  targetlabel  paramtarget targetlabel  address_ replacement  blackbox exporter example com 9115 sourcelabels   paramtarget  target_label  instance action  labelmap regex  metakubernetesservicelabel     sourcelabels   metakubernetes_namespace  targetlabel  kubernetesnamespace sourcelabels   metakubernetesservicename  targetlabel  kubernetesname job_name   kubernetes ingresses  kubernetessdconfigs  role  ingress relabel_configs  sourcelabels   metakubernetesingressannotationprometheusio_probe  action  keep regex  true sourcelabels   metakubernetesingressscheme address _metakubernetesingresspath  regex                 replacement    1      2   3  targetlabel  paramtarget targetlabel  address_ replacement  blackbox exporter example com 9115 sourcelabels   paramtarget  target_label  instance action  labelmap regex  metakubernetesingresslabel     sourcelabels   metakubernetes_namespace  targetlabel  kubernetesnamespace sourcelabels   metakubernetesingressname  targetlabel  kubernetesname job_name   kubernetes pods  kubernetessdconfigs  role  pod relabel_configs  sourcelabels   metakubernetespodannotationprometheusio_scrape  action  keep regex  true sourcelabels   metakubernetespodannotationprometheusio_path  action  replace targetlabel  metricspath regex       s",
        "objectID": "posts/prometheus",
        "date": "2018-06-21T15:10:36.000Z",
        "lastmod": "2018-06-21T15:10:36.000Z",
        "draft": false,
        "keywords": [
            "prometheus",
            "alertmanager",
            "kubernetes"
        ],
        "description": "Prometheus",
        "tags": [
            "prometheus"
        ],
        "categories": [
            "使用说明"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "大规模容器平台共享资源池的预算，分配，核算机制",
        "uri": "posts/resourcemgmt",
        "content": "https   zhuanlan zhihu com p 408731614                                Google Facebook                          Borg Twine                                                                                                                                     overcomitment                                                                                                                                                                                                                                                                                  SLO              https   storage googleapis com pub tools public publication data pdf f647d24ee7eeb338acebf1eb73a5d11b357620b0 pdf                                                                                                                                                                                                                                                    Consumer Based Expectiation     Service Level Expectation                                               2   5                                                                                                                                                                                                                                                                                  SLO                                                                                                                                                   SLO                                                                                                                                                                                                                                                                                                                            10000                      CPU                                                                                                                               group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          CPU                                                                                                                                                      30                          70             Usage            CPU        Allocation             CPU      Usage             Reservation            CPU                            Allocation     Capactity           CPU         Reservation                                                                                                            100          50    A         50             80     B   C    B   C          80          100                A B   C             A B C       happy A B C                                                      100          90                   100                                               A B C       happy     A                     50             B   C      60          80    A        40      A      happy                 100             A B C                                                                                            A B C                          A B C                                                           SLO        AWS    Reserved Instance OnDemand Instance    SLO            Obtainability                        Availability                                     3      SLO Reserved Or Prod     Obtainability   Availability    100          Economy Or Batch       Obtainability   Availability    98                      98                             Opportunistic Or Free     SLO                      Pooling                          Pooling              B                  A        B                                                                   1                                                                                     Usage vs Limit vs Capacity                                                                                          Prod  Batch  Free              SLO                                  100W   A B C            A B C       A1 B1 C1       20W Prod        40W              99            10         60W              60W   A1  B1  C1        20W             40W 60W       1        60W      A B C   Batch    A2 B2 C2         20W Batch  Free                20W                5W              Priority   Quota                                      priority                   task             task                                            best effort               task                          Quota                                           CPU RAM                                                                                                                                                                                               ",
        "objectID": "posts/resourcemgmt",
        "date": "2023-11-15T12:15:15.000Z",
        "lastmod": "2023-11-15T12:15:15.000Z",
        "draft": false,
        "keywords": [
            "资源管理",
            "调度",
            "预算",
            "核算"
        ],
        "description": "",
        "tags": [
            "资源管理"
        ],
        "categories": [
            "系统设计"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "kube-apiserver 内存优化进阶",
        "uri": "posts/serialisation",
        "content": "kube apiserver                              List                         O n      O 1                                                                            kubernetes                   Informer     kube apiserver   OOM    Kubernetes     bug   Stale Read   ListWatch   WatchList                     K8S                                                                                                                                                                                  kube apiserver        gzip             Accept Encoding   gzip                                                                                                                                           CPU                                                                         kube apiserver watch                    kube apiserver                                                                                 2019                        5000                 Endpoints    5000   Pod      1MB  kube apiserver      5                          KEP 1152 less object serializations          watcher                 kube apiserver                 v1 17       5000                 15  CPU     5          Http        WebSocket      3        2023      Refactor apiserver endpoint transformers natively use Encoders  119801                 Encoder              2019           issue 83898            2       WebSocket          1 29                WebSocket         Http Transfer Encoding  chunked    watch       1 17                   CacheableObject          Encoder      CacheableObject           Identifier represents identifier     Identitier two different objects equal every    input output produce exactly same  type Identifier string type Encoder interface          Identifier returns identifier encoder     Identifiers two different encoders equal every input    object will encoded representation them  Identifier   Identifier      CacheableObject allows object cache its different serializations    avoid performing serialization multiple times  type CacheableObject interface      CacheEncode writes object stream  function will    used case cache miss  function takes ownership    object     CacheableObject wrapper  deep copy wrapped object    passed function     CacheEncode assumes two different calls      function will same  CacheEncode id Identifier  encode func Object  io Writer  error  w io Writer  error    GetObject returns deep copy object encoded   caller    GetObject   owner returned object  reason making copy    avoid bugs  caller modifies object forgets copy it     thus modifying object everyone     object returned GetObject one supposed    passed function CacheEncode method     CacheableObject wrapper  copy wrapped object returned  GetObject   Object   func  e  Encoder  Encode obj Object  stream io Writer  error   co  ok    obj  CacheableObject   ok   return co CacheEncode s Identifier    s doEncode  stream    return s doEncode obj  stream    func  e  Encoder  doEncode obj Object  stream io Writer  error      Existing encoder logic       serializationResult captures result serialization  type serializationResult struct      once used ensure serialization computed once  once sync Once    raw serialized object  raw   byte    err error serialization  err error      metaRuntimeInterface implements runtime Object    metav1 Object interfaces  type metaRuntimeInterface interface   runtime Object metav1 Object      cachingObject object able cache its serializations    so computed exactly once        cachingObject implements metav1 Object interface  accessors    metadata fields   However  setters fields except    SelfLink  which set lately path  ignored  type cachingObject struct   lock sync RWMutex    Object serializations cached  object metaRuntimeInterface    serializations cache containing object s serializations     value stored atomic Value type serializationsCache     atomic Value type used allow fast path  serializations atomic Value   cachingObject     CacheableObject      object             Pod  serializations              Identifier                     json yaml protobuf          cachingObject        Cacher dispatchEvent      incoming chan      event         cacheWatchers               cachingObject    cacheWatcher   input chan     Encode      serveWatch                                                              wrap cachingObject len watchers     3                             watchers          cachingObject           Init Event watchcache            cachingObject          Cacher incoming chan         cachingObject           Get List                 watchcache          Watch                                       Init Event      watchcache                   cacheWatcher   input chan   event     object                Pod       CacheableObject                 CacheableObject   object          Init Event      KEP 1152           Cache incoming chan                                               Init Event           Refactor streaming watch encoder enable caching  120300                KEP 3157 watch list                         reduce number allocations WatchServer d",
        "objectID": "posts/serialisation",
        "date": "2023-12-02T00:01:25.000Z",
        "lastmod": "2023-12-02T00:01:25.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "encode",
            "serilaization"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "关于阅读源码的一些思考",
        "uri": "posts/sourcecodereading",
        "content": "Container      Pod    Request                                                                                          kubelet                                                                                                       kubernetes        Pod        Request  Limit       apiserver                      Request               kubelet    container      hash       container         docker api                    Label      kubelet        hash         hash                          container Image                     Request    Request           hash                               container    Request                      container                       Qos   Guaranteed    Pod    kube apiserver Request      kubelet          Request                                               Request         Request                         2                      Request                          1        Pod Cgroup         Request   Pod   Container               Pod              Pod   cgroup    sys fs cgroup cpu kubepods guaranteed pod uid       Pod   cgroup    sys fs cgroup cpu kubepods burstable pod uid        Pod     cgroup                   1            2                                         cgroup         cgroup               Cgorup       CgroupPerQos         cpu                sys fs cgroup cpu kubepods guaranteed pod uid   containerid   containerid  pod uid   containerid   containerid  burstable bestaffort            kubelet    docker      container  docker   container   pod  qos  root kubepods    kubelet     docker         cgroup parent         kubelet   docker api   docker          cgroup parent         docker inspect  containerid    grep  i cgroup     container cgroup parent            qos         Pod           Pod Qos      syncPod         Pod qos    cgroup       qos       Pod    container           cgroup                         Request  Pod       2   pause                       pod qos      Pod           qos           kubelet     container cgroup                    kubelet      cgroup               Request    cgroup    oomscore       docker     api                 api   cgroup   oomscore         cgroup                                  kubele                  Cgroup       Cgroup                          Pod cgroup                            Pod Cgroup               cgroup                       Pod   Cgroup       Pod                   Pod                 Pod       deletionTimestamp                    Pod                    Cgroup              Request        Pod  deletionTimestamp        Pod                              Pod                                  kubelet     syncPod                                                                                 blog                                                                                                                                             blog",
        "objectID": "posts/sourcecodereading",
        "date": "2021-04-18T12:34:42.000Z",
        "lastmod": "2021-04-18T12:34:42.000Z",
        "draft": false,
        "keywords": [
            "源码阅读"
        ],
        "description": "",
        "tags": [
            "思考"
        ],
        "categories": [
            "思考感悟"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "从故障中我们学到了什么？",
        "uri": "posts/stability",
        "content": "P0                                                                                                                                                      P0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  CTO                                 N                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    review                                                                                                                         P0                                                                                                                                                                                                                                                                      ROI                                                                                       SLA                                                                                                                         SLA                                                                                                                                                                                                             ppt                                                                                                                                          k8s     k8s     P0           7                               P0                       P0                                                                                                                            k8s                                                k8s                                                       k8s                                                 k8s                             k8s                                                                    k8s          k8s                   k8s      API       k8s                                                                 k8s                                    k8s                                      down                        k8s        checksum                                 k8s                                                     k8s                  Operator              k8s                               crd   operator    Informer                                         k8s                          namespace      informer        event handler                                         ns       goroutine             ns          goroutine                 informer     kube apiserver    List   Watch                                                              informer        kube apiserver                                                       k8s                       k8s                                                                                                                                            QPS                                                                                 k8s                                                                                                                                             API                       k8s                                                                                                             PPT                                    PPT                                                                                                                                                            blog                                    K8S                  WX YlikakuY",
        "objectID": "posts/stability",
        "date": "2023-11-28T14:02:41.000Z",
        "lastmod": "2023-11-28T14:02:41.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "故障"
        ],
        "description": "",
        "tags": [
            "思考",
            "随笔"
        ],
        "categories": [
            "随笔"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "Kubernetes 陈年老 bug - Stale Read",
        "uri": "posts/staleread",
        "content": "Informer   Cacher                          Stale read           Informer   Kube apiserver                  Informer   Kube apiserver WatchCache                                                 RV    Resourceversion         v1 26 9                     Etcd        List    Watch      query       RV           RV              RV                      RV    RV    0  RV      0            List       WatchCache Store               Etcd                                        RV                       3s                           Too large resource version            1s                         Stale Read       1  T1  StatefulSet controller creates pod 0  uid 1  scheduled node 1   2  T2  pod 0 deleted part rolling upgrade   3  node 1 sees pod 0 deleted cleans up  deletes pod api   4  StatefulSet controller creates second pod pod 0  uid 2  assigned node 2   5  node 2 sees pod 0 scheduled starts pod 0   6  kubelet node 1 crashes restarts  performs initial list pods scheduled against API server HA setup  more one API server  partitioned master  watch cache arbitrarily delayed   watch cache returns list pods T2   7  node 1 fills its local cache list pods T2   8  node 1 starts pod 0  uid 1  node 2 already running pod 0  uid 2              issue 59848         6          Informer List RV  0         kube apiserver                            kube apiserver     watchCache Store                                           List       RV  0            watchCache Store                   kube apiserver             Stale Read                                                             master          ConsistentListFromCache FeatureGate              Stale Read          v1 29             GetList implements storage Interface func  c  Cacher  GetList ctx context Context  key string  opts storage ListOptions  listObj runtime Object  error       listRV    0    utilfeature DefaultFeatureGate Enabled features ConsistentListFromCache    listRV  err   storage GetCurrentResourceVersionFromStorage ctx  c storage  c newListFunc  c resourcePrefix  c objectType String    err    nil   return err         objs  readResourceVersion  indexUsed  err    c listItems ctx  listRV  key  pred  recursive                   RV             Etcd          RV    listRV         listItems             Informer         List     RV  0     kube apiserver          Etcd                      RV           watchCache Store               0   RV        List                        Etcd        RV                 List RV  0                     kube apiserver                        Stale Read               Etcd Read           Etcd                              listRV    0                RV                   Etcd                                                  listRV              Stale Read                            Informer   List        kube apiserver",
        "objectID": "posts/staleread",
        "date": "2023-11-03T16:23:51.000Z",
        "lastmod": "2023-11-03T16:23:51.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "informer",
            "watchlist",
            "watch"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "思想随笔1 - 思考思考的过程",
        "uri": "posts/thoughtfulessay",
        "content": "1   2        1   2                                            1   2                1                  2                      1                                       2                                                                         1                   2                                                   2      1                           2        1                             1                                                                                    1                                                                                                                                                                                                                                                                                                                                                                                                                                    30                                                                                                                                                          N2                                                                            4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   2                                                                                                                                                                                                                                                                                     100                                                                                                                                                                                                                                                                                                                               2              1                                                                                                                                                                                               2           1",
        "objectID": "posts/thoughtfulessay",
        "date": "2021-07-10T13:58:59.000Z",
        "lastmod": "2021-07-10T13:58:59.000Z",
        "draft": false,
        "keywords": [
            "思考",
            "随笔"
        ],
        "description": "",
        "tags": [
            "思考",
            "随笔"
        ],
        "categories": [
            "随笔"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "思想随笔2 - 一起读毛选",
        "uri": "posts/thoughtfulessay2",
        "content": "",
        "objectID": "posts/thoughtfulessay2",
        "date": "2022-11-26T05:30:00.000Z",
        "lastmod": "2022-11-26T05:30:00.000Z",
        "draft": false,
        "keywords": [
            "思考",
            "随笔"
        ],
        "description": "",
        "tags": [
            "思考",
            "随笔"
        ],
        "categories": [
            "随笔"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "从 ListWatch 到 WatchList",
        "uri": "posts/watchlist",
        "content": "kube apiserver                             List                         O n      O 1                                                kubernetes                   Informer     kube apiserver   OOM    Kubernetes     bug   Stale Read                           Client   Server                Informer     ListWatch              List              Server       List    Informer    Server   API                       Server              List          Stale Read                          RV    Resourceversion         v1 26 9                     Etcd            List    Watch      query       RV           RV              RV                1            RV      2  RV    0    3  RV      0                List       WatchCache Store               Etcd                                            RV                       3s                           Too large resource version            1s                List Stale Read                  kube apiserver    Etcd     RV    WatchCache Store      RV                                                                API    Watch             List             List             List                   List           Watch      Informer                       Watch API    List                       Informer    ListWatch        Watch API                                                  Watch API      SendInitialEvents true       List     Server      Watch                InitEvents                            BOOKMARK Event     Annotation   BOOKMARK   RV       bookmarkAfterRV                InitEvents                   BOOKMARK Event             InitEvent    List                  v1 29          v1 29    alpha            1 27            v1 29                                  WatchCache             kube apiserver            G1 G2      goroutine       Etcd                 CacheWatcher   input chan G1 1            Cacher        Reflector WatchCache    Reflector   Store     Etcd         G1 2 Reflector      Etcd List   Watch API       G1 3 Reflector            WatchCache   store   cyclic buffer                          G1 4      WatchCache      Event     Cacher   incoming chan    G2 1   Cacher   imcomming chan             CacheWatcher   input chan      1   1 25s    RV   bookmarkAfterRV   BOOKMARK        CacheWatcher   input chan                                        Reflector      Watch    query     RV    sendInitialEvent true resourceVersionMatch NotOlderThan AllowWatchBookmarks true      RV       RV  0        List                      Watch      RV               Watch API Stale Read     List Stale Read                List     FeatureGate         Consistent Read   Watch          FeatureGate           RV           Consistent Read                      CacheWachter     Server            bookmarkAfterRV       RV  0    bookmarkAfterRV    WatchCache RV WatchCache Store        RV     RV       Etcd        RV    bookmarkAfterRV   bookmarkAfterRV     CacheWatcher    CacheWatcher     WatchCache Store     input chan        InitEvents 2a     WatchCache Store                            Store            Store       RV         2b    input chan          RV     2a     RV         BOOKMARK      RV    2a     RV       bookmarkAfterRV        BOOKMARK         List            Annotation  k8s io initial events end                                Informer               WathList          Watch                     Annotation  k8s io initial events end   BOOKMARK         RV                  List             RV        Watch             Informer        Watch               KEP 3157 watch list                                                                                         2a b         2b c         G2 1               G1        Etcd                                                              Watch API     Stale Read     RV    WatchList             List   Stale Read       Watch API                      List API      WatchList      Stale Read      WatchCache Store       Cacher imcomming chan             2a       Store           RV     2b     imcomming chan        event RV   RV    BOOKMARK                        CacheWatcher   input chan       RV   bookmarkAfterRV                bookmarkAfterRV   KEP        2c                bookmark timer      1   1 25s       1   1 25s      BOOKMARK      RV   incoming chan    RV               3          G2 1                  CacheWatcher input chan  BOOKMARK     RV    bookmarkAfterRV               bookmarkAfterRV BOOKMARK                          RV       bookmarkAfterRV          bookmarkAfterRV   List         bookmarkAfterRV                            List         bookmark timer       1   1 25s      2b     BOOKMARK       RV    bookmarkAfterRV        bookmarkAfterRV BOOKMARK                bookmarkAfterRV BOOKMARK                          Watch timeout    1s                     WatchList                                WatchList                                          KEP                 kube apiserver",
        "objectID": "posts/watchlist",
        "date": "2023-11-07T14:10:18.000Z",
        "lastmod": "2023-11-07T14:10:18.000Z",
        "draft": false,
        "keywords": [
            "kubernetes",
            "informer",
            "watch",
            "watchlist",
            "kube-apiserver"
        ],
        "description": "",
        "tags": [
            "kubernetes"
        ],
        "categories": [
            "源码分析"
        ],
        "author": "Kaku Li"
    },
    {
        "title": "组织项目介绍",
        "uri": "projects",
        "content": "k cloud labs     Kinitiras        Kubernetes admission webhook       Pidalio  Kinitiras        0         Kluster capacity                                 scheduler stress test",
        "objectID": "projects",
        "date": "2021-04-15T12:17:10.000Z",
        "lastmod": "2021-04-15T12:17:10.000Z",
        "draft": false,
        "keywords": [
            ""
        ],
        "description": "",
        "tags": [
            ""
        ],
        "categories": [],
        "author": "Kaku Li"
    }
]